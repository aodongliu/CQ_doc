\hypertarget{epc_8hpp_source}{}\doxysection{epc.\+hpp}
\label{epc_8hpp_source}\index{include/dft/epc.hpp@{include/dft/epc.hpp}}
\mbox{\hyperlink{epc_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/* }}
\DoxyCodeLine{2 \textcolor{comment}{ *  This file is part of the Chronus Quantum (ChronusQ) software package}}
\DoxyCodeLine{3 \textcolor{comment}{ *  }}
\DoxyCodeLine{4 \textcolor{comment}{ *  Copyright (C) 2014-\/2022 Li Research Group (University of Washington)}}
\DoxyCodeLine{5 \textcolor{comment}{ *  }}
\DoxyCodeLine{6 \textcolor{comment}{ *  This program is free software; you can redistribute it and/or modify}}
\DoxyCodeLine{7 \textcolor{comment}{ *  it under the terms of the GNU General Public License as published by}}
\DoxyCodeLine{8 \textcolor{comment}{ *  the Free Software Foundation; either version 2 of the License, or}}
\DoxyCodeLine{9 \textcolor{comment}{ *  (at your option) any later version.}}
\DoxyCodeLine{10 \textcolor{comment}{ *  }}
\DoxyCodeLine{11 \textcolor{comment}{ *  This program is distributed in the hope that it will be useful,}}
\DoxyCodeLine{12 \textcolor{comment}{ *  but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{13 \textcolor{comment}{ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}}
\DoxyCodeLine{14 \textcolor{comment}{ *  GNU General Public License for more details.}}
\DoxyCodeLine{15 \textcolor{comment}{ *  }}
\DoxyCodeLine{16 \textcolor{comment}{ *  You should have received a copy of the GNU General Public License along}}
\DoxyCodeLine{17 \textcolor{comment}{ *  with this program; if not, write to the Free Software Foundation, Inc.,}}
\DoxyCodeLine{18 \textcolor{comment}{ *  51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301 USA.}}
\DoxyCodeLine{19 \textcolor{comment}{ *  }}
\DoxyCodeLine{20 \textcolor{comment}{ *  Contact the Developers:}}
\DoxyCodeLine{21 \textcolor{comment}{ *    E-\/Mail: xsli@uw.edu}}
\DoxyCodeLine{22 \textcolor{comment}{ *  }}
\DoxyCodeLine{23 \textcolor{comment}{ */}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{dft_8hpp}{dft.hpp}}>}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{matrix_8hpp}{matrix.hpp}}>}}
\DoxyCodeLine{28 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{quantum_2base_8hpp}{quantum/base.hpp}}>}}
\DoxyCodeLine{29 }
\DoxyCodeLine{30 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceChronusQ}{ChronusQ}} \{}
\DoxyCodeLine{34   \textcolor{keyword}{class }\mbox{\hyperlink{classChronusQ_1_1EPC17}{EPC17}} : \textcolor{keyword}{public} \mbox{\hyperlink{classChronusQ_1_1DFTFunctional}{DFTFunctional}} \{}
\DoxyCodeLine{35 }
\DoxyCodeLine{36   \textcolor{keyword}{public}:}
\DoxyCodeLine{37     \mbox{\hyperlink{classChronusQ_1_1EPC17_ae4ebafe9f7d8a18fe9242623d9727956}{EPC17}}(std::string epcName) : \mbox{\hyperlink{classChronusQ_1_1DFTFunctional}{DFTFunctional}}(epcName) }
\DoxyCodeLine{38     \{ }
\DoxyCodeLine{39       this-\/>\mbox{\hyperlink{classChronusQ_1_1DFTFunctional_a71093cbd266475d7664a2ebc1961a36a}{isGGA\_}} = \textcolor{keyword}{false}; }
\DoxyCodeLine{40       this-\/>\mbox{\hyperlink{classChronusQ_1_1DFTFunctional_a0375591d2353c1ae73360e1156db11b0}{isEPC\_}} = \textcolor{keyword}{true}; }
\DoxyCodeLine{41     \};}
\DoxyCodeLine{42 }
\DoxyCodeLine{43     \textcolor{keywordtype}{void} \mbox{\hyperlink{classChronusQ_1_1EPC17_a1e892a008e408128ef3e9544e98836f2}{evalEXC\_VXC}}(\textcolor{keywordtype}{size\_t} N, \textcolor{keywordtype}{double} *rho, \textcolor{keywordtype}{double} *aux\_rho, \textcolor{keywordtype}{double} *eps, \textcolor{keywordtype}{double} *vxc, \textcolor{keywordtype}{bool} electron);}
\DoxyCodeLine{44 }
\DoxyCodeLine{45   \}; \textcolor{comment}{// epc17-\/2 functional}}
\DoxyCodeLine{46 }
\DoxyCodeLine{47 }
\DoxyCodeLine{53   \textcolor{keyword}{class }\mbox{\hyperlink{classChronusQ_1_1EPC19}{EPC19}} : \textcolor{keyword}{public} \mbox{\hyperlink{classChronusQ_1_1DFTFunctional}{DFTFunctional}} \{}
\DoxyCodeLine{54 }
\DoxyCodeLine{55   \textcolor{keyword}{public}:}
\DoxyCodeLine{56     \mbox{\hyperlink{classChronusQ_1_1EPC19_a107f5cda3e687319ab9c4c7dd8b06f61}{EPC19}}(std::string epcName) : \mbox{\hyperlink{classChronusQ_1_1DFTFunctional}{DFTFunctional}}(epcName) }
\DoxyCodeLine{57     \{ }
\DoxyCodeLine{58       this-\/>\mbox{\hyperlink{classChronusQ_1_1DFTFunctional_a71093cbd266475d7664a2ebc1961a36a}{isGGA\_}} = \textcolor{keyword}{true}; }
\DoxyCodeLine{59       this-\/>\mbox{\hyperlink{classChronusQ_1_1DFTFunctional_a0375591d2353c1ae73360e1156db11b0}{isEPC\_}} = \textcolor{keyword}{true};}
\DoxyCodeLine{60     \};}
\DoxyCodeLine{61 }
\DoxyCodeLine{62     \textcolor{keywordtype}{void} \mbox{\hyperlink{classChronusQ_1_1EPC19_a2105d29ab549a93e5b7bcc26f881b1f9}{evalEXC\_VXC}}(\textcolor{keywordtype}{size\_t} N, \textcolor{keywordtype}{double} *rho, \textcolor{keywordtype}{double} *aux\_rho, \textcolor{keywordtype}{double} *sigma, \textcolor{keywordtype}{double} *aux\_sigma,}
\DoxyCodeLine{63                      \textcolor{keywordtype}{double} *cross\_sigma, \textcolor{keywordtype}{double} *eps, \textcolor{keywordtype}{double} *vrho, \textcolor{keywordtype}{double} *vsigma, }
\DoxyCodeLine{64                      \textcolor{keywordtype}{double} *vcsigma, \textcolor{keywordtype}{double}* epc, \textcolor{keywordtype}{bool} electron);}
\DoxyCodeLine{65 }
\DoxyCodeLine{66   \}; \textcolor{comment}{// class EPC19}}
\DoxyCodeLine{67 }
\DoxyCodeLine{82   \textcolor{keyword}{template} <\textcolor{keyword}{typename} MatsT>}
\DoxyCodeLine{83   \textcolor{keywordtype}{void} \mbox{\hyperlink{namespaceChronusQ_a8b6ce2b6b67536f010ea1326dec72bcb}{mkCrossAuxVar}}(}
\DoxyCodeLine{84     \textcolor{keywordtype}{bool} check\_aux, \textcolor{keywordtype}{bool} electron,}
\DoxyCodeLine{85     std::shared\_ptr<\mbox{\hyperlink{classChronusQ_1_1PauliSpinorSquareMatrices}{PauliSpinorSquareMatrices<MatsT>}}> onePDM1,}
\DoxyCodeLine{86     std::shared\_ptr<\mbox{\hyperlink{classChronusQ_1_1PauliSpinorSquareMatrices}{PauliSpinorSquareMatrices<MatsT>}}> onePDM2,}
\DoxyCodeLine{87     \textcolor{keywordtype}{double} epsScreen, \textcolor{keywordtype}{size\_t} NPts,}
\DoxyCodeLine{88     \textcolor{keywordtype}{double} *dndX1, \textcolor{keywordtype}{double} *dndY1, \textcolor{keywordtype}{double} *dndZ1, }
\DoxyCodeLine{89     \textcolor{keywordtype}{double} *dMxdX1, \textcolor{keywordtype}{double} *dMxdY1, \textcolor{keywordtype}{double} *dMxdZ1, }
\DoxyCodeLine{90     \textcolor{keywordtype}{double} *dMydX1, \textcolor{keywordtype}{double} *dMydY1, \textcolor{keywordtype}{double} *dMydZ1, }
\DoxyCodeLine{91     \textcolor{keywordtype}{double} *dMzdX1, \textcolor{keywordtype}{double} *dMzdY1, \textcolor{keywordtype}{double} *dMzdZ1, }
\DoxyCodeLine{92     \textcolor{keywordtype}{double} *dndX2, \textcolor{keywordtype}{double}  *dndY2, \textcolor{keywordtype}{double} *dndZ2, }
\DoxyCodeLine{93     \textcolor{keywordtype}{double} *dMxdX2, \textcolor{keywordtype}{double} *dMxdY2, \textcolor{keywordtype}{double} *dMxdZ2, }
\DoxyCodeLine{94     \textcolor{keywordtype}{double} *dMydX2, \textcolor{keywordtype}{double} *dMydY2, \textcolor{keywordtype}{double} *dMydZ2, }
\DoxyCodeLine{95     \textcolor{keywordtype}{double} *dMzdX2, \textcolor{keywordtype}{double} *dMzdY2, \textcolor{keywordtype}{double} *dMzdZ2, }
\DoxyCodeLine{96     \textcolor{keywordtype}{double} *gammaColl)\{}
\DoxyCodeLine{97 }
\DoxyCodeLine{98     \textcolor{comment}{// GGA Contributions}}
\DoxyCodeLine{99     \textcolor{comment}{// GAMMA(++) = 0.25 * (GSCALAR(e).GSCALAR(p) + GMZ(e).GMZ(p) + GSCALAR(e).GZ(p) + GZ(e).GSCALAR(p))}}
\DoxyCodeLine{100     \textcolor{comment}{// GAMMA(+-\/) = 0.25 * (GSCALAR.GSCALAR -\/ GMZ.GMZ) }}
\DoxyCodeLine{101     \textcolor{comment}{// GAMMA(-\/+) = }}
\DoxyCodeLine{102     \textcolor{comment}{// GAMMA(-\/-\/) = 0.25 * (GSCALAR.GSCALAR + GMZ.GMZ) -\/ 0.5 * GSCALAR.GMZ}}
\DoxyCodeLine{103     \textcolor{comment}{//2C : not yet implemented}}
\DoxyCodeLine{104 }
\DoxyCodeLine{105     \textcolor{comment}{// RKS part}}
\DoxyCodeLine{106     \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} iPt = 0; iPt < NPts; iPt++) \{}
\DoxyCodeLine{107       gammaColl[4*iPt] = 0.25 * (dndX1[iPt]*dndX2[iPt] + dndY1[iPt]*dndY2[iPt] + dndZ1[iPt]*dndZ2[iPt]);}
\DoxyCodeLine{108       gammaColl[4*iPt+1] = gammaColl[4*iPt];}
\DoxyCodeLine{109       gammaColl[4*iPt+2] = gammaColl[4*iPt];}
\DoxyCodeLine{110       gammaColl[4*iPt+3] = gammaColl[4*iPt];}
\DoxyCodeLine{111     \}}
\DoxyCodeLine{112 }
\DoxyCodeLine{113     \textcolor{comment}{// main system is electron}}
\DoxyCodeLine{114     \textcolor{keywordflow}{if} (electron) \{}
\DoxyCodeLine{115 }
\DoxyCodeLine{116       \textcolor{comment}{// restricted}}
\DoxyCodeLine{117       \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} iPt = 0; iPt < NPts; iPt++) \{}
\DoxyCodeLine{118         \textcolor{keywordtype}{double} gammaTmp = 0.25 * (dndX1[iPt]*dMzdX2[iPt] + dndY1[iPt]*dMzdY2[iPt] + dndZ1[iPt]*dMzdZ2[iPt]);}
\DoxyCodeLine{119         gammaColl[4*iPt]   += gammaTmp;}
\DoxyCodeLine{120         gammaColl[4*iPt+1] -\/= gammaTmp;}
\DoxyCodeLine{121         gammaColl[4*iPt+2] += gammaTmp;}
\DoxyCodeLine{122         gammaColl[4*iPt+3] -\/= gammaTmp;}
\DoxyCodeLine{123       \}}
\DoxyCodeLine{124 }
\DoxyCodeLine{125       \textcolor{comment}{// UKS}}
\DoxyCodeLine{126       \textcolor{keywordflow}{if}( onePDM1-\/>hasZ() ) \{}
\DoxyCodeLine{127         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} iPt = 0; iPt < NPts; iPt++) \{}
\DoxyCodeLine{128           \textcolor{keywordtype}{double} gammaTmp1 = 0.25 * (dMzdX1[iPt]*dMzdX2[iPt] + dMzdY1[iPt]*dMzdY2[iPt] + dMzdZ1[iPt]*dMzdZ2[iPt]);}
\DoxyCodeLine{129           \textcolor{keywordtype}{double} gammaTmp2 = 0.25 * (dMzdX1[iPt]*dndX2[iPt] + dMzdY1[iPt]*dndY2[iPt] + dMzdZ1[iPt]*dndZ2[iPt]);}
\DoxyCodeLine{130 }
\DoxyCodeLine{131           \textcolor{comment}{// aa}}
\DoxyCodeLine{132           gammaColl[4*iPt]  += gammaTmp1;}
\DoxyCodeLine{133           gammaColl[4*iPt]  += gammaTmp2;}
\DoxyCodeLine{134           \textcolor{comment}{// ab}}
\DoxyCodeLine{135           gammaColl[4*iPt+1]  -\/= gammaTmp1;}
\DoxyCodeLine{136           gammaColl[4*iPt+1]  += gammaTmp2;}
\DoxyCodeLine{137           \textcolor{comment}{// ba}}
\DoxyCodeLine{138           gammaColl[4*iPt+2]  -\/= gammaTmp1;}
\DoxyCodeLine{139           gammaColl[4*iPt+2]  -\/= gammaTmp2;}
\DoxyCodeLine{140           \textcolor{comment}{// bb}}
\DoxyCodeLine{141           gammaColl[4*iPt+3]  += gammaTmp1;}
\DoxyCodeLine{142           gammaColl[4*iPt+3]  -\/= gammaTmp2;}
\DoxyCodeLine{143 }
\DoxyCodeLine{144         \}}
\DoxyCodeLine{145       \}}
\DoxyCodeLine{146     \}}
\DoxyCodeLine{147     \textcolor{keywordflow}{else} \{  \textcolor{comment}{// main system is proton}}
\DoxyCodeLine{148 }
\DoxyCodeLine{149       \textcolor{comment}{// restricted}}
\DoxyCodeLine{150       \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} iPt = 0; iPt < NPts; iPt++) \{}
\DoxyCodeLine{151         \textcolor{keywordtype}{double} gammaTmp = 0.25 * (dMzdX1[iPt]*dndX2[iPt] + dMzdY1[iPt]*dndY2[iPt] + dMzdZ1[iPt]*dndZ2[iPt]);}
\DoxyCodeLine{152 }
\DoxyCodeLine{153         gammaColl[4*iPt]   += gammaTmp;}
\DoxyCodeLine{154         gammaColl[4*iPt+1] += gammaTmp;}
\DoxyCodeLine{155         gammaColl[4*iPt+2] -\/= gammaTmp;}
\DoxyCodeLine{156         gammaColl[4*iPt+3] -\/= gammaTmp;}
\DoxyCodeLine{157 }
\DoxyCodeLine{158       \}}
\DoxyCodeLine{159 }
\DoxyCodeLine{160       \textcolor{comment}{// UKS}}
\DoxyCodeLine{161       \textcolor{keywordflow}{if}( onePDM2-\/>hasZ() ) \{}
\DoxyCodeLine{162         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} iPt = 0; iPt < NPts; iPt++) \{}
\DoxyCodeLine{163           \textcolor{keywordtype}{double} gammaTmp1 = 0.25 * (dMzdX1[iPt]*dMzdX2[iPt] + dMzdY1[iPt]*dMzdY2[iPt] + dMzdZ1[iPt]*dMzdZ2[iPt]);}
\DoxyCodeLine{164           \textcolor{keywordtype}{double} gammaTmp2 = 0.25 * (dndX1[iPt]*dMzdX2[iPt] + dndY1[iPt]*dMzdY2[iPt] + dndZ1[iPt]*dMzdZ2[iPt]);}
\DoxyCodeLine{165           \textcolor{comment}{// aa}}
\DoxyCodeLine{166           gammaColl[4*iPt]  += gammaTmp1;}
\DoxyCodeLine{167           gammaColl[4*iPt]  += gammaTmp2;}
\DoxyCodeLine{168           \textcolor{comment}{// ab}}
\DoxyCodeLine{169           gammaColl[4*iPt+1]  -\/= gammaTmp1;}
\DoxyCodeLine{170           gammaColl[4*iPt+1]  -\/= gammaTmp2;}
\DoxyCodeLine{171           \textcolor{comment}{// ba}}
\DoxyCodeLine{172           gammaColl[4*iPt+2]  -\/= gammaTmp1;}
\DoxyCodeLine{173           gammaColl[4*iPt+2]  += gammaTmp2;}
\DoxyCodeLine{174           \textcolor{comment}{// bb}}
\DoxyCodeLine{175           gammaColl[4*iPt+3]  += gammaTmp1;}
\DoxyCodeLine{176           gammaColl[4*iPt+3]  -\/= gammaTmp2;}
\DoxyCodeLine{177         \}}
\DoxyCodeLine{178       \}}
\DoxyCodeLine{179     \}}
\DoxyCodeLine{180   \}; \textcolor{comment}{//KohnSham<MatsT,IntsT>::mkCrossAuxVar}}
\DoxyCodeLine{181 }
\DoxyCodeLine{211   \textcolor{keywordtype}{void} \mbox{\hyperlink{namespaceChronusQ_a0ecad9fb6bbb86b9e15cb07efcc7b256}{loadEPCVXCder}}(}
\DoxyCodeLine{212     \textcolor{keywordtype}{bool} electron,}
\DoxyCodeLine{213     std::vector<std::shared\_ptr<DFTFunctional>> functionals,}
\DoxyCodeLine{214     \textcolor{keywordtype}{size\_t} NPts, \textcolor{keywordtype}{double} *Den1, \textcolor{keywordtype}{double} *Gamma1,}
\DoxyCodeLine{215     \textcolor{keywordtype}{double} *Den2, \textcolor{keywordtype}{double} *Gamma2, \textcolor{keywordtype}{double} *cGamma, \textcolor{keywordtype}{double} *epsEval, \textcolor{keywordtype}{double} *VRhoEval, }
\DoxyCodeLine{216     \textcolor{keywordtype}{double} *VgammaEval,\textcolor{keywordtype}{double} *CVgammaEval, \textcolor{keywordtype}{double} *EpsSCR, \textcolor{keywordtype}{double} *VRhoSCR, }
\DoxyCodeLine{217     \textcolor{keywordtype}{double} *VgammaSCR, \textcolor{keywordtype}{double} *CVgammaSCR, \textcolor{keywordtype}{double}* epcEval);}
\DoxyCodeLine{218 }
\DoxyCodeLine{260    \textcolor{keywordtype}{void} \mbox{\hyperlink{namespaceChronusQ_a3b3b3494232d56f304a7838ecd110356}{constructEPCZVars}}(\textcolor{keywordtype}{bool} electron,}
\DoxyCodeLine{261     \mbox{\hyperlink{namespaceChronusQ_aa44db2c8e0c6903e70bcbdf147dd4ef5}{DENSITY\_TYPE}} denTyp, \textcolor{keywordtype}{size\_t} NPts, }
\DoxyCodeLine{262     \textcolor{keywordtype}{double} *CVgammaEval, \textcolor{keywordtype}{double} *ZgammaVar3);}
\DoxyCodeLine{263 }
\DoxyCodeLine{300   \textcolor{keyword}{template} <\textcolor{keyword}{typename} MatsT>}
\DoxyCodeLine{301   \textcolor{keywordtype}{void} \mbox{\hyperlink{namespaceChronusQ_ac1dce6121eb20d5236d321cc4403db85}{formZ\_vxc\_epc}}(}
\DoxyCodeLine{302     std::shared\_ptr<\mbox{\hyperlink{classChronusQ_1_1PauliSpinorSquareMatrices}{PauliSpinorSquareMatrices<MatsT>}}> onePDM1,}
\DoxyCodeLine{303     std::shared\_ptr<\mbox{\hyperlink{classChronusQ_1_1PauliSpinorSquareMatrices}{PauliSpinorSquareMatrices<MatsT>}}> onePDM2,}
\DoxyCodeLine{304     \mbox{\hyperlink{namespaceChronusQ_aa44db2c8e0c6903e70bcbdf147dd4ef5}{DENSITY\_TYPE}} denTyp, }
\DoxyCodeLine{305     \textcolor{keywordtype}{bool} isGGA, \textcolor{keywordtype}{size\_t} NPts, \textcolor{keywordtype}{size\_t} NBE, \textcolor{keywordtype}{size\_t} IOff, }
\DoxyCodeLine{306     \textcolor{keywordtype}{double} epsScreen, std::vector<double> \&\mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}}, \textcolor{keywordtype}{double} *ZrhoVar1,}
\DoxyCodeLine{307     \textcolor{keywordtype}{double} *ZgammaVar1, \textcolor{keywordtype}{double} *ZgammaVar2, \textcolor{keywordtype}{double} *ZgammaVar3,}
\DoxyCodeLine{308     \textcolor{keywordtype}{double} *DenS, \textcolor{keywordtype}{double} *DenZ, \textcolor{keywordtype}{double} *DenY, \textcolor{keywordtype}{double} *DenX, }
\DoxyCodeLine{309     \textcolor{keywordtype}{double} *GDenS, \textcolor{keywordtype}{double} *GDenZ, \textcolor{keywordtype}{double} *GDenY, \textcolor{keywordtype}{double} *GDenX, }
\DoxyCodeLine{310     \textcolor{keywordtype}{double} *aux\_DenS,  \textcolor{keywordtype}{double} *aux\_DenZ,  \textcolor{keywordtype}{double} *aux\_DenY,  \textcolor{keywordtype}{double} *aux\_DenX, }
\DoxyCodeLine{311     \textcolor{keywordtype}{double} *aux\_GDenS, \textcolor{keywordtype}{double} *aux\_GDenZ, \textcolor{keywordtype}{double} *aux\_GDenY, \textcolor{keywordtype}{double} *aux\_GDenX, }
\DoxyCodeLine{312     \textcolor{keywordtype}{double} *BasisScratch, \textcolor{keywordtype}{double} *ZMAT)\{}
\DoxyCodeLine{313 }
\DoxyCodeLine{314     \textcolor{keywordtype}{double} Fg;}
\DoxyCodeLine{315     \textcolor{comment}{// Fx,y,z  \string^m(all batch) in J. Chem. Theory Comput. 2011, 7, 3097–3104 Eq. 17 (changed for Total and Magn)}}
\DoxyCodeLine{316     \textcolor{keywordtype}{double} FgX;}
\DoxyCodeLine{317     \textcolor{keywordtype}{double} FgY;}
\DoxyCodeLine{318     \textcolor{keywordtype}{double} FgZ;}
\DoxyCodeLine{319 }
\DoxyCodeLine{320     memset(ZMAT,0,IOff*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{321 }
\DoxyCodeLine{322     \textcolor{keywordflow}{if}( not onePDM1-\/>hasXY() ) \{}
\DoxyCodeLine{323       \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} iPt = 0; iPt < NPts; iPt++) \{ }
\DoxyCodeLine{324       \textcolor{comment}{// LDA part -\/> Eq. 15 and 16 (see constructZVars docs for the missing factor of 0.5)}}
\DoxyCodeLine{325         Fg = \mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}}[iPt] * ZrhoVar1[iPt];}
\DoxyCodeLine{326 }
\DoxyCodeLine{327 \textcolor{preprocessor}{\#if VXC\_DEBUG\_LEVEL < 3}}
\DoxyCodeLine{328         \textcolor{keywordflow}{if}(std::abs(Fg) > epsScreen)}
\DoxyCodeLine{329 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{330           blas::axpy(NBE,Fg,BasisScratch + iPt*NBE,1,ZMAT+iPt*NBE,1);}
\DoxyCodeLine{331 }
\DoxyCodeLine{332       \textcolor{comment}{// GGA part -\/> Eq. 15 and 17 (see constructZVars docs for the missing factor of 2)}}
\DoxyCodeLine{333         \textcolor{keywordflow}{if}( isGGA ) \{}
\DoxyCodeLine{334           FgX = \mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}}[iPt] * ZgammaVar1[iPt] * GDenS[iPt];}
\DoxyCodeLine{335           \textcolor{comment}{// add contribution of the epc part }}
\DoxyCodeLine{336           FgX += 0.5 * \mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}}[iPt] * ZgammaVar3[iPt] * aux\_GDenS[iPt];}
\DoxyCodeLine{337 }
\DoxyCodeLine{338           \textcolor{keywordflow}{if}( onePDM1-\/>hasZ() )}
\DoxyCodeLine{339             FgX += \mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}}[iPt] * ZgammaVar2[iPt] * GDenZ[iPt];}
\DoxyCodeLine{340 }
\DoxyCodeLine{341           \textcolor{comment}{// add contribution of the epc part }}
\DoxyCodeLine{342           \textcolor{keywordflow}{if}( onePDM2-\/>hasZ() )}
\DoxyCodeLine{343             FgX += 0.5 * \mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}}[iPt] * ZgammaVar3[iPt] * aux\_GDenZ[iPt];}
\DoxyCodeLine{344 }
\DoxyCodeLine{345           FgY = \mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}}[iPt] * ZgammaVar1[iPt] * GDenS[iPt + NPts];}
\DoxyCodeLine{346           \textcolor{comment}{// add contribution of the epc part }}
\DoxyCodeLine{347           FgY += 0.5 * \mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}}[iPt] * ZgammaVar3[iPt] * aux\_GDenS[iPt + NPts];}
\DoxyCodeLine{348           \textcolor{keywordflow}{if}( onePDM1-\/>hasZ() )}
\DoxyCodeLine{349             FgY += \mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}}[iPt] * ZgammaVar2[iPt] * GDenZ[iPt + NPts];}
\DoxyCodeLine{350 }
\DoxyCodeLine{351           \textcolor{comment}{// add contribution of the epc part }}
\DoxyCodeLine{352           \textcolor{keywordflow}{if}( onePDM2-\/>hasZ() )}
\DoxyCodeLine{353             FgY += 0.5 * \mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}}[iPt] * ZgammaVar3[iPt] * aux\_GDenZ[iPt + NPts];}
\DoxyCodeLine{354 }
\DoxyCodeLine{355           FgZ = \mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}}[iPt] * ZgammaVar1[iPt] * GDenS[iPt + 2*NPts];}
\DoxyCodeLine{356           \textcolor{comment}{// add contribution of the epc part }}
\DoxyCodeLine{357           FgZ += 0.5 * \mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}}[iPt] * ZgammaVar3[iPt] * aux\_GDenS[iPt + 2*NPts];}
\DoxyCodeLine{358           \textcolor{keywordflow}{if}( onePDM1-\/>hasZ() )}
\DoxyCodeLine{359             FgZ += \mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}}[iPt] * ZgammaVar2[iPt] * GDenZ[iPt + 2*NPts];}
\DoxyCodeLine{360 }
\DoxyCodeLine{361           \textcolor{comment}{// add contribution of the epc part }}
\DoxyCodeLine{362           \textcolor{keywordflow}{if}( onePDM2-\/>hasZ() )}
\DoxyCodeLine{363             FgZ += 0.5 * \mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}}[iPt] * ZgammaVar3[iPt] * aux\_GDenZ[iPt + 2*NPts];}
\DoxyCodeLine{364 }
\DoxyCodeLine{365 \textcolor{preprocessor}{\#if VXC\_DEBUG\_LEVEL < 3}}
\DoxyCodeLine{366           \textcolor{keywordflow}{if}(std::abs(FgX) > epsScreen)}
\DoxyCodeLine{367 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{368             blas::axpy(NBE,FgX,BasisScratch + iPt*NBE + IOff,1,ZMAT+iPt*NBE,1);}
\DoxyCodeLine{369 }
\DoxyCodeLine{370 \textcolor{preprocessor}{\#if VXC\_DEBUG\_LEVEL < 3}}
\DoxyCodeLine{371           \textcolor{keywordflow}{if}(std::abs(FgY) > epsScreen)}
\DoxyCodeLine{372 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{373             blas::axpy(NBE,FgY,BasisScratch + iPt*NBE + 2*IOff,1,ZMAT+iPt*NBE,1);}
\DoxyCodeLine{374 }
\DoxyCodeLine{375 \textcolor{preprocessor}{\#if VXC\_DEBUG\_LEVEL < 3}}
\DoxyCodeLine{376           \textcolor{keywordflow}{if}(std::abs(FgZ) > epsScreen)}
\DoxyCodeLine{377 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{378             blas::axpy(NBE,FgZ,BasisScratch + iPt*NBE + 3*IOff,1,ZMAT+iPt*NBE,1);}
\DoxyCodeLine{379         \}}
\DoxyCodeLine{380       \}}
\DoxyCodeLine{381 }
\DoxyCodeLine{382     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{383       \mbox{\hyperlink{namespaceChronusQ_afbba655765a7a40e19e2bea928a687c7}{CErr}}(\textcolor{stringliteral}{"{}EPC-\/19 functional is not implemented for 2-\/component systems (GHF or X2C)!"{}}, std::cout);}
\DoxyCodeLine{384     \} \textcolor{comment}{// 2C}}
\DoxyCodeLine{385 }
\DoxyCodeLine{386   \}; \textcolor{comment}{// formZ\_vxc\_epc}}
\DoxyCodeLine{387 }
\DoxyCodeLine{388 }
\DoxyCodeLine{389 \} \textcolor{comment}{// namespace ChronusQ}}

\end{DoxyCode}
