\hypertarget{direct4C__libcint__coulombonly_8hpp_source}{}\doxysection{direct4\+C\+\_\+libcint\+\_\+coulombonly.\+hpp}
\label{direct4C__libcint__coulombonly_8hpp_source}\index{include/particleintegrals/contract/direct4C\_libcint\_coulombonly.hpp@{include/particleintegrals/contract/direct4C\_libcint\_coulombonly.hpp}}
\mbox{\hyperlink{direct4C__libcint__coulombonly_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/* }}
\DoxyCodeLine{2 \textcolor{comment}{ *  This file is part of the Chronus Quantum (ChronusQ) software package}}
\DoxyCodeLine{3 \textcolor{comment}{ *  }}
\DoxyCodeLine{4 \textcolor{comment}{ *  Copyright (C) 2014-\/2022 Li Research Group (University of Washington)}}
\DoxyCodeLine{5 \textcolor{comment}{ *  }}
\DoxyCodeLine{6 \textcolor{comment}{ *  This program is free software; you can redistribute it and/or modify}}
\DoxyCodeLine{7 \textcolor{comment}{ *  it under the terms of the GNU General Public License as published by}}
\DoxyCodeLine{8 \textcolor{comment}{ *  the Free Software Foundation; either version 2 of the License, or}}
\DoxyCodeLine{9 \textcolor{comment}{ *  (at your option) any later version.}}
\DoxyCodeLine{10 \textcolor{comment}{ *  }}
\DoxyCodeLine{11 \textcolor{comment}{ *  This program is distributed in the hope that it will be useful,}}
\DoxyCodeLine{12 \textcolor{comment}{ *  but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{13 \textcolor{comment}{ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}}
\DoxyCodeLine{14 \textcolor{comment}{ *  GNU General Public License for more details.}}
\DoxyCodeLine{15 \textcolor{comment}{ *  }}
\DoxyCodeLine{16 \textcolor{comment}{ *  You should have received a copy of the GNU General Public License along}}
\DoxyCodeLine{17 \textcolor{comment}{ *  with this program; if not, write to the Free Software Foundation, Inc.,}}
\DoxyCodeLine{18 \textcolor{comment}{ *  51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301 USA.}}
\DoxyCodeLine{19 \textcolor{comment}{ *  }}
\DoxyCodeLine{20 \textcolor{comment}{ *  Contact the Developers:}}
\DoxyCodeLine{21 \textcolor{comment}{ *    E-\/Mail: xsli@uw.edu}}
\DoxyCodeLine{22 \textcolor{comment}{ *  }}
\DoxyCodeLine{23 \textcolor{comment}{ */}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{integrals_8hpp}{integrals.hpp}}>}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{inhouseaointegral_8hpp}{particleintegrals/inhouseaointegral.hpp}}>}}
\DoxyCodeLine{28 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{matout_8hpp}{util/matout.hpp}}>}}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{blas1_8hpp}{cqlinalg/blas1.hpp}}>}}
\DoxyCodeLine{30 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{blasext_8hpp}{cqlinalg/blasext.hpp}}>}}
\DoxyCodeLine{31 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{blasutil_8hpp}{cqlinalg/blasutil.hpp}}>}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{physcon_8hpp}{physcon.hpp}}>}}
\DoxyCodeLine{33 }
\DoxyCodeLine{34 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{threads_8hpp}{util/threads.hpp}}>}}
\DoxyCodeLine{35 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{mpi_8hpp}{util/mpi.hpp}}>}}
\DoxyCodeLine{36 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{timer_8hpp}{util/timer.hpp}}>}}
\DoxyCodeLine{37 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{math_8hpp}{util/math.hpp}}>}}
\DoxyCodeLine{38 }
\DoxyCodeLine{39 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{gtodirectreleri_8hpp}{particleintegrals/twopints/gtodirectreleri.hpp}}>}}
\DoxyCodeLine{40 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{contract_2direct_8hpp}{particleintegrals/contract/direct.hpp}}>}}
\DoxyCodeLine{41 }
\DoxyCodeLine{42 \textcolor{preprocessor}{\#include <chrono>}}
\DoxyCodeLine{43 }
\DoxyCodeLine{44 \textcolor{preprocessor}{\#define \_CONTRACTION\_}}
\DoxyCodeLine{45 }
\DoxyCodeLine{46 \textcolor{preprocessor}{\#define \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{47 }
\DoxyCodeLine{48 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{libcint_8hpp}{libcint.hpp}}>}}
\DoxyCodeLine{49 }
\DoxyCodeLine{50 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceChronusQ}{ChronusQ}} \{}
\DoxyCodeLine{51 }
\DoxyCodeLine{52 }
\DoxyCodeLine{53 \textcolor{comment}{  /**************************/}}
\DoxyCodeLine{54   \textcolor{comment}{/* Libcint 4C-\/direct Implementation With Coulomb only-\/type of contraction*/}}
\DoxyCodeLine{55 \textcolor{comment}{  /**************************/}}
\DoxyCodeLine{56 }
\DoxyCodeLine{57   \textcolor{comment}{// For DCB Hamiltonian,}}
\DoxyCodeLine{58   \textcolor{comment}{// 12 density matrices upon input stored as}}
\DoxyCodeLine{59   \textcolor{comment}{// LL(MS,MX,MY,MZ), SS(MS,MX,MY,MZ), LS(MS,MX,MY,MZ)}}
\DoxyCodeLine{60   \textcolor{comment}{//}}
\DoxyCodeLine{61   \textcolor{comment}{// 12 contrated matrices upon output stored as}}
\DoxyCodeLine{62   \textcolor{comment}{// LL(MS,MX,MY,MZ), SS(MS,MX,MY,MZ), LS(MS,MX,MY,MZ)}}
\DoxyCodeLine{63   \textcolor{comment}{//}}
\DoxyCodeLine{64   \textcolor{comment}{//}}
\DoxyCodeLine{65   \textcolor{comment}{// Density Matrices are NOT assumed as Hermitian here}}
\DoxyCodeLine{66   \textcolor{comment}{//}}
\DoxyCodeLine{67 }
\DoxyCodeLine{68 \textcolor{comment}{  /*******************************************************************************/}}
\DoxyCodeLine{69   \textcolor{comment}{/*                                                                             */}}
\DoxyCodeLine{70   \textcolor{comment}{/* Libcint Batch 4C-\/direct Implementation With Coulomb only-\/type of contraction*/}}
\DoxyCodeLine{71   \textcolor{comment}{/*                                                                             */}}
\DoxyCodeLine{72 \textcolor{comment}{  /*******************************************************************************/}}
\DoxyCodeLine{73 }
\DoxyCodeLine{74   \textcolor{keyword}{template} <\textcolor{keyword}{typename} MatsT, \textcolor{keyword}{typename} IntsT>}
\DoxyCodeLine{75   \textcolor{keywordtype}{void} \mbox{\hyperlink{classChronusQ_1_1GTODirectRelERIContraction_adb354ad0582c068409f9c76c4b728ea9}{GTODirectRelERIContraction<MatsT,IntsT>::directRelScaffoldLibcintCoulombOnly}}(}
\DoxyCodeLine{76     \mbox{\hyperlink{structChronusQ_1_1MPI__Comm}{MPI\_Comm}} comm, \textcolor{keyword}{const} \textcolor{keywordtype}{bool} screen,}
\DoxyCodeLine{77     std::vector<\mbox{\hyperlink{structChronusQ_1_1TwoBodyRelContraction}{TwoBodyRelContraction<MatsT>}}> \&matList)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{78     }
\DoxyCodeLine{79     \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} mMat = matList[0].contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba1d269d4b7d6c561fc04b81a2a178e2a5}{TWOBODY\_CONTRACTION\_TYPE::LLLL}} ? 2: 1;}
\DoxyCodeLine{80     \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} nMat = matList.size();}
\DoxyCodeLine{81     \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} nBatch = nMat / mMat;}
\DoxyCodeLine{82 }
\DoxyCodeLine{83     \mbox{\hyperlink{classChronusQ_1_1DirectTPI}{DirectTPI<IntsT>}} \&originalERI =}
\DoxyCodeLine{84         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classChronusQ_1_1DirectTPI}{DirectTPI<IntsT>}}\&\textcolor{keyword}{>}(this-\/>ints\_);}
\DoxyCodeLine{85     \mbox{\hyperlink{classChronusQ_1_1CQMemManager}{CQMemManager}}\& memManager\_ = originalERI.\mbox{\hyperlink{classChronusQ_1_1ParticleIntegrals_a4980f581ea843bd4ca6be7ac88064274}{memManager}}();}
\DoxyCodeLine{86     \mbox{\hyperlink{structChronusQ_1_1BasisSet}{BasisSet}}\& originalBasisSet\_ = originalERI.\mbox{\hyperlink{classChronusQ_1_1DirectTPI_a4a476a2dc5e606ee34f0a973b9ddce5c}{basisSet}}();}
\DoxyCodeLine{87     \mbox{\hyperlink{structChronusQ_1_1Molecule}{Molecule}}\& molecule\_ = originalERI.\mbox{\hyperlink{classChronusQ_1_1DirectTPI_aaa9df135704f690d4274a30622cbc86c}{molecule}}();}
\DoxyCodeLine{88 }
\DoxyCodeLine{89     \textcolor{keywordflow}{if} (originalBasisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a87bdf52af466b6675078a34788641774}{forceCart}})}
\DoxyCodeLine{90       \mbox{\hyperlink{namespaceChronusQ_afbba655765a7a40e19e2bea928a687c7}{CErr}}(\textcolor{stringliteral}{"{}Libcint + cartesian GTO NYI."{}});}
\DoxyCodeLine{91 }
\DoxyCodeLine{92     \mbox{\hyperlink{structChronusQ_1_1BasisSet}{BasisSet}} basisSet\_ = originalBasisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a04cfa73f279aae9d94a4ee99fd720fa1}{groupGeneralContractionBasis}}();}
\DoxyCodeLine{93 }
\DoxyCodeLine{94     \textcolor{keywordtype}{size\_t} buffSize = std::max\_element(basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}.begin(),}
\DoxyCodeLine{95                                        basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}.end(),}
\DoxyCodeLine{96                                        [](libint2::Shell \&a, libint2::Shell \&b) \{}
\DoxyCodeLine{97                                          return a.size() < b.size();}
\DoxyCodeLine{98                                        \})-\/>size();}
\DoxyCodeLine{99 }
\DoxyCodeLine{100     \mbox{\hyperlink{classChronusQ_1_1DirectTPI}{DirectTPI<IntsT>}} \&eri = originalERI;}
\DoxyCodeLine{101     }
\DoxyCodeLine{102     \textcolor{comment}{// Determine the number of OpenMP threads}}
\DoxyCodeLine{103     \textcolor{keywordtype}{size\_t} nThreads  = \mbox{\hyperlink{namespaceChronusQ_a3320ee560c87921c8d84885db82e9917}{GetNumThreads}}();}
\DoxyCodeLine{104     \textcolor{keywordtype}{size\_t} LAThreads = \mbox{\hyperlink{namespaceChronusQ_a3152808c4819d6cbf8a29aef92728866}{GetLAThreads}}();}
\DoxyCodeLine{105     \textcolor{comment}{// no need to do that as LA functions are not used in parallel region}}
\DoxyCodeLine{106     \textcolor{comment}{// SetLAThreads(1); // Turn off parallelism in LA functions}}
\DoxyCodeLine{107   }
\DoxyCodeLine{108     \textcolor{keywordtype}{bool} HerDen = matList[0].HER;}
\DoxyCodeLine{109   }
\DoxyCodeLine{110 \textcolor{comment}{    /****************************/}}
\DoxyCodeLine{111     \textcolor{comment}{/* Format Basis for Libcint */}}
\DoxyCodeLine{112 \textcolor{comment}{    /****************************/}}
\DoxyCodeLine{113 }
\DoxyCodeLine{114     \textcolor{keywordtype}{int} nAtoms = molecule\_.\mbox{\hyperlink{structChronusQ_1_1Molecule_abe50222c8aa9cb69f03dbab8623ff171}{nAtoms}};}
\DoxyCodeLine{115     \textcolor{keywordtype}{int} nShells = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a936871b121472a416ee6f947ccdea4b4}{nShell}};}
\DoxyCodeLine{116     \textcolor{keywordtype}{int} iAtom, iShell, off;}
\DoxyCodeLine{117 }
\DoxyCodeLine{118     \textcolor{comment}{// ATM\_SLOTS = 6; BAS\_SLOTS = 8;}}
\DoxyCodeLine{119     \textcolor{keywordtype}{int} *atm = memManager\_.template malloc<int>(nAtoms * ATM\_SLOTS);}
\DoxyCodeLine{120     \textcolor{keywordtype}{int} *bas = memManager\_.template malloc<int>(nShells * BAS\_SLOTS);}
\DoxyCodeLine{121     \textcolor{keywordtype}{double} *env = memManager\_.template malloc<double>(basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_aa66974bc0717a4bdcb09cc61d469ebda}{getLibcintEnvLength}}(molecule\_));}
\DoxyCodeLine{122 }
\DoxyCodeLine{123 }
\DoxyCodeLine{124     basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a0dea80bb1ae5e74a731372d40ebbe43e}{setLibcintEnv}}(molecule\_, atm, bas, env);}
\DoxyCodeLine{125     \textcolor{keywordtype}{size\_t} cache\_size = libcintCacheSize(matList[0].contType, atm, nAtoms, bas, nShells, env);}
\DoxyCodeLine{126 }
\DoxyCodeLine{127     \textcolor{keyword}{enum} ERI\_2ND\_DERIV \{}
\DoxyCodeLine{128       AxBx,}
\DoxyCodeLine{129       AxBy,}
\DoxyCodeLine{130       AxBz,}
\DoxyCodeLine{131       AyBx,}
\DoxyCodeLine{132       AyBy,}
\DoxyCodeLine{133       AyBz,}
\DoxyCodeLine{134       AzBx,}
\DoxyCodeLine{135       AzBy,}
\DoxyCodeLine{136       AzBz}
\DoxyCodeLine{137     \};}
\DoxyCodeLine{138 }
\DoxyCodeLine{139     \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{140     \textcolor{comment}{/* End of Basis Formatting for Libcint */}}
\DoxyCodeLine{141     \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{142 }
\DoxyCodeLine{143 }
\DoxyCodeLine{144     \textcolor{comment}{// Get threads result buffer}}
\DoxyCodeLine{145     \textcolor{keywordtype}{size\_t} buffN4 = buffSize*buffSize*buffSize*buffSize;}
\DoxyCodeLine{146 }
\DoxyCodeLine{147     \textcolor{comment}{// 81 is for fourth-\/derivative; 9 for second derivative}}
\DoxyCodeLine{148     \textcolor{keywordtype}{int} nERI;}
\DoxyCodeLine{149     \textcolor{keywordtype}{double} *buffAll = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{150     \textcolor{keywordtype}{double} *cacheAll = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{151     \textcolor{keywordtype}{double} *ERIBuffer = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{152 }
\DoxyCodeLine{153     \textcolor{keywordtype}{size\_t} maxShellSize = buffSize;}
\DoxyCodeLine{154     \textcolor{keywordtype}{size\_t} NB  = maxShellSize*4;}
\DoxyCodeLine{155     \textcolor{keywordtype}{size\_t} NB2 = NB*NB;}
\DoxyCodeLine{156     \textcolor{keywordtype}{size\_t} NB3 = NB2*NB;}
\DoxyCodeLine{157     \textcolor{keywordtype}{size\_t} NB4 = NB2*NB2;}
\DoxyCodeLine{158     \textcolor{keywordtype}{size\_t} NB4\_2 = 2*NB4;}
\DoxyCodeLine{159     \textcolor{keywordtype}{size\_t} NB4\_3 = 3*NB4;}
\DoxyCodeLine{160 }
\DoxyCodeLine{161     \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} nBasis   = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a40ad4a89b440bf71e0ef6ba317d8123f}{nBasis}};}
\DoxyCodeLine{162     \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} nShell   = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a936871b121472a416ee6f947ccdea4b4}{nShell}};}
\DoxyCodeLine{163 }
\DoxyCodeLine{164 }
\DoxyCodeLine{165     }
\DoxyCodeLine{166     \textcolor{comment}{// initialize AX and allocate scratch space}}
\DoxyCodeLine{167 }
\DoxyCodeLine{168     \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} iMat = 0; iMat < nMat; iMat++) \{}
\DoxyCodeLine{169       matList[iMat].AX-\/>clear(); }
\DoxyCodeLine{170     \}}
\DoxyCodeLine{171    }
\DoxyCodeLine{172     \textcolor{comment}{// make copies for each thread}}
\DoxyCodeLine{173     std::vector<std::vector<std::shared\_ptr<PauliSpinorSquareMatrices<MatsT>>>> AXthreads;}
\DoxyCodeLine{174     \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} iTh = 0; iTh < nThreads; iTh++) \{}
\DoxyCodeLine{175       AXthreads.emplace\_back();}
\DoxyCodeLine{176       \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} iMat = 0; iMat < nMat; iMat++) \{}
\DoxyCodeLine{177         AXthreads.back().push\_back(}
\DoxyCodeLine{178           std::make\_shared<\mbox{\hyperlink{classChronusQ_1_1PauliSpinorSquareMatrices}{PauliSpinorSquareMatrices<MatsT>}}>(memManager\_, nBasis, }
\DoxyCodeLine{179             matList[iMat].AX-\/>hasZ(), matList[iMat].AX-\/>hasXY())); }
\DoxyCodeLine{180       \}}
\DoxyCodeLine{181     \}}
\DoxyCodeLine{182 }
\DoxyCodeLine{183     \mbox{\hyperlink{namespaceChronusQ_a7b13ac1d1109f4a015feaab04cb3eaee}{SetLAThreads}}(1); \textcolor{comment}{// Turn off parallelism in LA functions}}
\DoxyCodeLine{184     }
\DoxyCodeLine{185 \textcolor{preprocessor}{    \#pragma omp parallel for}}
\DoxyCodeLine{186     \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} iTh = 0; iTh < nThreads; iTh++) }
\DoxyCodeLine{187     \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} iMat = 0; iMat < nMat; iMat++)}
\DoxyCodeLine{188       AXthreads[iTh][iMat]-\/>clear();}
\DoxyCodeLine{189     }
\DoxyCodeLine{190     \mbox{\hyperlink{namespaceChronusQ_a7b13ac1d1109f4a015feaab04cb3eaee}{SetLAThreads}}(LAThreads);\textcolor{comment}{// Turn threads for LA back on}}
\DoxyCodeLine{191     }
\DoxyCodeLine{192     }
\DoxyCodeLine{193     }
\DoxyCodeLine{194 \textcolor{comment}{    /************************************/}}
\DoxyCodeLine{195     \textcolor{comment}{/*                                  */}}
\DoxyCodeLine{196     \textcolor{comment}{/* Preparation of Schwarz ERI       */}}
\DoxyCodeLine{197     \textcolor{comment}{/*                                  */}}
\DoxyCodeLine{198 \textcolor{comment}{    /************************************/}}
\DoxyCodeLine{199 }
\DoxyCodeLine{200 }
\DoxyCodeLine{201     \textcolor{keywordtype}{double} *SchwarzERI = \textcolor{keyword}{nullptr}, *SchwarzSSSS = \textcolor{keyword}{nullptr}, }
\DoxyCodeLine{202       *SchwarzGaunt = \textcolor{keyword}{nullptr}, *SchwarzGauge = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{203 }
\DoxyCodeLine{204     \textcolor{keywordflow}{if}(matList[0].contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba8578053891caf9c4af3c665d73fa43ac}{TWOBODY\_CONTRACTION\_TYPE::BARE\_COULOMB}} or}
\DoxyCodeLine{205        matList[0].contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba1d269d4b7d6c561fc04b81a2a178e2a5}{TWOBODY\_CONTRACTION\_TYPE::LLLL}} or}
\DoxyCodeLine{206        matList[0].contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cbad5017ac8c585ad30ff49af6467d2efc6}{TWOBODY\_CONTRACTION\_TYPE::LLSS}}) \{}
\DoxyCodeLine{207 \textcolor{comment}{//      if(SchwarzERI == nullptr) eri.computeSchwarz();}}
\DoxyCodeLine{208   }
\DoxyCodeLine{209 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{210       \textcolor{keyword}{auto} topERIchwarz = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{211 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{212   }
\DoxyCodeLine{213       nERI = 1;}
\DoxyCodeLine{214       buffAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(nERI*buffN4*nThreads);}
\DoxyCodeLine{215       cacheAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(cache\_size*nThreads);}
\DoxyCodeLine{216       SchwarzERI = memManager\_.malloc<\textcolor{keywordtype}{double}>(nShell*nShell);}
\DoxyCodeLine{217       memset(SchwarzERI,0,nShell*nShell*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{218   }
\DoxyCodeLine{219 \textcolor{preprocessor}{      \#pragma omp parallel}}
\DoxyCodeLine{220       \{}
\DoxyCodeLine{221   }
\DoxyCodeLine{222         \textcolor{keywordtype}{size\_t} thread\_id = \mbox{\hyperlink{namespaceChronusQ_aa348a017ee78c3450480773ddc542e5c}{GetThreadID}}();}
\DoxyCodeLine{223         \textcolor{keywordtype}{size\_t} n1,n2;}
\DoxyCodeLine{224   }
\DoxyCodeLine{225         \textcolor{keywordtype}{int} shls[4];}
\DoxyCodeLine{226         \textcolor{keywordtype}{double} *buff = \&buffAll[nERI*buffN4*thread\_id];}
\DoxyCodeLine{227         \textcolor{keywordtype}{double} *cache = cacheAll+cache\_size*thread\_id;}
\DoxyCodeLine{228   }
\DoxyCodeLine{229         \textcolor{comment}{// set up Schwarz screening}}
\DoxyCodeLine{230         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s1(0), bf1\_s(0), s12(0); s1 < basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a936871b121472a416ee6f947ccdea4b4}{nShell}}; bf1\_s+=n1, s1++) \{ }
\DoxyCodeLine{231   }
\DoxyCodeLine{232           n1 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s1].size(); \textcolor{comment}{// Size of Shell 1}}
\DoxyCodeLine{233   }
\DoxyCodeLine{234         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s2(0), bf2\_s(0); s2 <= s1; bf2\_s+=n2, s2++, s12++) \{}
\DoxyCodeLine{235   }
\DoxyCodeLine{236           n2 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s2].size(); \textcolor{comment}{// Size of Shell 2}}
\DoxyCodeLine{237   }
\DoxyCodeLine{238           \textcolor{comment}{// Round Robbin work distribution}}
\DoxyCodeLine{239 \textcolor{preprocessor}{          \#ifdef \_OPENMP}}
\DoxyCodeLine{240           \textcolor{keywordflow}{if}( s12 \% nThreads != thread\_id ) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{241 \textcolor{preprocessor}{          \#endif}}
\DoxyCodeLine{242   }
\DoxyCodeLine{243           shls[0] = int(s1);}
\DoxyCodeLine{244           shls[1] = int(s2);}
\DoxyCodeLine{245           shls[2] = int(s1);}
\DoxyCodeLine{246           shls[3] = int(s2);}
\DoxyCodeLine{247   }
\DoxyCodeLine{248           \textcolor{keyword}{auto} nQuad = n1*n2*n1*n2;}
\DoxyCodeLine{249   }
\DoxyCodeLine{250           \textcolor{keywordflow}{if}(int2e\_sph(buff, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, cache)==0) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{251 }
\DoxyCodeLine{252           \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} iERI(0); iERI < nERI*nQuad; iERI++) }
\DoxyCodeLine{253             SchwarzERI[s1+s2*nShell] = std::max(SchwarzERI[s1+s2*nShell], std::abs(buff[iERI]));}
\DoxyCodeLine{254   }
\DoxyCodeLine{255           SchwarzERI[s1+s2*nShell] = std::sqrt(SchwarzERI[s1+s2*nShell]);}
\DoxyCodeLine{256           SchwarzERI[s2+s1*nShell] = SchwarzERI[s1+s2*nShell];}
\DoxyCodeLine{257   }
\DoxyCodeLine{258         \}}
\DoxyCodeLine{259         \}}
\DoxyCodeLine{260   }
\DoxyCodeLine{261       \};}
\DoxyCodeLine{262 }
\DoxyCodeLine{263       memManager\_.free(buffAll, cacheAll);}
\DoxyCodeLine{264   }
\DoxyCodeLine{265 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{266       \textcolor{keyword}{auto} durERIchwarz = \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topERIchwarz);}
\DoxyCodeLine{267       \textcolor{comment}{// std::cout << "{}ERI Schwarz took "{} <<  durERIchwarz << "{} s\(\backslash\)n"{}; }}
\DoxyCodeLine{268   }
\DoxyCodeLine{269       \textcolor{comment}{//std::cout << std::endl;}}
\DoxyCodeLine{270 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{271   }
\DoxyCodeLine{272     \}; \textcolor{comment}{// SchwarzERI}}
\DoxyCodeLine{273 }
\DoxyCodeLine{274     \textcolor{keywordflow}{if}(matList[0].contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cbaf5b0f392e82b90ea1452a00512088d53}{TWOBODY\_CONTRACTION\_TYPE::SSSS}} or }
\DoxyCodeLine{275        matList[0].contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba1d269d4b7d6c561fc04b81a2a178e2a5}{TWOBODY\_CONTRACTION\_TYPE::LLLL}} or}
\DoxyCodeLine{276        matList[0].contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cbad5017ac8c585ad30ff49af6467d2efc6}{TWOBODY\_CONTRACTION\_TYPE::LLSS}}) \{}
\DoxyCodeLine{277   }
\DoxyCodeLine{278 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{279       \textcolor{keyword}{auto} topSSSSSchwarz = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{280 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{281   }
\DoxyCodeLine{282       nERI = 81;}
\DoxyCodeLine{283       buffAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(nERI*buffN4*nThreads);}
\DoxyCodeLine{284       cacheAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(cache\_size*nThreads);}
\DoxyCodeLine{285       SchwarzSSSS = memManager\_.malloc<\textcolor{keywordtype}{double}>(nShell*nShell);}
\DoxyCodeLine{286       memset(SchwarzSSSS,0,nShell*nShell*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{287   }
\DoxyCodeLine{288 \textcolor{preprocessor}{      \#pragma omp parallel}}
\DoxyCodeLine{289       \{}
\DoxyCodeLine{290   }
\DoxyCodeLine{291         \textcolor{keywordtype}{double} C2 = 1./(4*\mbox{\hyperlink{namespaceChronusQ_a387c8ccd4e18ad322b87f75f51fd008d}{SpeedOfLight}}*\mbox{\hyperlink{namespaceChronusQ_a387c8ccd4e18ad322b87f75f51fd008d}{SpeedOfLight}});}
\DoxyCodeLine{292         \textcolor{keywordtype}{size\_t} thread\_id = \mbox{\hyperlink{namespaceChronusQ_aa348a017ee78c3450480773ddc542e5c}{GetThreadID}}();}
\DoxyCodeLine{293         \textcolor{keywordtype}{size\_t} n1,n2;}
\DoxyCodeLine{294   }
\DoxyCodeLine{295         \textcolor{keywordtype}{int} shls[4];}
\DoxyCodeLine{296         \textcolor{keywordtype}{double} *buff = \&buffAll[nERI*buffN4*thread\_id];}
\DoxyCodeLine{297         \textcolor{keywordtype}{double} *cache = cacheAll+cache\_size*thread\_id;}
\DoxyCodeLine{298   }
\DoxyCodeLine{299         \textcolor{comment}{// set up Schwarz screening}}
\DoxyCodeLine{300         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s1(0), bf1\_s(0), s12(0); s1 < basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a936871b121472a416ee6f947ccdea4b4}{nShell}}; bf1\_s+=n1, s1++) \{ }
\DoxyCodeLine{301   }
\DoxyCodeLine{302           n1 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s1].size(); \textcolor{comment}{// Size of Shell 1}}
\DoxyCodeLine{303   }
\DoxyCodeLine{304         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s2(0), bf2\_s(0); s2 <= s1; bf2\_s+=n2, s2++, s12++) \{}
\DoxyCodeLine{305   }
\DoxyCodeLine{306           n2 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s2].size(); \textcolor{comment}{// Size of Shell 2}}
\DoxyCodeLine{307   }
\DoxyCodeLine{308           \textcolor{comment}{// Round Robbin work distribution}}
\DoxyCodeLine{309 \textcolor{preprocessor}{          \#ifdef \_OPENMP}}
\DoxyCodeLine{310           \textcolor{keywordflow}{if}( s12 \% nThreads != thread\_id ) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{311 \textcolor{preprocessor}{          \#endif}}
\DoxyCodeLine{312   }
\DoxyCodeLine{313           shls[0] = int(s1);}
\DoxyCodeLine{314           shls[1] = int(s2);}
\DoxyCodeLine{315           shls[2] = int(s1);}
\DoxyCodeLine{316           shls[3] = int(s2);}
\DoxyCodeLine{317   }
\DoxyCodeLine{318           \textcolor{keyword}{auto} nQuad = n1*n2*n1*n2;}
\DoxyCodeLine{319   }
\DoxyCodeLine{320           \textcolor{keywordflow}{if}(int2e\_ipvip1ipvip2\_sph(buff, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, cache)==0) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{321 }
\DoxyCodeLine{322           \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} iERI(0); iERI < nERI*nQuad; iERI++) }
\DoxyCodeLine{323             SchwarzSSSS[s1+s2*nShell] = std::max(SchwarzSSSS[s1+s2*nShell], std::abs(buff[iERI]));}
\DoxyCodeLine{324   }
\DoxyCodeLine{325           SchwarzSSSS[s1+s2*nShell] = C2*std::sqrt(SchwarzSSSS[s1+s2*nShell]);}
\DoxyCodeLine{326           SchwarzSSSS[s2+s1*nShell] = SchwarzSSSS[s1+s2*nShell];}
\DoxyCodeLine{327   }
\DoxyCodeLine{328         \}}
\DoxyCodeLine{329         \}}
\DoxyCodeLine{330   }
\DoxyCodeLine{331       \};}
\DoxyCodeLine{332 }
\DoxyCodeLine{333       memManager\_.free(buffAll, cacheAll);}
\DoxyCodeLine{334   }
\DoxyCodeLine{335 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{336       \textcolor{keyword}{auto} durSSSSSchwarz = \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topSSSSSchwarz);}
\DoxyCodeLine{337 \textcolor{comment}{//      std::cout << "{}∇A∇B∇C∇D Schwarz took "{} <<  durSSSSSchwarz << "{} s\(\backslash\)n"{}; }}
\DoxyCodeLine{338   }
\DoxyCodeLine{339       \textcolor{comment}{//std::cout << std::endl;}}
\DoxyCodeLine{340 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{341   }
\DoxyCodeLine{342     \}; \textcolor{comment}{//ShwarzSSSS}}
\DoxyCodeLine{343     }
\DoxyCodeLine{344     \textcolor{keywordflow}{if}( matList[0].contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba619fb0d8a58386d6c365eb7fa1bae867}{TWOBODY\_CONTRACTION\_TYPE::GAUNT}} ) \{}
\DoxyCodeLine{345     }
\DoxyCodeLine{346 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{347       \textcolor{keyword}{auto} topGauntSchwarz = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{348 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{349       }
\DoxyCodeLine{350       nERI = 9;}
\DoxyCodeLine{351       buffAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(nERI*buffN4*nThreads);}
\DoxyCodeLine{352       cacheAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(cache\_size*nThreads);}
\DoxyCodeLine{353       SchwarzGaunt = memManager\_.malloc<\textcolor{keywordtype}{double}>(nShell*nShell);}
\DoxyCodeLine{354       memset(SchwarzGaunt,0,nShell*nShell*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{355     }
\DoxyCodeLine{356 \textcolor{preprocessor}{      \#pragma omp parallel}}
\DoxyCodeLine{357       \{}
\DoxyCodeLine{358   }
\DoxyCodeLine{359         \textcolor{keywordtype}{double} C1 = 1./(2*\mbox{\hyperlink{namespaceChronusQ_a387c8ccd4e18ad322b87f75f51fd008d}{SpeedOfLight}});}
\DoxyCodeLine{360         \textcolor{keywordtype}{size\_t} thread\_id = \mbox{\hyperlink{namespaceChronusQ_aa348a017ee78c3450480773ddc542e5c}{GetThreadID}}();}
\DoxyCodeLine{361         \textcolor{keywordtype}{size\_t} n1,n2;}
\DoxyCodeLine{362   }
\DoxyCodeLine{363         \textcolor{keywordtype}{int} shls[4];}
\DoxyCodeLine{364         \textcolor{keywordtype}{double} *buff = \&buffAll[nERI*buffN4*thread\_id];}
\DoxyCodeLine{365         \textcolor{keywordtype}{double} *cache = cacheAll+cache\_size*thread\_id;}
\DoxyCodeLine{366   }
\DoxyCodeLine{367         \textcolor{comment}{// set up Schwarz screening}}
\DoxyCodeLine{368         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s1(0), bf1\_s(0), s12(0); s1 < nShell; bf1\_s+=n1, s1++) \{ }
\DoxyCodeLine{369   }
\DoxyCodeLine{370           n1 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s1].size(); \textcolor{comment}{// Size of Shell 1}}
\DoxyCodeLine{371   }
\DoxyCodeLine{372         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s2(0), bf2\_s(0); s2 < nShell; bf2\_s+=n2, s2++, s12++) \{}
\DoxyCodeLine{373   }
\DoxyCodeLine{374           n2 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s2].size(); \textcolor{comment}{// Size of Shell 2}}
\DoxyCodeLine{375   }
\DoxyCodeLine{376           \textcolor{comment}{// Round Robbin work distribution}}
\DoxyCodeLine{377 \textcolor{preprocessor}{          \#ifdef \_OPENMP}}
\DoxyCodeLine{378           \textcolor{keywordflow}{if}( s12 \% nThreads != thread\_id ) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{379 \textcolor{preprocessor}{          \#endif}}
\DoxyCodeLine{380   }
\DoxyCodeLine{381           shls[0] = int(s1);}
\DoxyCodeLine{382           shls[1] = int(s2);}
\DoxyCodeLine{383           shls[2] = int(s1);}
\DoxyCodeLine{384           shls[3] = int(s2);}
\DoxyCodeLine{385   }
\DoxyCodeLine{386           \textcolor{keyword}{auto} nQuad = n1*n2*n1*n2;}
\DoxyCodeLine{387   }
\DoxyCodeLine{388           \textcolor{keywordflow}{if}(int2e\_ip1ip2\_sph(buff, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, cache)==0) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{389 }
\DoxyCodeLine{390           \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} iERI(0); iERI < nERI*nQuad; iERI++) }
\DoxyCodeLine{391               SchwarzGaunt[s1+s2*nShell] = std::max(SchwarzGaunt[s1+s2*nShell], std::abs(buff[iERI]));}
\DoxyCodeLine{392   }
\DoxyCodeLine{393           SchwarzGaunt[s1+s2*nShell] = C1*std::sqrt(SchwarzGaunt[s1+s2*nShell]);}
\DoxyCodeLine{394   }
\DoxyCodeLine{395         \}}
\DoxyCodeLine{396         \}}
\DoxyCodeLine{397   }
\DoxyCodeLine{398       \};}
\DoxyCodeLine{399       }
\DoxyCodeLine{400       memManager\_.free(buffAll, cacheAll);}
\DoxyCodeLine{401 }
\DoxyCodeLine{402 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{403       \textcolor{keyword}{auto} durGauntSchwarz = \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topGauntSchwarz);}
\DoxyCodeLine{404 \textcolor{comment}{//      std::cout << "{}Gaunt Schwarz took "{} <<  durGauntchwarz << "{} s\(\backslash\)n"{}; }}
\DoxyCodeLine{405   }
\DoxyCodeLine{406       \textcolor{comment}{//std::cout << std::endl;}}
\DoxyCodeLine{407 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{408     }
\DoxyCodeLine{409     \}; \textcolor{comment}{// ShwarzGaunt }}
\DoxyCodeLine{410 }
\DoxyCodeLine{411     \textcolor{keywordflow}{if}( matList[0].contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba01337b51d63cd7bba6d5daf63ff8d911}{TWOBODY\_CONTRACTION\_TYPE::GAUGE}} ) \{}
\DoxyCodeLine{412     }
\DoxyCodeLine{413 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{414       \textcolor{keyword}{auto} topGaugeSchwarz = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{415 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{416     }
\DoxyCodeLine{417       nERI = 16;}
\DoxyCodeLine{418       buffAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(2*nERI*buffN4*nThreads);}
\DoxyCodeLine{419       cacheAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(cache\_size*nThreads);}
\DoxyCodeLine{420       }
\DoxyCodeLine{421       SchwarzGauge = memManager\_.malloc<\textcolor{keywordtype}{double}>(nShell*nShell);}
\DoxyCodeLine{422       memset(SchwarzGauge,0,nShell*nShell*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{423       }
\DoxyCodeLine{424 \textcolor{preprocessor}{      \#pragma omp parallel}}
\DoxyCodeLine{425       \{}
\DoxyCodeLine{426   }
\DoxyCodeLine{427         \textcolor{keywordtype}{double} C1 = 1./(2*\mbox{\hyperlink{namespaceChronusQ_a387c8ccd4e18ad322b87f75f51fd008d}{SpeedOfLight}});}
\DoxyCodeLine{428         \textcolor{keywordtype}{size\_t} thread\_id = \mbox{\hyperlink{namespaceChronusQ_aa348a017ee78c3450480773ddc542e5c}{GetThreadID}}();}
\DoxyCodeLine{429         \textcolor{keywordtype}{size\_t} n1,n2;}
\DoxyCodeLine{430         \textcolor{keywordtype}{int} skiperi1,skiperi2;}
\DoxyCodeLine{431   }
\DoxyCodeLine{432         \textcolor{keywordtype}{int} shls[4];}
\DoxyCodeLine{433         \textcolor{keywordtype}{double} *buffr1 = buffAll+nERI*buffN4*thread\_id;}
\DoxyCodeLine{434         \textcolor{keywordtype}{double} *buffr2 = buffAll+nERI*nThreads*buffN4+nERI*buffN4*thread\_id;}
\DoxyCodeLine{435         \textcolor{keywordtype}{double} *cache = cacheAll+cache\_size*thread\_id;}
\DoxyCodeLine{436   }
\DoxyCodeLine{437         \textcolor{comment}{// set up Schwarz screening}}
\DoxyCodeLine{438         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s1(0), bf1\_s(0), s12(0); s1 < nShell; bf1\_s+=n1, s1++) \{ }
\DoxyCodeLine{439   }
\DoxyCodeLine{440           n1 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s1].size(); \textcolor{comment}{// Size of Shell 1}}
\DoxyCodeLine{441   }
\DoxyCodeLine{442         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s2(0), bf2\_s(0); s2 < nShell; bf2\_s+=n2, s2++, s12++) \{}
\DoxyCodeLine{443   }
\DoxyCodeLine{444           n2 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s2].size(); \textcolor{comment}{// Size of Shell 2}}
\DoxyCodeLine{445   }
\DoxyCodeLine{446           \textcolor{comment}{// Round Robbin work distribution}}
\DoxyCodeLine{447 \textcolor{preprocessor}{          \#ifdef \_OPENMP}}
\DoxyCodeLine{448           \textcolor{keywordflow}{if}( s12 \% nThreads != thread\_id ) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{449 \textcolor{preprocessor}{          \#endif}}
\DoxyCodeLine{450   }
\DoxyCodeLine{451           shls[0] = int(s1);}
\DoxyCodeLine{452           shls[1] = int(s2);}
\DoxyCodeLine{453           shls[2] = int(s1);}
\DoxyCodeLine{454           shls[3] = int(s2);}
\DoxyCodeLine{455   }
\DoxyCodeLine{456           \textcolor{keyword}{auto} nQuad = n1*n2*n1*n2;}
\DoxyCodeLine{457 }
\DoxyCodeLine{458           \textcolor{comment}{//∇B∇D}}
\DoxyCodeLine{459           skiperi1 = int2e\_gauge\_r1\_ssp1ssp2\_sph(buffr1, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, cache);}
\DoxyCodeLine{460           skiperi2 = int2e\_gauge\_r2\_ssp1ssp2\_sph(buffr2, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, cache);}
\DoxyCodeLine{461 }
\DoxyCodeLine{462           \textcolor{keywordflow}{if}(skiperi1==0 and skiperi2==0) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{463 }
\DoxyCodeLine{464           \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} iERI(0); iERI < nERI*nQuad; iERI++) }
\DoxyCodeLine{465               SchwarzGauge[s1+s2*nShell] = std::max(SchwarzGauge[s1+s2*nShell], std::abs(buffr1[iERI]-\/buffr2[iERI]));}
\DoxyCodeLine{466   }
\DoxyCodeLine{467           SchwarzGauge[s1+s2*nShell] = C1*std::sqrt(SchwarzGauge[s1+s2*nShell]);}
\DoxyCodeLine{468   }
\DoxyCodeLine{469         \}}
\DoxyCodeLine{470         \}}
\DoxyCodeLine{471   }
\DoxyCodeLine{472       \};}
\DoxyCodeLine{473       }
\DoxyCodeLine{474       memManager\_.free(buffAll, cacheAll);}
\DoxyCodeLine{475 }
\DoxyCodeLine{476 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{477       \textcolor{keyword}{auto} durGaugeSchwarz = \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topGaugeSchwarz);}
\DoxyCodeLine{478 \textcolor{comment}{//      std::cout << "{}Gauge Schwarz took "{} <<  durGaugechwarz << "{} s\(\backslash\)n"{}; }}
\DoxyCodeLine{479   }
\DoxyCodeLine{480       \textcolor{comment}{//std::cout << std::endl;}}
\DoxyCodeLine{481 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{482     }
\DoxyCodeLine{483     \}; \textcolor{comment}{// ShwarzGauge }}
\DoxyCodeLine{484     }
\DoxyCodeLine{485 \textcolor{comment}{    /****************************************/}}
\DoxyCodeLine{486     \textcolor{comment}{/*                                      */}}
\DoxyCodeLine{487     \textcolor{comment}{/* End Preparation of Schwarz ERIs      */}}
\DoxyCodeLine{488     \textcolor{comment}{/*                                      */}}
\DoxyCodeLine{489 \textcolor{comment}{    /****************************************/}}
\DoxyCodeLine{490     }
\DoxyCodeLine{491 }
\DoxyCodeLine{492 \textcolor{preprocessor}{\#ifdef \_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{493 \textcolor{comment}{    /******************************************************/}}
\DoxyCodeLine{494     \textcolor{comment}{/*                                                    */}}
\DoxyCodeLine{495     \textcolor{comment}{/*Compute shell block norms (∞-\/norm) of all matList.X */}}
\DoxyCodeLine{496     \textcolor{comment}{/*                                                    */}}
\DoxyCodeLine{497 \textcolor{comment}{    /******************************************************/}}
\DoxyCodeLine{498     }
\DoxyCodeLine{499   }
\DoxyCodeLine{500       \textcolor{comment}{// check Densitry matrices}}
\DoxyCodeLine{501       \textcolor{keywordtype}{double} * ShBlkNorms\_raw = memManager\_.malloc<\textcolor{keywordtype}{double}>((nBatch+1)*nShell*nShell);}
\DoxyCodeLine{502       \textcolor{keywordtype}{double} * ShBlkNorms = ShBlkNorms\_raw;}
\DoxyCodeLine{503       std::vector<double*> ShBlkNorms\_batch;}
\DoxyCodeLine{504       \{ }
\DoxyCodeLine{505         \textcolor{keywordtype}{double} * ShBlkNormsSCR = memManager\_.malloc<\textcolor{keywordtype}{double}>(nShell*nShell*nThreads);}
\DoxyCodeLine{506         std::vector<double*> ShBlkNormsSCR\_batch;}
\DoxyCodeLine{507         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iBatch = 0ul; iBatch < nBatch; iBatch++) }
\DoxyCodeLine{508           ShBlkNorms\_batch.push\_back(ShBlkNorms\_raw+(iBatch+1)*nShell*nShell);}
\DoxyCodeLine{509         }
\DoxyCodeLine{510         \textcolor{keywordflow}{for}( \textcolor{keyword}{auto} iTh = 0ul; iTh < nThreads; iTh++)}
\DoxyCodeLine{511           ShBlkNormsSCR\_batch.push\_back(ShBlkNormsSCR+iTh*nShell*nShell); }
\DoxyCodeLine{512         }
\DoxyCodeLine{513         memset(ShBlkNorms\_raw,0.,(nBatch+1)*nShell*nShell*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{514       }
\DoxyCodeLine{515 \textcolor{preprocessor}{        \#define POPMAX\_SHELLBLOCKNORMS(DEN) \(\backslash\)}}
\DoxyCodeLine{516 \textcolor{preprocessor}{          ShellBlockNorm(basisSet\_.shells, DEN, nBasis, ShBlkNormsSCR\_i); \(\backslash\)}}
\DoxyCodeLine{517 \textcolor{preprocessor}{          for (auto i = 0ul; i < nShell*nShell; i++) \{ \(\backslash\)}}
\DoxyCodeLine{518 \textcolor{preprocessor}{            ShBlkNorms\_i[i] = std::max(ShBlkNorms\_i[i],std::abs(ShBlkNormsSCR\_i[i])); \(\backslash\)}}
\DoxyCodeLine{519 \textcolor{preprocessor}{          \}}}
\DoxyCodeLine{520         }
\DoxyCodeLine{521         \mbox{\hyperlink{namespaceChronusQ_a7b13ac1d1109f4a015feaab04cb3eaee}{SetLAThreads}}(1); \textcolor{comment}{// Turn off parallelism in LA functions}}
\DoxyCodeLine{522         }
\DoxyCodeLine{523 \textcolor{preprocessor}{        \#pragma omp parallel for }}
\DoxyCodeLine{524         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iBatch = 0ul; iBatch < nBatch; iBatch++) \{ }
\DoxyCodeLine{525           \textcolor{keyword}{auto} matOff = iBatch*mMat;}
\DoxyCodeLine{526           \textcolor{keyword}{auto} ShBlkNorms\_i    = ShBlkNorms\_batch[iBatch]; }
\DoxyCodeLine{527           \textcolor{keyword}{auto} ShBlkNormsSCR\_i = ShBlkNormsSCR\_batch[\mbox{\hyperlink{namespaceChronusQ_aa348a017ee78c3450480773ddc542e5c}{GetThreadID}}()]; }
\DoxyCodeLine{528           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iMat = 0ul; iMat < mMat; iMat++) \{}
\DoxyCodeLine{529             \textcolor{keyword}{auto} matX = matList[iMat + matOff].X;  }
\DoxyCodeLine{530             POPMAX\_SHELLBLOCKNORMS(matX-\/>S().pointer()); }
\DoxyCodeLine{531             \textcolor{keywordflow}{if} (matX-\/>hasZ()) POPMAX\_SHELLBLOCKNORMS(matX-\/>Z().pointer());}
\DoxyCodeLine{532             \textcolor{keywordflow}{if} (matX-\/>hasXY()) \{ }
\DoxyCodeLine{533               POPMAX\_SHELLBLOCKNORMS(matX-\/>Y().pointer());}
\DoxyCodeLine{534               POPMAX\_SHELLBLOCKNORMS(matX-\/>X().pointer());}
\DoxyCodeLine{535             \} }
\DoxyCodeLine{536           \}}
\DoxyCodeLine{537           }
\DoxyCodeLine{538           \textcolor{comment}{// symmetrize nonHermitian ShBlkNorms  ?? }}
\DoxyCodeLine{539           \textcolor{keywordflow}{if} (not HerDen) \{}
\DoxyCodeLine{540             \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} k = 0ul; k < nShell; k++)}
\DoxyCodeLine{541             \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} l = 0ul; l < k     ; l++) \{}
\DoxyCodeLine{542               \textcolor{keywordtype}{double} mx = std::max(ShBlkNorms\_i[k + l*nShell], ShBlkNorms\_i[l + k*nShell]);}
\DoxyCodeLine{543               ShBlkNorms\_i[k + l*nShell] = mx;}
\DoxyCodeLine{544               ShBlkNorms\_i[l + k*nShell] = mx;}
\DoxyCodeLine{545             \}}
\DoxyCodeLine{546           \}}
\DoxyCodeLine{547         \}}
\DoxyCodeLine{548         }
\DoxyCodeLine{549         \mbox{\hyperlink{namespaceChronusQ_a7b13ac1d1109f4a015feaab04cb3eaee}{SetLAThreads}}(LAThreads);\textcolor{comment}{// Turn threads for LA back on}}
\DoxyCodeLine{550         memManager\_.free(ShBlkNormsSCR);}
\DoxyCodeLine{551         }
\DoxyCodeLine{552         \textcolor{comment}{// get the maximum from all batches }}
\DoxyCodeLine{553 \textcolor{preprocessor}{        \#pragma omp parallel for }}
\DoxyCodeLine{554         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} i = 0ul; i < nShell*nShell; i++) }
\DoxyCodeLine{555         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iBatch = 0ul; iBatch < nBatch; iBatch++) }
\DoxyCodeLine{556           ShBlkNorms[i] = std::max(ShBlkNorms\_batch[iBatch][i], ShBlkNorms[i]); }
\DoxyCodeLine{557         }
\DoxyCodeLine{558       \} }
\DoxyCodeLine{559 \textcolor{comment}{    /******************************************************/}}
\DoxyCodeLine{560     \textcolor{comment}{/*                                                    */}}
\DoxyCodeLine{561     \textcolor{comment}{/*End of Compute shell block norms (∞-\/norm) of all matList.X */}}
\DoxyCodeLine{562     \textcolor{comment}{/*                                                    */}}
\DoxyCodeLine{563 \textcolor{comment}{    /******************************************************/}}
\DoxyCodeLine{564 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{565     }
\DoxyCodeLine{566 \textcolor{comment}{    /***********************************/}}
\DoxyCodeLine{567     \textcolor{comment}{/*                                 */}}
\DoxyCodeLine{568     \textcolor{comment}{/* Start of Bare-\/Coulomb           */}}
\DoxyCodeLine{569     \textcolor{comment}{/*                                 */}}
\DoxyCodeLine{570 \textcolor{comment}{    /***********************************/}}
\DoxyCodeLine{571   }
\DoxyCodeLine{572     \textcolor{keywordflow}{if}( matList[0].contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba8578053891caf9c4af3c665d73fa43ac}{TWOBODY\_CONTRACTION\_TYPE::BARE\_COULOMB}} ) \{}
\DoxyCodeLine{573   }
\DoxyCodeLine{574 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{575       \textcolor{keyword}{auto} topDirect = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{576       std::vector<double> durDirectInt(nThreads, 0.);}
\DoxyCodeLine{577       std::vector<double> durDirectCon(nThreads, 0.);}
\DoxyCodeLine{578 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{579   }
\DoxyCodeLine{580       \textcolor{comment}{// Keeping track of number of integrals and contraction skipped}}
\DoxyCodeLine{581       std::vector<size\_t> nIntSkip(nThreads,0);}
\DoxyCodeLine{582 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C      }}
\DoxyCodeLine{583       std::vector<size\_t> nConSkip(nThreads,0);}
\DoxyCodeLine{584 \textcolor{preprocessor}{\#endif    }}
\DoxyCodeLine{585       nERI = 1;}
\DoxyCodeLine{586       buffAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(nERI*buffN4*nThreads);}
\DoxyCodeLine{587       cacheAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(cache\_size*nThreads);}
\DoxyCodeLine{588       }
\DoxyCodeLine{589 \textcolor{preprocessor}{      \#pragma omp parallel}}
\DoxyCodeLine{590       \{}
\DoxyCodeLine{591         \textcolor{keywordtype}{int} thread\_id = \mbox{\hyperlink{namespaceChronusQ_aa348a017ee78c3450480773ddc542e5c}{GetThreadID}}();}
\DoxyCodeLine{592         }
\DoxyCodeLine{593         \textcolor{keyword}{auto} \&AX\_loc = AXthreads[thread\_id];}
\DoxyCodeLine{594         }
\DoxyCodeLine{595         \textcolor{keywordtype}{size\_t} n1,n2,n3,n4,m,n,k,l,mnkl,bf1,bf2,bf3,bf4;}
\DoxyCodeLine{596         \textcolor{keywordtype}{size\_t} bf43,bf34,bf21,bf12;}
\DoxyCodeLine{597         \textcolor{keywordtype}{size\_t} s4\_max;}
\DoxyCodeLine{598         \textcolor{keywordtype}{int} shls[4];}
\DoxyCodeLine{599         \textcolor{keywordtype}{double} *buff = \&buffAll[buffN4*thread\_id];}
\DoxyCodeLine{600         \textcolor{keywordtype}{double} *cache = cacheAll+cache\_size*thread\_id;}
\DoxyCodeLine{601         }
\DoxyCodeLine{602         MatsT *ADCLLMS, *symmDCLLMS; }
\DoxyCodeLine{603         std::vector<size\_t> contract\_batch(nBatch);}
\DoxyCodeLine{604         \textcolor{keywordtype}{size\_t} iCon, nCon, matOff;}
\DoxyCodeLine{605 }
\DoxyCodeLine{606 \textcolor{preprocessor}{\#if defined(\_SHZ\_SCREEN\_4C) \&\& defined(\_SEPARATED\_SHZ\_SCREEN\_4C)}}
\DoxyCodeLine{607         std::vector<double> shMax123\_batch(nBatch);}
\DoxyCodeLine{608 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{609         std::iota(contract\_batch.begin(), contract\_batch.end(), 0);}
\DoxyCodeLine{610         nCon = nBatch;}
\DoxyCodeLine{611 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{612 }
\DoxyCodeLine{613         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s1(0), bf1\_s(0), s1234(0); s1 < nShells; }
\DoxyCodeLine{614             bf1\_s+=n1, s1++) \{ }
\DoxyCodeLine{615   }
\DoxyCodeLine{616           n1 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s1].size(); \textcolor{comment}{// Size of Shell 1}}
\DoxyCodeLine{617   }
\DoxyCodeLine{618         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s2(0), bf2\_s(0); s2 <= s1; bf2\_s+=n2, s2++) \{}
\DoxyCodeLine{619   }
\DoxyCodeLine{620           n2 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s2].size(); \textcolor{comment}{// Size of Shell 2}}
\DoxyCodeLine{621           \textcolor{comment}{// Deneneracy factor for s1,s2 pair}}
\DoxyCodeLine{622           \textcolor{keywordtype}{double} s12\_deg = (s1 == s2) ? 1.0 : 2.0;}
\DoxyCodeLine{623 }
\DoxyCodeLine{624 \textcolor{preprocessor}{\#ifdef \_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{625           \textcolor{keywordtype}{double} shMax12 = ShBlkNorms[s1 + s2*nShell];}
\DoxyCodeLine{626 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{627   }
\DoxyCodeLine{628         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s3(0), bf3\_s(0); s3 <= s1; bf3\_s+=n3, s3++) \{}
\DoxyCodeLine{629   }
\DoxyCodeLine{630           n3 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s3].size(); \textcolor{comment}{// Size of Shell 3}}
\DoxyCodeLine{631           s4\_max = (s1 == s3) ? s2 : s3; \textcolor{comment}{// Determine the unique max of Shell 4}}
\DoxyCodeLine{632 }
\DoxyCodeLine{633 \textcolor{preprocessor}{\#ifdef \_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{634           \textcolor{keywordtype}{double} shMax123 = std::max(ShBlkNorms[s1 + s3*nShell], }
\DoxyCodeLine{635                                      ShBlkNorms[s2 + s3*nShell]);}
\DoxyCodeLine{636 }
\DoxyCodeLine{637           shMax123 = std::max(shMax123,shMax12);}
\DoxyCodeLine{638 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{639           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iBatch = 0ul; iBatch < nBatch; iBatch++)}
\DoxyCodeLine{640              shMax123\_batch[iBatch] = }
\DoxyCodeLine{641                std::max(ShBlkNorms\_batch[iBatch][s1 + s2*nShell],}
\DoxyCodeLine{642                std::max(ShBlkNorms\_batch[iBatch][s1 + s3*nShell],}
\DoxyCodeLine{643                         ShBlkNorms\_batch[iBatch][s2 + s3*nShell]));}
\DoxyCodeLine{644 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{645 \textcolor{preprocessor}{\#endif }}
\DoxyCodeLine{646 }
\DoxyCodeLine{647         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s4(0), bf4\_s(0); s4 <= s4\_max; bf4\_s+=n4, s4++, s1234++) \{}
\DoxyCodeLine{648   }
\DoxyCodeLine{649           n4 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s4].size(); \textcolor{comment}{// Size of Shell 4}}
\DoxyCodeLine{650   }
\DoxyCodeLine{651           \textcolor{comment}{// Round Robbin work distribution}}
\DoxyCodeLine{652 \textcolor{preprocessor}{          \#ifdef \_OPENMP}}
\DoxyCodeLine{653           \textcolor{keywordflow}{if}( s1234 \% nThreads != thread\_id ) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{654 \textcolor{preprocessor}{          \#endif}}
\DoxyCodeLine{655   }
\DoxyCodeLine{656 \textcolor{preprocessor}{\#ifdef \_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{657           \textcolor{keywordtype}{double} shMax = std::max(ShBlkNorms[s1 + s4*nShell],}
\DoxyCodeLine{658                          std::max(ShBlkNorms[s2 + s4*nShell],}
\DoxyCodeLine{659                                   ShBlkNorms[s3 + s4*nShell]));}
\DoxyCodeLine{660 }
\DoxyCodeLine{661           shMax = std::max(shMax,shMax123);}
\DoxyCodeLine{662 }
\DoxyCodeLine{663           \textcolor{keywordflow}{if}((shMax*SchwarzERI[s1+s2*nShell]*SchwarzERI[s3+s4*nShell]) <}
\DoxyCodeLine{664               eri.\mbox{\hyperlink{classChronusQ_1_1DirectTPI_a51ce753ee588706401406d4216c1ba74}{threshSchwarz}}()) \{  }
\DoxyCodeLine{665             nIntSkip[thread\_id]++;}
\DoxyCodeLine{666 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{667             nConSkip[thread\_id] += nBatch;}
\DoxyCodeLine{668 \textcolor{preprocessor}{\#endif            }}
\DoxyCodeLine{669             \textcolor{keywordflow}{continue}; }
\DoxyCodeLine{670           \}}
\DoxyCodeLine{671           }
\DoxyCodeLine{672 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{673           nCon = 0;}
\DoxyCodeLine{674           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iBatch = 0ul; iBatch < nBatch; iBatch++) \{}
\DoxyCodeLine{675             shMax = std::max(ShBlkNorms\_batch[iBatch][s1 + s4*nShell],}
\DoxyCodeLine{676                     std::max(ShBlkNorms\_batch[iBatch][s2 + s4*nShell],}
\DoxyCodeLine{677                              ShBlkNorms\_batch[iBatch][s3 + s4*nShell]));}
\DoxyCodeLine{678             shMax = std::max(shMax, shMax123\_batch[iBatch]); }
\DoxyCodeLine{679              }
\DoxyCodeLine{680             \textcolor{keywordflow}{if}((shMax*SchwarzERI[s1+s2*nShell]*SchwarzERI[s3+s4*nShell]) <}
\DoxyCodeLine{681               eri.\mbox{\hyperlink{classChronusQ_1_1DirectTPI_a51ce753ee588706401406d4216c1ba74}{threshSchwarz}}()) \{}
\DoxyCodeLine{682               nConSkip[thread\_id] ++;}
\DoxyCodeLine{683             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{684               contract\_batch[nCon] = iBatch; }
\DoxyCodeLine{685               nCon++;  }
\DoxyCodeLine{686             \}}
\DoxyCodeLine{687           \}}
\DoxyCodeLine{688 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{689 \textcolor{preprocessor}{\#endif }}
\DoxyCodeLine{690 }
\DoxyCodeLine{691 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{692           \textcolor{keyword}{auto} topDirectInt = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{693 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{694           \textcolor{comment}{// Degeneracy factor for s3,s4 pair}}
\DoxyCodeLine{695           \textcolor{keywordtype}{double} s34\_deg = (s3 == s4) ? 1.0 : 2.0;}
\DoxyCodeLine{696           \textcolor{comment}{// Degeneracy factor for s1, s2, s3, s4 quartet}}
\DoxyCodeLine{697           \textcolor{keywordtype}{double} s12\_34\_deg = (s1 == s3) ? (s2 == s4 ? 1.0 : 2.0) : 2.0;}
\DoxyCodeLine{698           \textcolor{comment}{// Total degeneracy factor}}
\DoxyCodeLine{699           \textcolor{keywordtype}{double} s1234\_deg = s12\_deg * s34\_deg * s12\_34\_deg;}
\DoxyCodeLine{700    }
\DoxyCodeLine{701           \textcolor{keyword}{auto} nQuad = n1*n2*n3*n4;}
\DoxyCodeLine{702 }
\DoxyCodeLine{703           shls[0] = int(s1);}
\DoxyCodeLine{704           shls[1] = int(s2);}
\DoxyCodeLine{705           shls[2] = int(s3);}
\DoxyCodeLine{706           shls[3] = int(s4);}
\DoxyCodeLine{707 }
\DoxyCodeLine{708           \textcolor{keywordflow}{if}(int2e\_sph(buff, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, cache)==0) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{709 }
\DoxyCodeLine{710           \textcolor{comment}{// Scale the buffer by the degeneracy factor and store}}
\DoxyCodeLine{711           \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} i = 0ul; i < nQuad; i++) buff[i] *= 0.5*s1234\_deg;}
\DoxyCodeLine{712 }
\DoxyCodeLine{713 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{714           durDirectInt[thread\_id] += \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topDirectInt); }
\DoxyCodeLine{715 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{716 }
\DoxyCodeLine{717 \textcolor{preprocessor}{\#ifdef \_CONTRACTION\_ }\textcolor{comment}{// Contraction}}
\DoxyCodeLine{718           }
\DoxyCodeLine{719 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{720           \textcolor{keyword}{auto} topDirectCon = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{721 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{722           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iCon = 0ul; iCon < nCon; iCon++) \{  }
\DoxyCodeLine{723             }
\DoxyCodeLine{724             matOff = contract\_batch[iCon] * mMat; }
\DoxyCodeLine{725             ADCLLMS = AX\_loc[matOff]-\/>S().pointer();}
\DoxyCodeLine{726             symmDCLLMS  = matList[matOff].X-\/>S().pointer();}
\DoxyCodeLine{727 }
\DoxyCodeLine{728           \textcolor{keywordflow}{for}(l = 0ul, bf4 = bf4\_s, mnkl=0ul ; l < n4; ++l, bf4++) \{}
\DoxyCodeLine{729   }
\DoxyCodeLine{730           \textcolor{keywordflow}{for}(k = 0ul, bf3 = bf3\_s           ; k < n3; ++k, bf3++) \{}
\DoxyCodeLine{731             bf43 = bf4 + bf3*nBasis;}
\DoxyCodeLine{732             bf34 = bf3 + bf4*nBasis;}
\DoxyCodeLine{733   }
\DoxyCodeLine{734           \textcolor{keywordflow}{for}(n = 0ul, bf2 = bf2\_s           ; n < n2; ++n, bf2++) \{}
\DoxyCodeLine{735   }
\DoxyCodeLine{736           \textcolor{keywordflow}{for}(m = 0ul, bf1 = bf1\_s           ; m < n1; ++m, bf1++, ++mnkl) \{}
\DoxyCodeLine{737             bf21 = bf2 + bf1*nBasis;}
\DoxyCodeLine{738             bf12 = bf1 + bf2*nBasis;}
\DoxyCodeLine{739  }
\DoxyCodeLine{740             ADCLLMS[bf12] += buff[mnkl]*symmDCLLMS[bf43];}
\DoxyCodeLine{741             ADCLLMS[bf34] += buff[mnkl]*symmDCLLMS[bf21];}
\DoxyCodeLine{742             }
\DoxyCodeLine{743           \}; \textcolor{comment}{// bf1}}
\DoxyCodeLine{744           \}; \textcolor{comment}{// bf2}}
\DoxyCodeLine{745           \}; \textcolor{comment}{// bf3}}
\DoxyCodeLine{746           \}; \textcolor{comment}{// bf4  }}
\DoxyCodeLine{747           \}; \textcolor{comment}{// iCon}}
\DoxyCodeLine{748 }
\DoxyCodeLine{749 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// Contraction}}
\DoxyCodeLine{750         }
\DoxyCodeLine{751 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{752         durDirectCon[thread\_id] += \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topDirectCon);}
\DoxyCodeLine{753 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{754         \}; \textcolor{comment}{// s4}}
\DoxyCodeLine{755         \}; \textcolor{comment}{// s3}}
\DoxyCodeLine{756         \}; \textcolor{comment}{// s2}}
\DoxyCodeLine{757         \}; \textcolor{comment}{// s1}}
\DoxyCodeLine{758           }
\DoxyCodeLine{759       }
\DoxyCodeLine{760       \} \textcolor{comment}{// OpenMP context }}
\DoxyCodeLine{761       }
\DoxyCodeLine{762       \textcolor{comment}{// Take care of the symmetry for CLLMS}}
\DoxyCodeLine{763       }
\DoxyCodeLine{764       MatsT scale = MatsT(0.25);}
\DoxyCodeLine{765 }
\DoxyCodeLine{766       \textcolor{keywordflow}{for}( \textcolor{keyword}{auto} iMat = 0; iMat < nMat;  iMat++ ) }
\DoxyCodeLine{767       \textcolor{keywordflow}{for}( \textcolor{keyword}{auto} iTh  = 0; iTh < nThreads; iTh++) \{}
\DoxyCodeLine{768         matList[iMat].AX-\/>S() += scale * (AXthreads[iTh][iMat]-\/>S() + AXthreads[iTh][iMat]-\/>S().T());   }
\DoxyCodeLine{769       \}}
\DoxyCodeLine{770      }
\DoxyCodeLine{771       memManager\_.free(buffAll, cacheAll);}
\DoxyCodeLine{772     }
\DoxyCodeLine{773 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{774       \textcolor{keywordtype}{size\_t} nIntSkipAcc = std::accumulate(nIntSkip.begin(),nIntSkip.end(),0);}
\DoxyCodeLine{775       \textcolor{keywordtype}{double} durDirectIntAcc = std::accumulate(durDirectInt.begin(), durDirectInt.end(),0.);}
\DoxyCodeLine{776       \textcolor{keywordtype}{double} durDirectConAcc = std::accumulate(durDirectCon.begin(), durDirectCon.end(),0.);}
\DoxyCodeLine{777       }
\DoxyCodeLine{778       std::cout << std::endl;}
\DoxyCodeLine{779       std::cout << \textcolor{stringliteral}{"{}Bare-\/Coulomb-\/Exchange Skipped Integral   : "{}} << nIntSkipAcc << std::endl;}
\DoxyCodeLine{780 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{781       \textcolor{keywordtype}{size\_t} nConSkipAcc = std::accumulate(nConSkip.begin(),nConSkip.end(),0);}
\DoxyCodeLine{782       std::cout << \textcolor{stringliteral}{"{}                      Skipped Contraction: "{}} << nConSkipAcc << std::endl;}
\DoxyCodeLine{783 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{784 }
\DoxyCodeLine{785       \textcolor{keyword}{auto} durDirect = \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topDirect);}
\DoxyCodeLine{786       std::cout << \textcolor{stringliteral}{"{}Bare-\/Coulomb-\/Exchange AO Direct Contraction took "{}} <<  durDirect }
\DoxyCodeLine{787                 << \textcolor{stringliteral}{"{} s for "{}} << nBatch << \textcolor{stringliteral}{"{} Batch"{}} << std::endl; }
\DoxyCodeLine{788       std::cout << \textcolor{stringliteral}{"{}                            Build Integrals took "{}} <<  durDirectIntAcc << \textcolor{stringliteral}{"{} s"{}} }
\DoxyCodeLine{789                 << \textcolor{stringliteral}{"{} from all "{}} << nThreads << \textcolor{stringliteral}{"{} thread(s)"{}} << std::endl;}
\DoxyCodeLine{790       std::cout << \textcolor{stringliteral}{"{}                            Contractions    took "{}} <<  durDirectConAcc << \textcolor{stringliteral}{"{} s"{}} }
\DoxyCodeLine{791                 << \textcolor{stringliteral}{"{} from all "{}} << nThreads << \textcolor{stringliteral}{"{} thread(s)"{}} << std::endl;}
\DoxyCodeLine{792       std::cout << std::endl;}
\DoxyCodeLine{793 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{794     }
\DoxyCodeLine{795     \};}
\DoxyCodeLine{796 }
\DoxyCodeLine{797 \textcolor{comment}{    /*********************************/}}
\DoxyCodeLine{798     \textcolor{comment}{/*                               */}}
\DoxyCodeLine{799     \textcolor{comment}{/* End of Bare-\/Coulomb           */}}
\DoxyCodeLine{800     \textcolor{comment}{/*                               */}}
\DoxyCodeLine{801 \textcolor{comment}{    /*********************************/}}
\DoxyCodeLine{802   }
\DoxyCodeLine{803 \textcolor{comment}{    /******************************************/}}
\DoxyCodeLine{804     \textcolor{comment}{/*                                        */}}
\DoxyCodeLine{805     \textcolor{comment}{/* Start of Dirac-\/Coulomb LL and C(2)-\/SS  */}}
\DoxyCodeLine{806     \textcolor{comment}{/*                                        */}}
\DoxyCodeLine{807 \textcolor{comment}{    /******************************************/}}
\DoxyCodeLine{808     }
\DoxyCodeLine{809     \textcolor{keywordflow}{if}( matList[0].contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba1d269d4b7d6c561fc04b81a2a178e2a5}{TWOBODY\_CONTRACTION\_TYPE::LLLL}} ) \{}
\DoxyCodeLine{810 }
\DoxyCodeLine{811  }
\DoxyCodeLine{812 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{813       \textcolor{keyword}{auto} topDirectLL = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{814       std::vector<double> durDirectLLInt(nThreads, 0.);}
\DoxyCodeLine{815       std::vector<double> durDirectLLCon(nThreads, 0.);}
\DoxyCodeLine{816 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{817       \textcolor{keyword}{enum} X\_COMP \{}
\DoxyCodeLine{818         sDSS,}
\DoxyCodeLine{819         sDLLMS,}
\DoxyCodeLine{820       \};}
\DoxyCodeLine{821 }
\DoxyCodeLine{822       \textcolor{keyword}{enum} AX\_COMP \{}
\DoxyCodeLine{823         CLLMS,}
\DoxyCodeLine{824         CSS,}
\DoxyCodeLine{825       \};}
\DoxyCodeLine{826 }
\DoxyCodeLine{827       \textcolor{comment}{// 81 is for fourth-\/derivative; 9 for second derivative}}
\DoxyCodeLine{828       nERI = 9;}
\DoxyCodeLine{829       buffAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(nERI*buffN4*nThreads);}
\DoxyCodeLine{830       cacheAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(cache\_size*nThreads);}
\DoxyCodeLine{831       ERIBuffer = memManager\_.malloc<\textcolor{keywordtype}{double}>(2*4*NB4*nThreads);}
\DoxyCodeLine{832 }
\DoxyCodeLine{833       \textcolor{comment}{// Keeping track of number of integrals skipped}}
\DoxyCodeLine{834       std::vector<size\_t> nIntSkipLL(nThreads,0);}
\DoxyCodeLine{835 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{836       std::vector<size\_t> nConSkipLL(nThreads,0);}
\DoxyCodeLine{837 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{838 }
\DoxyCodeLine{839 \textcolor{preprocessor}{      \#pragma omp parallel}}
\DoxyCodeLine{840       \{}
\DoxyCodeLine{841 }
\DoxyCodeLine{842         \textcolor{keywordtype}{double} C2 = 1./(4*\mbox{\hyperlink{namespaceChronusQ_a387c8ccd4e18ad322b87f75f51fd008d}{SpeedOfLight}}*\mbox{\hyperlink{namespaceChronusQ_a387c8ccd4e18ad322b87f75f51fd008d}{SpeedOfLight}});}
\DoxyCodeLine{843   }
\DoxyCodeLine{844         \textcolor{keywordtype}{size\_t} thread\_id = \mbox{\hyperlink{namespaceChronusQ_aa348a017ee78c3450480773ddc542e5c}{GetThreadID}}();}
\DoxyCodeLine{845   }
\DoxyCodeLine{846         \textcolor{keyword}{auto} \&AX\_loc = AXthreads[thread\_id];}
\DoxyCodeLine{847   }
\DoxyCodeLine{848         \textcolor{keywordtype}{double} *ERIBuffAB   = \&ERIBuffer[thread\_id*4*NB4];}
\DoxyCodeLine{849         \textcolor{keywordtype}{double} *ERIBuffCD   = \&ERIBuffer[nThreads*4*NB4 + thread\_id*4*NB4];}
\DoxyCodeLine{850   }
\DoxyCodeLine{851         \textcolor{keywordtype}{size\_t} n1,n2,n3,n4,m,n,k,l,mnkl,bf1,bf2,bf3,bf4;}
\DoxyCodeLine{852         \textcolor{keywordtype}{size\_t} bf3nB,bf34,bf43,bf1nB,bf21,bf12;}
\DoxyCodeLine{853         \textcolor{keywordtype}{size\_t} mNB2,mnNBkNB2,mnNB,mNB2nNB3,kmNB2nNB,kmNB2nNB3; }
\DoxyCodeLine{854         \textcolor{keywordtype}{size\_t} KLMN, DotPrdKLMN, CrossZKLMN, CrossXKLMN, CrossYKLMN,}
\DoxyCodeLine{855           MNKL, DotPrdMNKL, CrossXMNKL, CrossYMNKL, CrossZMNKL;}
\DoxyCodeLine{856 }
\DoxyCodeLine{857         \textcolor{keywordtype}{size\_t} s4\_max;}
\DoxyCodeLine{858   }
\DoxyCodeLine{859         \textcolor{keywordtype}{int} shls[4];}
\DoxyCodeLine{860         \textcolor{keywordtype}{double} *buff = \&buffAll[nERI*buffN4*thread\_id];}
\DoxyCodeLine{861         \textcolor{keywordtype}{double} *cache = cacheAll+cache\_size*thread\_id;}
\DoxyCodeLine{862         }
\DoxyCodeLine{863         MatsT *ADCLLMS, *ADCSSMS, *ADCSSMX, *ADCSSMY, *ADCSSMZ,}
\DoxyCodeLine{864           *symmDCLLMS, *symmDCSSMS, *symmDCSSMX, *symmDCSSMY, *symmDCSSMZ;}
\DoxyCodeLine{865 }
\DoxyCodeLine{866         std::vector<size\_t> contract\_batch(nBatch);}
\DoxyCodeLine{867         \textcolor{keywordtype}{size\_t} iCon, nCon, matOff;}
\DoxyCodeLine{868 }
\DoxyCodeLine{869 \textcolor{preprocessor}{\#if !defined(\_SHZ\_SCREEN\_4C) || !defined(\_SEPARATED\_SHZ\_SCREEN\_4C)}}
\DoxyCodeLine{870         std::iota(contract\_batch.begin(), contract\_batch.end(), 0);}
\DoxyCodeLine{871         nCon = nBatch;}
\DoxyCodeLine{872 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{873   }
\DoxyCodeLine{874         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s1(0), bf1\_s(0), s1234(0); s1 < nShell; bf1\_s+=n1, s1++) \{ }
\DoxyCodeLine{875   }
\DoxyCodeLine{876           n1 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s1].size(); \textcolor{comment}{// Size of Shell 1}}
\DoxyCodeLine{877   }
\DoxyCodeLine{878         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s2(0), bf2\_s(0); s2 <= s1; bf2\_s+=n2, s2++) \{}
\DoxyCodeLine{879   }
\DoxyCodeLine{880           n2 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s2].size(); \textcolor{comment}{// Size of Shell 2}}
\DoxyCodeLine{881           \textcolor{comment}{// Deneneracy factor for s1,s2 pair}}
\DoxyCodeLine{882           \textcolor{keywordtype}{double} s12\_deg = (s1 == s2) ? 1.0 : 2.0;}
\DoxyCodeLine{883   }
\DoxyCodeLine{884         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s3(0), bf3\_s(0); s3 < nShell; bf3\_s+=n3, s3++) \{}
\DoxyCodeLine{885   }
\DoxyCodeLine{886           n3 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s3].size(); \textcolor{comment}{// Size of Shell 3}}
\DoxyCodeLine{887           s4\_max = (s1 == s3) ? s2 : s3; \textcolor{comment}{// Determine the unique max of Shell 4}}
\DoxyCodeLine{888   }
\DoxyCodeLine{889         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s4(0), bf4\_s(0); s4 <= s3; bf4\_s+=n4, s4++, s1234++) \{}
\DoxyCodeLine{890   }
\DoxyCodeLine{891           n4 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s4].size(); \textcolor{comment}{// Size of Shell 4}}
\DoxyCodeLine{892 }
\DoxyCodeLine{893           \textcolor{comment}{// Round Robbin work distribution}}
\DoxyCodeLine{894 \textcolor{preprocessor}{          \#ifdef \_OPENMP}}
\DoxyCodeLine{895           \textcolor{keywordflow}{if}( s1234 \% nThreads != thread\_id ) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{896 \textcolor{preprocessor}{          \#endif}}
\DoxyCodeLine{897 }
\DoxyCodeLine{898 \textcolor{preprocessor}{\#ifdef \_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{899 }
\DoxyCodeLine{900           \textcolor{keywordtype}{double} shMax = std::max(ShBlkNorms[s1 + s2*nShell],ShBlkNorms[s3 + s4*nShell]);}
\DoxyCodeLine{901 }
\DoxyCodeLine{902           \textcolor{keywordflow}{if}((shMax*SchwarzSSSS[s1+s2*nShell]*SchwarzERI[s3 + s4*nShell]) <}
\DoxyCodeLine{903              eri.\mbox{\hyperlink{classChronusQ_1_1DirectTPI_a51ce753ee588706401406d4216c1ba74}{threshSchwarz}}()) \{ }
\DoxyCodeLine{904             nIntSkipLL[thread\_id]++; }
\DoxyCodeLine{905 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{906             nConSkipLL[thread\_id] += nBatch; }
\DoxyCodeLine{907 \textcolor{preprocessor}{\#endif            }}
\DoxyCodeLine{908             \textcolor{keywordflow}{continue}; }
\DoxyCodeLine{909           \}}
\DoxyCodeLine{910 }
\DoxyCodeLine{911 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{912           nCon = 0;}
\DoxyCodeLine{913           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iBatch = 0ul; iBatch < nBatch; iBatch++) \{}
\DoxyCodeLine{914              }
\DoxyCodeLine{915             shMax = std::max(ShBlkNorms\_batch[iBatch][s1 + s2*nShell],}
\DoxyCodeLine{916                              ShBlkNorms\_batch[iBatch][s3 + s4*nShell]);}
\DoxyCodeLine{917             }
\DoxyCodeLine{918             \textcolor{keywordflow}{if}((shMax*SchwarzSSSS[s1+s2*nShell]*SchwarzERI[s3+s4*nShell]) <}
\DoxyCodeLine{919               eri.\mbox{\hyperlink{classChronusQ_1_1DirectTPI_a51ce753ee588706401406d4216c1ba74}{threshSchwarz}}()) \{}
\DoxyCodeLine{920               nConSkipLL[thread\_id]++;}
\DoxyCodeLine{921             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{922               contract\_batch[nCon] = iBatch;}
\DoxyCodeLine{923               nCon++;}
\DoxyCodeLine{924             \}}
\DoxyCodeLine{925           \}}
\DoxyCodeLine{926 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{927 }
\DoxyCodeLine{928 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{929 }
\DoxyCodeLine{930 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{931           \textcolor{keyword}{auto} topDirectLLInt = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{932 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{933           \textcolor{comment}{// Degeneracy factor for s3,s4 pair}}
\DoxyCodeLine{934           \textcolor{keywordtype}{double} s34\_deg = (s3 == s4) ? 1.0 : 2.0;}
\DoxyCodeLine{935 }
\DoxyCodeLine{936           \textcolor{keyword}{auto} nQuad = n1*n2*n3*n4;}
\DoxyCodeLine{937   }
\DoxyCodeLine{938           shls[0] = int(s1);}
\DoxyCodeLine{939           shls[1] = int(s2);}
\DoxyCodeLine{940           shls[2] = int(s3);}
\DoxyCodeLine{941           shls[3] = int(s4);}
\DoxyCodeLine{942   }
\DoxyCodeLine{943           \textcolor{keywordflow}{if}(int2e\_ipvip1\_sph(buff, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, cache)==0) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{944 }
\DoxyCodeLine{945  }
\DoxyCodeLine{946           \textcolor{keywordflow}{for}(l = 3*maxShellSize, mnkl = 0ul; l < 3*maxShellSize + n4; ++l) \{}
\DoxyCodeLine{947             \textcolor{keyword}{auto} lNB3 = l*NB3;}
\DoxyCodeLine{948             \textcolor{keyword}{auto} lNB  = l*NB;}
\DoxyCodeLine{949 }
\DoxyCodeLine{950           \textcolor{keywordflow}{for}(k = 2*maxShellSize            ; k < 2*maxShellSize + n3; ++k) \{}
\DoxyCodeLine{951             \textcolor{keyword}{auto} kNB2lNB3 = k*NB2 + lNB3;}
\DoxyCodeLine{952             \textcolor{keyword}{auto} klNB  = k + lNB;}
\DoxyCodeLine{953 }
\DoxyCodeLine{954           \textcolor{keywordflow}{for}(n =   maxShellSize            ; n <   maxShellSize + n2; ++n) \{}
\DoxyCodeLine{955             \textcolor{keyword}{auto} nNBkNB2lNB3 = n*NB + kNB2lNB3;}
\DoxyCodeLine{956             \textcolor{keyword}{auto} klNBnNB3    = klNB + n*NB3;}
\DoxyCodeLine{957 }
\DoxyCodeLine{958           \textcolor{keywordflow}{for}(m = 0                         ; m <                  n1; ++m, ++mnkl) \{}
\DoxyCodeLine{959    }
\DoxyCodeLine{960             \textcolor{comment}{/* Dirac-\/Coulomb */}}
\DoxyCodeLine{961             \textcolor{comment}{// ∇A∙∇B(mn|kl)}}
\DoxyCodeLine{962             \textcolor{keyword}{auto} dAdotdB = buff[AxBx*nQuad+mnkl] + buff[AyBy*nQuad+mnkl] + buff[AzBz*nQuad+mnkl];}
\DoxyCodeLine{963             \textcolor{comment}{// ∇Ax∇B(mn|kl)}}
\DoxyCodeLine{964             \textcolor{keyword}{auto} dAcrossdB\_x =  buff[AyBz*nQuad+mnkl] -\/ buff[AzBy*nQuad+mnkl];}
\DoxyCodeLine{965             \textcolor{keyword}{auto} dAcrossdB\_y = -\/buff[AxBz*nQuad+mnkl] + buff[AzBx*nQuad+mnkl];}
\DoxyCodeLine{966             \textcolor{keyword}{auto} dAcrossdB\_z =  buff[AxBy*nQuad+mnkl] -\/ buff[AyBx*nQuad+mnkl];}
\DoxyCodeLine{967   }
\DoxyCodeLine{968             \textcolor{comment}{//auto MNKL = m + n*NB + k*NB2 + l*NB3;}}
\DoxyCodeLine{969             MNKL = m + nNBkNB2lNB3;}
\DoxyCodeLine{970             \textcolor{comment}{//auto KLMN = k + l*NB + m*NB2 + n*NB3;}}
\DoxyCodeLine{971             KLMN = m*NB2 + klNBnNB3;}
\DoxyCodeLine{972   }
\DoxyCodeLine{973   }
\DoxyCodeLine{974             \textcolor{comment}{// ∇A∙∇B(mn|kl) followed by ∇Ax∇B(mn|kl) X, Y, and Z}}
\DoxyCodeLine{975             \textcolor{comment}{// (mn|kl)}}
\DoxyCodeLine{976             ERIBuffAB[       MNKL] =  (double)s34\_deg*dAdotdB;}
\DoxyCodeLine{977             ERIBuffAB[   NB4+MNKL] =  (double)s34\_deg*dAcrossdB\_x;}
\DoxyCodeLine{978             ERIBuffAB[ NB4\_2+MNKL] =  (double)s34\_deg*dAcrossdB\_y;}
\DoxyCodeLine{979             ERIBuffAB[ NB4\_3+MNKL] =  (double)s34\_deg*dAcrossdB\_z;}
\DoxyCodeLine{980   }
\DoxyCodeLine{981             \textcolor{comment}{// ∇C∙∇D(kl|nm) followed by ∇Cx∇D(kl|nm) X, Y, and Z}}
\DoxyCodeLine{982             \textcolor{comment}{// (kl|mn)}}
\DoxyCodeLine{983             ERIBuffCD[       KLMN] =  (double)s12\_deg*dAdotdB;}
\DoxyCodeLine{984             ERIBuffCD[   NB4+KLMN] =  (double)s12\_deg*dAcrossdB\_x;}
\DoxyCodeLine{985             ERIBuffCD[ NB4\_2+KLMN] =  (double)s12\_deg*dAcrossdB\_y;}
\DoxyCodeLine{986             ERIBuffCD[ NB4\_3+KLMN] =  (double)s12\_deg*dAcrossdB\_z;}
\DoxyCodeLine{987  }
\DoxyCodeLine{988           \}}
\DoxyCodeLine{989           \}}
\DoxyCodeLine{990           \} }
\DoxyCodeLine{991           \} \textcolor{comment}{// ∇A∇B integral preparation loop}}
\DoxyCodeLine{992 }
\DoxyCodeLine{993 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{994          durDirectLLInt[thread\_id] += \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topDirectLLInt);}
\DoxyCodeLine{995 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{996 }
\DoxyCodeLine{997 \textcolor{preprocessor}{\#ifdef \_CONTRACTION\_ }\textcolor{comment}{// Contraction}}
\DoxyCodeLine{998 }
\DoxyCodeLine{999 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{1000           \textcolor{keyword}{auto} topDirectLLCon = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{1001 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1002 }
\DoxyCodeLine{1003           \textcolor{keywordflow}{for} (iCon = 0ul; iCon < nCon; iCon++) \{  }
\DoxyCodeLine{1004             }
\DoxyCodeLine{1005             matOff = contract\_batch[iCon] * mMat;}
\DoxyCodeLine{1006             }
\DoxyCodeLine{1007             ADCLLMS = AX\_loc[CLLMS + matOff]-\/>S().pointer();}
\DoxyCodeLine{1008             ADCSSMS = AX\_loc[CSS + matOff]-\/>S().pointer();}
\DoxyCodeLine{1009             ADCSSMX = AX\_loc[CSS + matOff]-\/>X().pointer();}
\DoxyCodeLine{1010             ADCSSMY = AX\_loc[CSS + matOff]-\/>Y().pointer();}
\DoxyCodeLine{1011             ADCSSMZ = AX\_loc[CSS + matOff]-\/>Z().pointer();}
\DoxyCodeLine{1012 }
\DoxyCodeLine{1013             symmDCLLMS  = matList[sDLLMS + matOff].X-\/>S().pointer();}
\DoxyCodeLine{1014             symmDCSSMS  = matList[sDSS + matOff].X-\/>S().pointer();}
\DoxyCodeLine{1015             symmDCSSMX  = matList[sDSS + matOff].X-\/>X().pointer();}
\DoxyCodeLine{1016             symmDCSSMY  = matList[sDSS + matOff].X-\/>Y().pointer();}
\DoxyCodeLine{1017             symmDCSSMZ  = matList[sDSS + matOff].X-\/>Z().pointer();}
\DoxyCodeLine{1018 }
\DoxyCodeLine{1019           \textcolor{keywordflow}{for}(m = 0ul,            bf1 = bf1\_s; m <                  n1; ++m, bf1++) \{}
\DoxyCodeLine{1020             mNB2 = m*NB2;}
\DoxyCodeLine{1021             bf1nB = bf1*nBasis;}
\DoxyCodeLine{1022 }
\DoxyCodeLine{1023           \textcolor{keywordflow}{for}(n =   maxShellSize, bf2 = bf2\_s; n <   maxShellSize + n2; ++n, bf2++) \{}
\DoxyCodeLine{1024             mNB2nNB3 = mNB2 + n*NB3;}
\DoxyCodeLine{1025             mnNB     = m + n*NB;}
\DoxyCodeLine{1026             bf21 = bf2 + bf1nB;}
\DoxyCodeLine{1027             bf12 = bf1 + bf2*nBasis;}
\DoxyCodeLine{1028 }
\DoxyCodeLine{1029           \textcolor{keywordflow}{for}(k = 2*maxShellSize, bf3 = bf3\_s; k < 2*maxShellSize + n3; ++k, bf3++) \{}
\DoxyCodeLine{1030             mnNBkNB2  = mnNB + k*NB2;}
\DoxyCodeLine{1031             kmNB2nNB3 = k + mNB2nNB3;}
\DoxyCodeLine{1032             bf3nB = bf3*nBasis;}
\DoxyCodeLine{1033 }
\DoxyCodeLine{1034           \textcolor{keywordflow}{for}(l = 3*maxShellSize, bf4 = bf4\_s; l < 3*maxShellSize + n4; ++l, bf4++) \{}
\DoxyCodeLine{1035   }
\DoxyCodeLine{1036             MNKL = mnNBkNB2 + l*NB3;}
\DoxyCodeLine{1037             KLMN = kmNB2nNB3 + l*NB;}
\DoxyCodeLine{1038   }
\DoxyCodeLine{1039             bf43 = bf4 + bf3nB;}
\DoxyCodeLine{1040             bf34 = bf3 + bf4*nBasis;}
\DoxyCodeLine{1041   }
\DoxyCodeLine{1042             DotPrdMNKL = MNKL;}
\DoxyCodeLine{1043             CrossXMNKL = MNKL+NB4;}
\DoxyCodeLine{1044             CrossYMNKL = MNKL+NB4\_2;}
\DoxyCodeLine{1045             CrossZMNKL = MNKL+NB4\_3;}
\DoxyCodeLine{1046   }
\DoxyCodeLine{1047             DotPrdKLMN = KLMN;}
\DoxyCodeLine{1048             CrossXKLMN = KLMN+NB4;}
\DoxyCodeLine{1049             CrossYKLMN = KLMN+NB4\_2;}
\DoxyCodeLine{1050             CrossZKLMN = KLMN+NB4\_3;}
\DoxyCodeLine{1051   }
\DoxyCodeLine{1052             \textcolor{comment}{/*++++++++++++++++++++++++++++++++++++++++++++*/}}
\DoxyCodeLine{1053             \textcolor{comment}{/* Start of Dirac-\/Coulomb (LL|LL) Contraction */}}
\DoxyCodeLine{1054             \textcolor{comment}{/*++++++++++++++++++++++++++++++++++++++++++++*/}}
\DoxyCodeLine{1055   }
\DoxyCodeLine{1056             \textcolor{comment}{//KLMN}}
\DoxyCodeLine{1057             \textcolor{keywordflow}{if}(bf3 >= bf4 ) \{}
\DoxyCodeLine{1058               ADCLLMS[bf34] +=  ERIBuffCD[DotPrdKLMN] * symmDCSSMS[bf21]}
\DoxyCodeLine{1059                                + (  ERIBuffCD[CrossZKLMN] * symmDCSSMZ[bf21]}
\DoxyCodeLine{1060                                   + ERIBuffCD[CrossXKLMN] * symmDCSSMX[bf21]}
\DoxyCodeLine{1061                                   + ERIBuffCD[CrossYKLMN] * symmDCSSMY[bf21]) * \mbox{\hyperlink{chronusq__sys_8hpp_aa7b4cfa83fe868296abd1ba4d67d9563}{dcomplex}}(0.,1.);}
\DoxyCodeLine{1062             \}}
\DoxyCodeLine{1063            }
\DoxyCodeLine{1064             \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{1065             \textcolor{comment}{/* End of Dirac-\/Coulomb (LL|LL) Contraction */}}
\DoxyCodeLine{1066             \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{1067   }
\DoxyCodeLine{1068   }
\DoxyCodeLine{1069             \textcolor{comment}{/*+++++++++++++++++++++++++++++++++++++++++++++++++*/}}
\DoxyCodeLine{1070             \textcolor{comment}{/* Start of Dirac-\/Coulomb C(2)-\/(SS|SS) Contraction */}}
\DoxyCodeLine{1071             \textcolor{comment}{/*+++++++++++++++++++++++++++++++++++++++++++++++++*/}}
\DoxyCodeLine{1072   }
\DoxyCodeLine{1073             \textcolor{comment}{/* MNKL */}}
\DoxyCodeLine{1074             \textcolor{keywordflow}{if} (bf1 >= bf2) \{}
\DoxyCodeLine{1075               ADCSSMS[bf12] += ERIBuffAB[DotPrdMNKL] * symmDCLLMS[bf43];}
\DoxyCodeLine{1076               ADCSSMX[bf12] += ERIBuffAB[CrossXMNKL] * symmDCLLMS[bf43];}
\DoxyCodeLine{1077               ADCSSMY[bf12] += ERIBuffAB[CrossYMNKL] * symmDCLLMS[bf43];}
\DoxyCodeLine{1078               ADCSSMZ[bf12] += ERIBuffAB[CrossZMNKL] * symmDCLLMS[bf43];}
\DoxyCodeLine{1079             \}}
\DoxyCodeLine{1080   }
\DoxyCodeLine{1081             \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{1082             \textcolor{comment}{/* End of Dirac-\/Coulomb C(2)-\/(SS|SS) Contraction */}}
\DoxyCodeLine{1083             \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{1084           \};}
\DoxyCodeLine{1085           \};}
\DoxyCodeLine{1086           \};  }
\DoxyCodeLine{1087           \}; }
\DoxyCodeLine{1088           \}; \textcolor{comment}{// iBatch}}
\DoxyCodeLine{1089 }
\DoxyCodeLine{1090 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// Contraction}}
\DoxyCodeLine{1091 }
\DoxyCodeLine{1092 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{1093         durDirectLLCon[thread\_id] += \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topDirectLLCon); }
\DoxyCodeLine{1094 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1095         \}; \textcolor{comment}{// loop s4}}
\DoxyCodeLine{1096         \}; \textcolor{comment}{// loop s3}}
\DoxyCodeLine{1097         \}; \textcolor{comment}{// loop s2}}
\DoxyCodeLine{1098         \}; \textcolor{comment}{// loop s1}}
\DoxyCodeLine{1099 }
\DoxyCodeLine{1100       \} \textcolor{comment}{// OpenMP context}}
\DoxyCodeLine{1101 }
\DoxyCodeLine{1102    }
\DoxyCodeLine{1103       MatsT  scale = MatsT(0.5);}
\DoxyCodeLine{1104       MatsT iscale = scale * \mbox{\hyperlink{chronusq__sys_8hpp_aa7b4cfa83fe868296abd1ba4d67d9563}{dcomplex}}(0.0, 1.0);}
\DoxyCodeLine{1105       }
\DoxyCodeLine{1106       \textcolor{keywordflow}{for}( \textcolor{keyword}{auto} iTh  = 0; iTh < nThreads; iTh++) \{}
\DoxyCodeLine{1107       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iBatch = 0ul, matOff = 0ul; iBatch < nBatch; iBatch++, matOff+=mMat) \{  }
\DoxyCodeLine{1108         matList[CLLMS + matOff].AX-\/>S() +=  scale * AXthreads[iTh][CLLMS + matOff]-\/>S();  }
\DoxyCodeLine{1109         matList[CSS   + matOff].AX-\/>S() +=  scale * AXthreads[iTh][CSS   + matOff]-\/>S();  }
\DoxyCodeLine{1110         matList[CSS   + matOff].AX-\/>X() += iscale * AXthreads[iTh][CSS   + matOff]-\/>X();  }
\DoxyCodeLine{1111         matList[CSS   + matOff].AX-\/>Y() += iscale * AXthreads[iTh][CSS   + matOff]-\/>Y();  }
\DoxyCodeLine{1112         matList[CSS   + matOff].AX-\/>Z() += iscale * AXthreads[iTh][CSS   + matOff]-\/>Z();  }
\DoxyCodeLine{1113       \}\}}
\DoxyCodeLine{1114     }
\DoxyCodeLine{1115       \textcolor{comment}{// Take care of the symmetry in the LL and SS blocks}}
\DoxyCodeLine{1116       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iBatch = 0ul, matOff = 0ul; iBatch < nBatch; iBatch++, matOff+=mMat) \{  }
\DoxyCodeLine{1117         \textcolor{keyword}{auto} ADCLLMS = matList[CLLMS + matOff].AX-\/>S().pointer();}
\DoxyCodeLine{1118         \textcolor{keyword}{auto} ADCSSMS = matList[CSS   + matOff].AX-\/>S().pointer();}
\DoxyCodeLine{1119         \textcolor{keyword}{auto} ADCSSMX = matList[CSS   + matOff].AX-\/>X().pointer();}
\DoxyCodeLine{1120         \textcolor{keyword}{auto} ADCSSMY = matList[CSS   + matOff].AX-\/>Y().pointer();}
\DoxyCodeLine{1121         \textcolor{keyword}{auto} ADCSSMZ = matList[CSS   + matOff].AX-\/>Z().pointer();}
\DoxyCodeLine{1122         \textcolor{keywordflow}{for}( \textcolor{keyword}{auto} i = 0; i < nBasis; i++ ) }
\DoxyCodeLine{1123         \textcolor{keywordflow}{for}( \textcolor{keyword}{auto} j = 0; j < i; j++ ) \{}
\DoxyCodeLine{1124           ADCLLMS[j + i*nBasis] =  ADCLLMS[i + j*nBasis];}
\DoxyCodeLine{1125           ADCSSMS[j + i*nBasis] =  ADCSSMS[i + j*nBasis];}
\DoxyCodeLine{1126           ADCSSMX[j + i*nBasis] = -\/ADCSSMX[i + j*nBasis];}
\DoxyCodeLine{1127           ADCSSMY[j + i*nBasis] = -\/ADCSSMY[i + j*nBasis];}
\DoxyCodeLine{1128           ADCSSMZ[j + i*nBasis] = -\/ADCSSMZ[i + j*nBasis];}
\DoxyCodeLine{1129         \}}
\DoxyCodeLine{1130       \} }
\DoxyCodeLine{1131       }
\DoxyCodeLine{1132       memManager\_.free(ERIBuffer);}
\DoxyCodeLine{1133       memManager\_.free(buffAll, cacheAll);}
\DoxyCodeLine{1134     }
\DoxyCodeLine{1135 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{1136       \textcolor{keywordtype}{size\_t} nIntSkipLLAcc = std::accumulate(nIntSkipLL.begin(),nIntSkipLL.end(),0);}
\DoxyCodeLine{1137       \textcolor{keywordtype}{double} durDirectLLIntAcc = std::accumulate(durDirectLLInt.begin(), durDirectLLInt.end(),0.);}
\DoxyCodeLine{1138       \textcolor{keywordtype}{double} durDirectLLConAcc = std::accumulate(durDirectLLCon.begin(), durDirectLLCon.end(),0.);}
\DoxyCodeLine{1139       }
\DoxyCodeLine{1140       std::cout << std::endl;}
\DoxyCodeLine{1141       std::cout << \textcolor{stringliteral}{"{}Dirac-\/Coulomb-\/LL/C(2)-\/SS Skipped Integral   : "{}} << nIntSkipLLAcc << std::endl;}
\DoxyCodeLine{1142 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{1143       \textcolor{keywordtype}{size\_t} nConSkipLLAcc = std::accumulate(nConSkipLL.begin(),nConSkipLL.end(),0);}
\DoxyCodeLine{1144       std::cout << \textcolor{stringliteral}{"{}                         Skipped Contraction: "{}} << nConSkipLLAcc << std::endl;}
\DoxyCodeLine{1145 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1146       \textcolor{keyword}{auto} durDirectLL = \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topDirectLL);}
\DoxyCodeLine{1147       std::cout << \textcolor{stringliteral}{"{}Dirac-\/Coulomb-\/LL/C(2)-\/SS AO Direct Contraction took "{}} <<  durDirectLL }
\DoxyCodeLine{1148                 << \textcolor{stringliteral}{"{} s for "{}} << nBatch << \textcolor{stringliteral}{"{} Batch "{}} << std::endl; }
\DoxyCodeLine{1149       std::cout << \textcolor{stringliteral}{"{}                               Build Integrals took "{}} <<  durDirectLLIntAcc << \textcolor{stringliteral}{"{} s"{}} }
\DoxyCodeLine{1150                 << \textcolor{stringliteral}{"{} from all "{}} << nThreads << \textcolor{stringliteral}{"{} thread(s)"{}} << std::endl;}
\DoxyCodeLine{1151       std::cout << \textcolor{stringliteral}{"{}                               Contractions    took "{}} <<  durDirectLLConAcc << \textcolor{stringliteral}{"{} s"{}}}
\DoxyCodeLine{1152                 << \textcolor{stringliteral}{"{} from all "{}} << nThreads << \textcolor{stringliteral}{"{} thread(s)"{}} << std::endl;}
\DoxyCodeLine{1153 }
\DoxyCodeLine{1154       std::cout << std::endl;}
\DoxyCodeLine{1155 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1156     }
\DoxyCodeLine{1157     \} \textcolor{comment}{// if(LLLL)}}
\DoxyCodeLine{1158     }
\DoxyCodeLine{1159 \textcolor{comment}{    /******************************************/}}
\DoxyCodeLine{1160     \textcolor{comment}{/*                                        */}}
\DoxyCodeLine{1161     \textcolor{comment}{/*   End of Dirac-\/Coulomb LL and C(2)-\/SS  */}}
\DoxyCodeLine{1162     \textcolor{comment}{/*                                        */}}
\DoxyCodeLine{1163 \textcolor{comment}{    /******************************************/}}
\DoxyCodeLine{1164     }
\DoxyCodeLine{1165     }
\DoxyCodeLine{1166     }
\DoxyCodeLine{1167 \textcolor{comment}{    /****************************************/}}
\DoxyCodeLine{1168     \textcolor{comment}{/*                                      */}}
\DoxyCodeLine{1169     \textcolor{comment}{/* Start of Dirac-\/Coulomb C(4)-\/SSSS     */}}
\DoxyCodeLine{1170     \textcolor{comment}{/*                                      */}}
\DoxyCodeLine{1171 \textcolor{comment}{    /****************************************/}}
\DoxyCodeLine{1172 }
\DoxyCodeLine{1173     \textcolor{keywordflow}{if}( matList[0].contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cbaf5b0f392e82b90ea1452a00512088d53}{TWOBODY\_CONTRACTION\_TYPE::SSSS}} ) \{}
\DoxyCodeLine{1174   }
\DoxyCodeLine{1175       \textcolor{keyword}{enum} ERI\_4TH\_DERIV \{}
\DoxyCodeLine{1176         AxBxCxDx,}
\DoxyCodeLine{1177         AxBxCxDy,}
\DoxyCodeLine{1178         AxBxCxDz,}
\DoxyCodeLine{1179         AxBxCyDx,}
\DoxyCodeLine{1180         AxBxCyDy,}
\DoxyCodeLine{1181         AxBxCyDz,}
\DoxyCodeLine{1182         AxBxCzDx,}
\DoxyCodeLine{1183         AxBxCzDy,}
\DoxyCodeLine{1184         AxBxCzDz,}
\DoxyCodeLine{1185         AxByCxDx,}
\DoxyCodeLine{1186         AxByCxDy,}
\DoxyCodeLine{1187         AxByCxDz,}
\DoxyCodeLine{1188         AxByCyDx,}
\DoxyCodeLine{1189         AxByCyDy,}
\DoxyCodeLine{1190         AxByCyDz,}
\DoxyCodeLine{1191         AxByCzDx,}
\DoxyCodeLine{1192         AxByCzDy,}
\DoxyCodeLine{1193         AxByCzDz,}
\DoxyCodeLine{1194         AxBzCxDx,}
\DoxyCodeLine{1195         AxBzCxDy,}
\DoxyCodeLine{1196         AxBzCxDz,}
\DoxyCodeLine{1197         AxBzCyDx,}
\DoxyCodeLine{1198         AxBzCyDy,}
\DoxyCodeLine{1199         AxBzCyDz,}
\DoxyCodeLine{1200         AxBzCzDx,}
\DoxyCodeLine{1201         AxBzCzDy,}
\DoxyCodeLine{1202         AxBzCzDz,}
\DoxyCodeLine{1203         AyBxCxDx,}
\DoxyCodeLine{1204         AyBxCxDy,}
\DoxyCodeLine{1205         AyBxCxDz,}
\DoxyCodeLine{1206         AyBxCyDx,}
\DoxyCodeLine{1207         AyBxCyDy,}
\DoxyCodeLine{1208         AyBxCyDz,}
\DoxyCodeLine{1209         AyBxCzDx,}
\DoxyCodeLine{1210         AyBxCzDy,}
\DoxyCodeLine{1211         AyBxCzDz,}
\DoxyCodeLine{1212         AyByCxDx,}
\DoxyCodeLine{1213         AyByCxDy,}
\DoxyCodeLine{1214         AyByCxDz,}
\DoxyCodeLine{1215         AyByCyDx,}
\DoxyCodeLine{1216         AyByCyDy,}
\DoxyCodeLine{1217         AyByCyDz,}
\DoxyCodeLine{1218         AyByCzDx,}
\DoxyCodeLine{1219         AyByCzDy,}
\DoxyCodeLine{1220         AyByCzDz,}
\DoxyCodeLine{1221         AyBzCxDx,}
\DoxyCodeLine{1222         AyBzCxDy,}
\DoxyCodeLine{1223         AyBzCxDz,}
\DoxyCodeLine{1224         AyBzCyDx,}
\DoxyCodeLine{1225         AyBzCyDy,}
\DoxyCodeLine{1226         AyBzCyDz,}
\DoxyCodeLine{1227         AyBzCzDx,}
\DoxyCodeLine{1228         AyBzCzDy,}
\DoxyCodeLine{1229         AyBzCzDz,}
\DoxyCodeLine{1230         AzBxCxDx,}
\DoxyCodeLine{1231         AzBxCxDy,}
\DoxyCodeLine{1232         AzBxCxDz,}
\DoxyCodeLine{1233         AzBxCyDx,}
\DoxyCodeLine{1234         AzBxCyDy,}
\DoxyCodeLine{1235         AzBxCyDz,}
\DoxyCodeLine{1236         AzBxCzDx,}
\DoxyCodeLine{1237         AzBxCzDy,}
\DoxyCodeLine{1238         AzBxCzDz,}
\DoxyCodeLine{1239         AzByCxDx,}
\DoxyCodeLine{1240         AzByCxDy,}
\DoxyCodeLine{1241         AzByCxDz,}
\DoxyCodeLine{1242         AzByCyDx,}
\DoxyCodeLine{1243         AzByCyDy,}
\DoxyCodeLine{1244         AzByCyDz,}
\DoxyCodeLine{1245         AzByCzDx,}
\DoxyCodeLine{1246         AzByCzDy,}
\DoxyCodeLine{1247         AzByCzDz,}
\DoxyCodeLine{1248         AzBzCxDx,}
\DoxyCodeLine{1249         AzBzCxDy,}
\DoxyCodeLine{1250         AzBzCxDz,}
\DoxyCodeLine{1251         AzBzCyDx,}
\DoxyCodeLine{1252         AzBzCyDy,}
\DoxyCodeLine{1253         AzBzCyDz,}
\DoxyCodeLine{1254         AzBzCzDx,}
\DoxyCodeLine{1255         AzBzCzDy,}
\DoxyCodeLine{1256         AzBzCzDz,}
\DoxyCodeLine{1257       \};}
\DoxyCodeLine{1258   }
\DoxyCodeLine{1259   }
\DoxyCodeLine{1260 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{1261       \textcolor{keyword}{auto} topDirectSSSS = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{1262       std::vector<double> durDirectSSSSInt(nThreads, 0.);}
\DoxyCodeLine{1263       std::vector<double> durDirectSSSSCon(nThreads, 0.);}
\DoxyCodeLine{1264 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1265 }
\DoxyCodeLine{1266       nERI = 81;}
\DoxyCodeLine{1267       buffAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(nERI*buffN4*nThreads);}
\DoxyCodeLine{1268       cacheAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(cache\_size*nThreads);}
\DoxyCodeLine{1269       ERIBuffer = memManager\_.malloc<\textcolor{keywordtype}{double}>(16*NB4*nThreads);}
\DoxyCodeLine{1270 }
\DoxyCodeLine{1271       \textcolor{comment}{// Keeping track of number of integrals skipped}}
\DoxyCodeLine{1272       std::vector<size\_t> nIntSkipSSSS(nThreads,0);}
\DoxyCodeLine{1273 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{1274       std::vector<size\_t> nConSkipSSSS(nThreads,0);}
\DoxyCodeLine{1275 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1276       }
\DoxyCodeLine{1277       \textcolor{keyword}{auto} NB4\_4  = 4*NB4;  }
\DoxyCodeLine{1278       \textcolor{keyword}{auto} NB4\_5  = 5*NB4;  }
\DoxyCodeLine{1279       \textcolor{keyword}{auto} NB4\_6  = 6*NB4;  }
\DoxyCodeLine{1280       \textcolor{keyword}{auto} NB4\_7  = 7*NB4;  }
\DoxyCodeLine{1281       \textcolor{keyword}{auto} NB4\_8  = 8*NB4;  }
\DoxyCodeLine{1282       \textcolor{keyword}{auto} NB4\_9  = 9*NB4;  }
\DoxyCodeLine{1283       \textcolor{keyword}{auto} NB4\_10 =10*NB4;  }
\DoxyCodeLine{1284       \textcolor{keyword}{auto} NB4\_11 =11*NB4;  }
\DoxyCodeLine{1285       \textcolor{keyword}{auto} NB4\_12 =12*NB4;  }
\DoxyCodeLine{1286       \textcolor{keyword}{auto} NB4\_13 =13*NB4;  }
\DoxyCodeLine{1287       \textcolor{keyword}{auto} NB4\_14 =14*NB4;  }
\DoxyCodeLine{1288       \textcolor{keyword}{auto} NB4\_15 =15*NB4;  }
\DoxyCodeLine{1289 }
\DoxyCodeLine{1290 \textcolor{preprocessor}{      \#pragma omp parallel}}
\DoxyCodeLine{1291       \{}
\DoxyCodeLine{1292   }
\DoxyCodeLine{1293         \mbox{\hyperlink{chronusq__sys_8hpp_aa7b4cfa83fe868296abd1ba4d67d9563}{dcomplex}} iscale = \mbox{\hyperlink{chronusq__sys_8hpp_aa7b4cfa83fe868296abd1ba4d67d9563}{dcomplex}}(0.0, 1.0);}
\DoxyCodeLine{1294   }
\DoxyCodeLine{1295         \textcolor{keywordtype}{size\_t} thread\_id = \mbox{\hyperlink{namespaceChronusQ_aa348a017ee78c3450480773ddc542e5c}{GetThreadID}}();}
\DoxyCodeLine{1296   }
\DoxyCodeLine{1297         \textcolor{keyword}{auto} \&AX\_loc = AXthreads[thread\_id];}
\DoxyCodeLine{1298   }
\DoxyCodeLine{1299         \textcolor{keywordtype}{double} *ERIBuffABCD = \&ERIBuffer[thread\_id*16*NB4];}
\DoxyCodeLine{1300   }
\DoxyCodeLine{1301         \textcolor{keywordtype}{size\_t} n1,n2,n3,n4,m,n,k,l,mnkl,bf1,bf2,bf3,bf4;}
\DoxyCodeLine{1302         \textcolor{keywordtype}{size\_t} s4\_max;}
\DoxyCodeLine{1303   }
\DoxyCodeLine{1304         \textcolor{keywordtype}{int} shls[4];}
\DoxyCodeLine{1305         \textcolor{keywordtype}{double} *buff = \&buffAll[nERI*buffN4*thread\_id];}
\DoxyCodeLine{1306         \textcolor{keywordtype}{double} *cache = cacheAll+cache\_size*thread\_id;}
\DoxyCodeLine{1307   }
\DoxyCodeLine{1308         MatsT *ADCSSMS, *ADCSSMX, *ADCSSMY, *ADCSSMZ,}
\DoxyCodeLine{1309           *symmDCSSMS, *symmDCSSMX, *symmDCSSMY, *symmDCSSMZ; }
\DoxyCodeLine{1310         }
\DoxyCodeLine{1311         std::vector<size\_t> contract\_batch(nBatch);}
\DoxyCodeLine{1312         \textcolor{keywordtype}{size\_t} iCon, nCon, matOff;}
\DoxyCodeLine{1313 }
\DoxyCodeLine{1314 \textcolor{preprocessor}{\#if defined(\_SHZ\_SCREEN\_4C) \&\& defined(\_SEPARATED\_SHZ\_SCREEN\_4C)}}
\DoxyCodeLine{1315         std::vector<double> shMax123\_batch(nBatch);}
\DoxyCodeLine{1316 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{1317         std::iota(contract\_batch.begin(), contract\_batch.end(), 0);}
\DoxyCodeLine{1318         nCon = nBatch;}
\DoxyCodeLine{1319 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1320   }
\DoxyCodeLine{1321         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s1(0), bf1\_s(0), s1234(0); s1 < basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a936871b121472a416ee6f947ccdea4b4}{nShell}}; }
\DoxyCodeLine{1322             bf1\_s+=n1, s1++) \{ }
\DoxyCodeLine{1323   }
\DoxyCodeLine{1324           n1 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s1].size(); \textcolor{comment}{// Size of Shell 1}}
\DoxyCodeLine{1325   }
\DoxyCodeLine{1326         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s2(0), bf2\_s(0); s2 <= s1; bf2\_s+=n2, s2++) \{}
\DoxyCodeLine{1327   }
\DoxyCodeLine{1328           n2 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s2].size(); \textcolor{comment}{// Size of Shell 2}}
\DoxyCodeLine{1329   }
\DoxyCodeLine{1330 \textcolor{preprocessor}{\#ifdef \_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{1331           \textcolor{keywordtype}{double} shMax12 = ShBlkNorms[s1 + s2*nShell];}
\DoxyCodeLine{1332 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1333   }
\DoxyCodeLine{1334         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s3(0), bf3\_s(0); s3 <= s1; bf3\_s+=n3, s3++) \{}
\DoxyCodeLine{1335   }
\DoxyCodeLine{1336           n3 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s3].size(); \textcolor{comment}{// Size of Shell 3}}
\DoxyCodeLine{1337           s4\_max = (s1 == s3) ? s2 : s3; \textcolor{comment}{// Determine the unique max of Shell 4}}
\DoxyCodeLine{1338   }
\DoxyCodeLine{1339 \textcolor{preprocessor}{\#ifdef \_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{1340           \textcolor{keywordtype}{double} shMax123 = std::max(ShBlkNorms[s1 + s3*nShell], }
\DoxyCodeLine{1341                                      ShBlkNorms[s2 + s3*nShell]);}
\DoxyCodeLine{1342 }
\DoxyCodeLine{1343           shMax123 = std::max(shMax123,shMax12);}
\DoxyCodeLine{1344 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{1345           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iBatch = 0ul; iBatch < nBatch; iBatch++)}
\DoxyCodeLine{1346              shMax123\_batch[iBatch] = }
\DoxyCodeLine{1347                std::max(ShBlkNorms\_batch[iBatch][s1 + s2*nShell],}
\DoxyCodeLine{1348                std::max(ShBlkNorms\_batch[iBatch][s1 + s3*nShell],}
\DoxyCodeLine{1349                         ShBlkNorms\_batch[iBatch][s2 + s3*nShell]));}
\DoxyCodeLine{1350 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1351 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1352 }
\DoxyCodeLine{1353         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s4(0), bf4\_s(0); s4 <= s4\_max; bf4\_s+=n4, s4++, s1234++) \{}
\DoxyCodeLine{1354   }
\DoxyCodeLine{1355           n4 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s4].size(); \textcolor{comment}{// Size of Shell 4}}
\DoxyCodeLine{1356   }
\DoxyCodeLine{1357           \textcolor{comment}{// Round Robbin work distribution}}
\DoxyCodeLine{1358 \textcolor{preprocessor}{          \#ifdef \_OPENMP}}
\DoxyCodeLine{1359           \textcolor{keywordflow}{if}( s1234 \% nThreads != thread\_id ) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{1360 \textcolor{preprocessor}{          \#endif}}
\DoxyCodeLine{1361 }
\DoxyCodeLine{1362 \textcolor{preprocessor}{\#ifdef \_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{1363           \textcolor{keywordtype}{double} shMax = std::max(ShBlkNorms[s1 + s4*nShell],}
\DoxyCodeLine{1364                          std::max(ShBlkNorms[s2 + s4*nShell],}
\DoxyCodeLine{1365                                   ShBlkNorms[s3 + s4*nShell]));}
\DoxyCodeLine{1366 }
\DoxyCodeLine{1367           shMax = std::max(shMax,shMax123);}
\DoxyCodeLine{1368 }
\DoxyCodeLine{1369           \textcolor{keywordflow}{if}((shMax*SchwarzSSSS[s1+s2*nShell]*SchwarzSSSS[s3+s4*nShell]) <}
\DoxyCodeLine{1370               eri.\mbox{\hyperlink{classChronusQ_1_1DirectTPI_a51ce753ee588706401406d4216c1ba74}{threshSchwarz}}()) \{  }
\DoxyCodeLine{1371             nIntSkipSSSS[thread\_id]++;}
\DoxyCodeLine{1372 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{1373             nConSkipSSSS[thread\_id] += nBatch;}
\DoxyCodeLine{1374 \textcolor{preprocessor}{\#endif            }}
\DoxyCodeLine{1375             \textcolor{keywordflow}{continue}; }
\DoxyCodeLine{1376           \}}
\DoxyCodeLine{1377 }
\DoxyCodeLine{1378 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{1379           nCon = 0;}
\DoxyCodeLine{1380           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iBatch = 0ul; iBatch < nBatch; iBatch++) \{}
\DoxyCodeLine{1381             shMax = std::max(ShBlkNorms\_batch[iBatch][s1 + s4*nShell],}
\DoxyCodeLine{1382                     std::max(ShBlkNorms\_batch[iBatch][s2 + s4*nShell],}
\DoxyCodeLine{1383                              ShBlkNorms\_batch[iBatch][s3 + s4*nShell]));}
\DoxyCodeLine{1384             shMax = std::max(shMax, shMax123\_batch[iBatch]); }
\DoxyCodeLine{1385              }
\DoxyCodeLine{1386             \textcolor{keywordflow}{if}((shMax*SchwarzSSSS[s1+s2*nShell]*SchwarzSSSS[s3+s4*nShell]) <}
\DoxyCodeLine{1387               eri.\mbox{\hyperlink{classChronusQ_1_1DirectTPI_a51ce753ee588706401406d4216c1ba74}{threshSchwarz}}()) \{}
\DoxyCodeLine{1388               nConSkipSSSS[thread\_id] ++;}
\DoxyCodeLine{1389             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1390               contract\_batch[nCon] = iBatch; }
\DoxyCodeLine{1391               nCon++;  }
\DoxyCodeLine{1392             \}}
\DoxyCodeLine{1393           \}}
\DoxyCodeLine{1394 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1395 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1396 }
\DoxyCodeLine{1397 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{1398           \textcolor{keyword}{auto} topDirectSSSSInt = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{1399 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1400 }
\DoxyCodeLine{1401           \textcolor{keyword}{auto} nQuad = n1*n2*n3*n4;}
\DoxyCodeLine{1402   }
\DoxyCodeLine{1403           shls[0] = int(s1);}
\DoxyCodeLine{1404           shls[1] = int(s2);}
\DoxyCodeLine{1405           shls[2] = int(s3);}
\DoxyCodeLine{1406           shls[3] = int(s4);}
\DoxyCodeLine{1407   }
\DoxyCodeLine{1408           \textcolor{keywordflow}{if}(int2e\_ipvip1ipvip2\_sph(buff, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, cache)==0) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{1409   }
\DoxyCodeLine{1410           \textcolor{keywordflow}{for}(l = 3*maxShellSize, mnkl = 0ul; l < 3*maxShellSize + n4; ++l)}
\DoxyCodeLine{1411           \textcolor{keywordflow}{for}(k = 2*maxShellSize            ; k < 2*maxShellSize + n3; ++k) }
\DoxyCodeLine{1412           \textcolor{keywordflow}{for}(n =   maxShellSize            ; n <   maxShellSize + n2; ++n) }
\DoxyCodeLine{1413           \textcolor{keywordflow}{for}(m = 0                         ; m <                  n1; ++m, ++mnkl) \{}
\DoxyCodeLine{1414   }
\DoxyCodeLine{1415             \textcolor{comment}{// (∇A∙∇B)(∇C∙∇D)(mnkl)}}
\DoxyCodeLine{1416             \textcolor{keyword}{auto} dAdotdBdCdotdD =  buff[AxBxCxDx*nQuad+mnkl] + buff[AxBxCyDy*nQuad+mnkl] + buff[AxBxCzDz*nQuad+mnkl]}
\DoxyCodeLine{1417                                  + buff[AyByCxDx*nQuad+mnkl] + buff[AyByCyDy*nQuad+mnkl] + buff[AyByCzDz*nQuad+mnkl]}
\DoxyCodeLine{1418                                  + buff[AzBzCxDx*nQuad+mnkl] + buff[AzBzCyDy*nQuad+mnkl] + buff[AzBzCzDz*nQuad+mnkl];}
\DoxyCodeLine{1419   }
\DoxyCodeLine{1420             \textcolor{comment}{// (∇Ax∇B)(∇C∙∇D)(mnkl)}}
\DoxyCodeLine{1421             \textcolor{keyword}{auto} dAcrossdB\_xdCdotdD =  buff[AyBzCxDx*nQuad+mnkl] -\/ buff[AzByCxDx*nQuad+mnkl]}
\DoxyCodeLine{1422                                      + buff[AyBzCyDy*nQuad+mnkl] -\/ buff[AzByCyDy*nQuad+mnkl]}
\DoxyCodeLine{1423                                      + buff[AyBzCzDz*nQuad+mnkl] -\/ buff[AzByCzDz*nQuad+mnkl];}
\DoxyCodeLine{1424   }
\DoxyCodeLine{1425             \textcolor{keyword}{auto} dAcrossdB\_ydCdotdD = -\/buff[AxBzCxDx*nQuad+mnkl] + buff[AzBxCxDx*nQuad+mnkl]}
\DoxyCodeLine{1426                                       -\/buff[AxBzCyDy*nQuad+mnkl] + buff[AzBxCyDy*nQuad+mnkl]}
\DoxyCodeLine{1427                                       -\/buff[AxBzCzDz*nQuad+mnkl] + buff[AzBxCzDz*nQuad+mnkl];}
\DoxyCodeLine{1428                                       }
\DoxyCodeLine{1429             \textcolor{keyword}{auto} dAcrossdB\_zdCdotdD =  buff[AxByCxDx*nQuad+mnkl] -\/ buff[AyBxCxDx*nQuad+mnkl]}
\DoxyCodeLine{1430                                      + buff[AxByCyDy*nQuad+mnkl] -\/ buff[AyBxCyDy*nQuad+mnkl]}
\DoxyCodeLine{1431                                      + buff[AxByCzDz*nQuad+mnkl] -\/ buff[AyBxCzDz*nQuad+mnkl];}
\DoxyCodeLine{1432     }
\DoxyCodeLine{1433             \textcolor{comment}{// (∇A∙∇B)(∇Cx∇D)(mnkl)}}
\DoxyCodeLine{1434             \textcolor{keyword}{auto} dAdotdBdCcrossdD\_x =  buff[AxBxCyDz*nQuad+mnkl] -\/ buff[AxBxCzDy*nQuad+mnkl]}
\DoxyCodeLine{1435                                      + buff[AyByCyDz*nQuad+mnkl] -\/ buff[AyByCzDy*nQuad+mnkl]}
\DoxyCodeLine{1436                                      + buff[AzBzCyDz*nQuad+mnkl] -\/ buff[AzBzCzDy*nQuad+mnkl];}
\DoxyCodeLine{1437   }
\DoxyCodeLine{1438             \textcolor{keyword}{auto} dAdotdBdCcrossdD\_y = -\/buff[AxBxCxDz*nQuad+mnkl] + buff[AxBxCzDx*nQuad+mnkl]}
\DoxyCodeLine{1439                                       -\/buff[AyByCxDz*nQuad+mnkl] + buff[AyByCzDx*nQuad+mnkl]}
\DoxyCodeLine{1440                                       -\/buff[AzBzCxDz*nQuad+mnkl] + buff[AzBzCzDx*nQuad+mnkl];}
\DoxyCodeLine{1441                                       }
\DoxyCodeLine{1442             \textcolor{keyword}{auto} dAdotdBdCcrossdD\_z =  buff[AxBxCxDy*nQuad+mnkl] -\/ buff[AxBxCyDx*nQuad+mnkl]}
\DoxyCodeLine{1443                                      + buff[AyByCxDy*nQuad+mnkl] -\/ buff[AyByCyDx*nQuad+mnkl]}
\DoxyCodeLine{1444                                      + buff[AzBzCxDy*nQuad+mnkl] -\/ buff[AzBzCyDx*nQuad+mnkl];}
\DoxyCodeLine{1445   }
\DoxyCodeLine{1446             \textcolor{comment}{// (∇Ax∇B)(∇Cx∇D)(mnkl)}}
\DoxyCodeLine{1447             \textcolor{keyword}{auto} dAcrossdB\_xdCcrossdD\_x =  buff[AyBzCyDz*nQuad+mnkl] -\/ buff[AzByCyDz*nQuad+mnkl]}
\DoxyCodeLine{1448                                          -\/ buff[AyBzCzDy*nQuad+mnkl] + buff[AzByCzDy*nQuad+mnkl];}
\DoxyCodeLine{1449   }
\DoxyCodeLine{1450             \textcolor{keyword}{auto} dAcrossdB\_xdCcrossdD\_y =  buff[AyBzCzDx*nQuad+mnkl] -\/ buff[AzByCzDx*nQuad+mnkl]}
\DoxyCodeLine{1451                                          -\/ buff[AyBzCxDz*nQuad+mnkl] + buff[AzByCxDz*nQuad+mnkl];}
\DoxyCodeLine{1452   }
\DoxyCodeLine{1453             \textcolor{keyword}{auto} dAcrossdB\_xdCcrossdD\_z =  buff[AyBzCxDy*nQuad+mnkl] -\/ buff[AzByCxDy*nQuad+mnkl]}
\DoxyCodeLine{1454                                          -\/ buff[AyBzCyDx*nQuad+mnkl] + buff[AzByCyDx*nQuad+mnkl];}
\DoxyCodeLine{1455   }
\DoxyCodeLine{1456             \textcolor{keyword}{auto} dAcrossdB\_ydCcrossdD\_x =  buff[AzBxCyDz*nQuad+mnkl] -\/ buff[AxBzCyDz*nQuad+mnkl]}
\DoxyCodeLine{1457                                          -\/ buff[AzBxCzDy*nQuad+mnkl] + buff[AxBzCzDy*nQuad+mnkl];}
\DoxyCodeLine{1458   }
\DoxyCodeLine{1459             \textcolor{keyword}{auto} dAcrossdB\_ydCcrossdD\_y =  buff[AzBxCzDx*nQuad+mnkl] -\/ buff[AxBzCzDx*nQuad+mnkl]}
\DoxyCodeLine{1460                                          -\/ buff[AzBxCxDz*nQuad+mnkl] + buff[AxBzCxDz*nQuad+mnkl];}
\DoxyCodeLine{1461   }
\DoxyCodeLine{1462             \textcolor{keyword}{auto} dAcrossdB\_ydCcrossdD\_z =  buff[AzBxCxDy*nQuad+mnkl] -\/ buff[AxBzCxDy*nQuad+mnkl]}
\DoxyCodeLine{1463                                          -\/ buff[AzBxCyDx*nQuad+mnkl] + buff[AxBzCyDx*nQuad+mnkl];}
\DoxyCodeLine{1464   }
\DoxyCodeLine{1465             \textcolor{keyword}{auto} dAcrossdB\_zdCcrossdD\_x =  buff[AxByCyDz*nQuad+mnkl] -\/ buff[AyBxCyDz*nQuad+mnkl]}
\DoxyCodeLine{1466                                          -\/ buff[AxByCzDy*nQuad+mnkl] + buff[AyBxCzDy*nQuad+mnkl];}
\DoxyCodeLine{1467   }
\DoxyCodeLine{1468             \textcolor{keyword}{auto} dAcrossdB\_zdCcrossdD\_y =  buff[AxByCzDx*nQuad+mnkl] -\/ buff[AyBxCzDx*nQuad+mnkl]}
\DoxyCodeLine{1469                                          -\/ buff[AxByCxDz*nQuad+mnkl] + buff[AyBxCxDz*nQuad+mnkl];}
\DoxyCodeLine{1470   }
\DoxyCodeLine{1471             \textcolor{keyword}{auto} dAcrossdB\_zdCcrossdD\_z =  buff[AxByCxDy*nQuad+mnkl] -\/ buff[AyBxCxDy*nQuad+mnkl]}
\DoxyCodeLine{1472                                          -\/ buff[AxByCyDx*nQuad+mnkl] + buff[AyBxCyDx*nQuad+mnkl];}
\DoxyCodeLine{1473   }
\DoxyCodeLine{1474   }
\DoxyCodeLine{1475             \textcolor{keyword}{auto} MNKL = m + n*NB + k*NB2 + l*NB3;}
\DoxyCodeLine{1476             \textcolor{keyword}{auto} KLMN = k + l*NB + m*NB2 + n*NB3;}
\DoxyCodeLine{1477 }
\DoxyCodeLine{1478             \textcolor{comment}{// (mn|kl)}}
\DoxyCodeLine{1479             ERIBuffABCD[         MNKL] =  dAdotdBdCdotdD;}
\DoxyCodeLine{1480             ERIBuffABCD[   NB4 + MNKL] =  dAcrossdB\_xdCdotdD;}
\DoxyCodeLine{1481             ERIBuffABCD[ NB4\_2 + MNKL] =  dAcrossdB\_ydCdotdD;}
\DoxyCodeLine{1482             ERIBuffABCD[ NB4\_3 + MNKL] =  dAcrossdB\_zdCdotdD;}
\DoxyCodeLine{1483             ERIBuffABCD[ NB4\_4 + MNKL] =  dAdotdBdCcrossdD\_x;}
\DoxyCodeLine{1484             ERIBuffABCD[ NB4\_5 + MNKL] =  dAdotdBdCcrossdD\_y;}
\DoxyCodeLine{1485             ERIBuffABCD[ NB4\_6 + MNKL] =  dAdotdBdCcrossdD\_z;}
\DoxyCodeLine{1486             ERIBuffABCD[ NB4\_7 + MNKL] =  dAcrossdB\_xdCcrossdD\_x;}
\DoxyCodeLine{1487             ERIBuffABCD[ NB4\_8 + MNKL] =  dAcrossdB\_xdCcrossdD\_y;}
\DoxyCodeLine{1488             ERIBuffABCD[ NB4\_9 + MNKL] =  dAcrossdB\_xdCcrossdD\_z;}
\DoxyCodeLine{1489             ERIBuffABCD[NB4\_10 + MNKL] =  dAcrossdB\_ydCcrossdD\_x;}
\DoxyCodeLine{1490             ERIBuffABCD[NB4\_11 + MNKL] =  dAcrossdB\_ydCcrossdD\_y;}
\DoxyCodeLine{1491             ERIBuffABCD[NB4\_12 + MNKL] =  dAcrossdB\_ydCcrossdD\_z;}
\DoxyCodeLine{1492             ERIBuffABCD[NB4\_13 + MNKL] =  dAcrossdB\_zdCcrossdD\_x; }
\DoxyCodeLine{1493             ERIBuffABCD[NB4\_14 + MNKL] =  dAcrossdB\_zdCcrossdD\_y;}
\DoxyCodeLine{1494             ERIBuffABCD[NB4\_15 + MNKL] =  dAcrossdB\_zdCcrossdD\_z;}
\DoxyCodeLine{1495   }
\DoxyCodeLine{1496             \textcolor{comment}{// (kl|mn)}}
\DoxyCodeLine{1497             ERIBuffABCD[         KLMN] =  dAdotdBdCdotdD;}
\DoxyCodeLine{1498             ERIBuffABCD[   NB4 + KLMN] =  dAdotdBdCcrossdD\_x;}
\DoxyCodeLine{1499             ERIBuffABCD[ NB4\_2 + KLMN] =  dAdotdBdCcrossdD\_y;}
\DoxyCodeLine{1500             ERIBuffABCD[ NB4\_3 + KLMN] =  dAdotdBdCcrossdD\_z;}
\DoxyCodeLine{1501             ERIBuffABCD[ NB4\_4 + KLMN] =  dAcrossdB\_xdCdotdD;}
\DoxyCodeLine{1502             ERIBuffABCD[ NB4\_5 + KLMN] =  dAcrossdB\_ydCdotdD;}
\DoxyCodeLine{1503             ERIBuffABCD[ NB4\_6 + KLMN] =  dAcrossdB\_zdCdotdD;}
\DoxyCodeLine{1504             ERIBuffABCD[ NB4\_7 + KLMN] =  dAcrossdB\_xdCcrossdD\_x;}
\DoxyCodeLine{1505             ERIBuffABCD[ NB4\_8 + KLMN] =  dAcrossdB\_ydCcrossdD\_x;}
\DoxyCodeLine{1506             ERIBuffABCD[ NB4\_9 + KLMN] =  dAcrossdB\_zdCcrossdD\_x;}
\DoxyCodeLine{1507             ERIBuffABCD[NB4\_10 + KLMN] =  dAcrossdB\_xdCcrossdD\_y;}
\DoxyCodeLine{1508             ERIBuffABCD[NB4\_11 + KLMN] =  dAcrossdB\_ydCcrossdD\_y;}
\DoxyCodeLine{1509             ERIBuffABCD[NB4\_12 + KLMN] =  dAcrossdB\_zdCcrossdD\_y;}
\DoxyCodeLine{1510             ERIBuffABCD[NB4\_13 + KLMN] =  dAcrossdB\_xdCcrossdD\_z; }
\DoxyCodeLine{1511             ERIBuffABCD[NB4\_14 + KLMN] =  dAcrossdB\_ydCcrossdD\_z;}
\DoxyCodeLine{1512             ERIBuffABCD[NB4\_15 + KLMN] =  dAcrossdB\_zdCcrossdD\_z;}
\DoxyCodeLine{1513   }
\DoxyCodeLine{1514           \} \textcolor{comment}{// ∇A∇B∇C∇D (SSSS) integrals }}
\DoxyCodeLine{1515   }
\DoxyCodeLine{1516 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{1517           durDirectSSSSInt[thread\_id] += \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topDirectSSSSInt); }
\DoxyCodeLine{1518 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1519   }
\DoxyCodeLine{1520   }
\DoxyCodeLine{1521 \textcolor{preprocessor}{\#ifdef \_CONTRACTION\_ }\textcolor{comment}{// Contraction}}
\DoxyCodeLine{1522   }
\DoxyCodeLine{1523 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{1524           \textcolor{keyword}{auto} topDirectSSSSCon = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{1525 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1526           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iCon = 0ul; iCon < nCon; iCon++) \{  }
\DoxyCodeLine{1527           }
\DoxyCodeLine{1528             matOff = contract\_batch[iCon] * mMat; }
\DoxyCodeLine{1529             symmDCSSMS = matList[matOff].X-\/>S().pointer();}
\DoxyCodeLine{1530             symmDCSSMX = matList[matOff].X-\/>X().pointer();}
\DoxyCodeLine{1531             symmDCSSMY = matList[matOff].X-\/>Y().pointer();}
\DoxyCodeLine{1532             symmDCSSMZ = matList[matOff].X-\/>Z().pointer();}
\DoxyCodeLine{1533   }
\DoxyCodeLine{1534             ADCSSMS  = AX\_loc[matOff]-\/>S().pointer();}
\DoxyCodeLine{1535             ADCSSMX  = AX\_loc[matOff]-\/>X().pointer();}
\DoxyCodeLine{1536             ADCSSMY  = AX\_loc[matOff]-\/>Y().pointer();}
\DoxyCodeLine{1537             ADCSSMZ  = AX\_loc[matOff]-\/>Z().pointer();}
\DoxyCodeLine{1538   }
\DoxyCodeLine{1539           \textcolor{keywordflow}{for}(m = 0ul,            bf1 = bf1\_s; m <                  n1; ++m, bf1++) \{}
\DoxyCodeLine{1540 }
\DoxyCodeLine{1541           \textcolor{keywordflow}{for}(n =   maxShellSize, bf2 = bf2\_s; n <   maxShellSize + n2; ++n, bf2++) \{}
\DoxyCodeLine{1542             \textcolor{keyword}{auto} bf1nB = bf1*nBasis;}
\DoxyCodeLine{1543             \textcolor{keyword}{auto} bf2nB = bf2*nBasis;}
\DoxyCodeLine{1544             \textcolor{keyword}{auto} bf21 = bf2 + bf1nB;}
\DoxyCodeLine{1545             \textcolor{keyword}{auto} bf12 = bf1 + bf2nB;}
\DoxyCodeLine{1546             \textcolor{keyword}{auto} mn1 = m + n*NB;}
\DoxyCodeLine{1547             \textcolor{keyword}{auto} mn2 = m*NB2 + n*NB3;}
\DoxyCodeLine{1548 }
\DoxyCodeLine{1549           \textcolor{keywordflow}{for}(k = 2*maxShellSize, bf3 = bf3\_s; k < 2*maxShellSize + n3; ++k, bf3++) \{}
\DoxyCodeLine{1550             \textcolor{keyword}{auto} bf3nB = bf3*nBasis;}
\DoxyCodeLine{1551             \textcolor{keyword}{auto} kmn1 = mn1 + k*NB2;}
\DoxyCodeLine{1552             \textcolor{keyword}{auto} kmn2 = k + mn2;}
\DoxyCodeLine{1553 }
\DoxyCodeLine{1554           \textcolor{keywordflow}{for}(l = 3*maxShellSize, bf4 = bf4\_s; l < 3*maxShellSize + n4; ++l, bf4++) \{}
\DoxyCodeLine{1555             \textcolor{keyword}{auto} MNKL = kmn1 + l*NB3;}
\DoxyCodeLine{1556             \textcolor{keyword}{auto} KLMN = kmn2 + l*NB;}
\DoxyCodeLine{1557 }
\DoxyCodeLine{1558             \textcolor{keyword}{auto} bf4nB = bf4*nBasis;}
\DoxyCodeLine{1559   }
\DoxyCodeLine{1560             \textcolor{keyword}{auto} bf14 = bf1 + bf4nB;}
\DoxyCodeLine{1561             \textcolor{keyword}{auto} bf24 = bf2 + bf4nB;}
\DoxyCodeLine{1562             \textcolor{keyword}{auto} bf23 = bf2 + bf3nB;}
\DoxyCodeLine{1563             \textcolor{keyword}{auto} bf13 = bf1 + bf3nB;}
\DoxyCodeLine{1564 }
\DoxyCodeLine{1565             \textcolor{keyword}{auto} bf41 = bf4 + bf1nB;}
\DoxyCodeLine{1566             \textcolor{keyword}{auto} bf31 = bf3 + bf1nB;}
\DoxyCodeLine{1567             \textcolor{keyword}{auto} bf32 = bf3 + bf2nB;}
\DoxyCodeLine{1568             \textcolor{keyword}{auto} bf42 = bf4 + bf2nB;}
\DoxyCodeLine{1569  }
\DoxyCodeLine{1570 }
\DoxyCodeLine{1571             \textcolor{keyword}{auto} bf43 = bf4 + bf3nB;}
\DoxyCodeLine{1572             \textcolor{keyword}{auto} bf34 = bf3 + bf4nB;}
\DoxyCodeLine{1573   }
\DoxyCodeLine{1574  }
\DoxyCodeLine{1575 }
\DoxyCodeLine{1576 \textcolor{comment}{            /*********************************/}}
\DoxyCodeLine{1577             \textcolor{comment}{/* Dirac-\/Coulomb (SSSS) Integral */}}
\DoxyCodeLine{1578 \textcolor{comment}{            /*********************************/}}
\DoxyCodeLine{1579       }
\DoxyCodeLine{1580   }
\DoxyCodeLine{1581             \textcolor{keyword}{auto} MNKLdAdotdBdCdotdD          = ERIBuffABCD[         MNKL];}
\DoxyCodeLine{1582             \textcolor{keyword}{auto} MNKLdAcrossdB\_xdCdotdD      = ERIBuffABCD[   NB4 + MNKL];}
\DoxyCodeLine{1583             \textcolor{keyword}{auto} MNKLdAcrossdB\_ydCdotdD      = ERIBuffABCD[ NB4\_2 + MNKL];}
\DoxyCodeLine{1584             \textcolor{keyword}{auto} MNKLdAcrossdB\_zdCdotdD      = ERIBuffABCD[ NB4\_3 + MNKL];}
\DoxyCodeLine{1585             \textcolor{keyword}{auto} MNKLdAdotdBdCcrossdD\_x      = ERIBuffABCD[ NB4\_4 + MNKL];}
\DoxyCodeLine{1586             \textcolor{keyword}{auto} MNKLdAdotdBdCcrossdD\_y      = ERIBuffABCD[ NB4\_5 + MNKL];}
\DoxyCodeLine{1587             \textcolor{keyword}{auto} MNKLdAdotdBdCcrossdD\_z      = ERIBuffABCD[ NB4\_6 + MNKL];}
\DoxyCodeLine{1588             \textcolor{keyword}{auto} MNKLdAcrossdB\_xdCcrossdD\_x  = ERIBuffABCD[ NB4\_7 + MNKL];}
\DoxyCodeLine{1589             \textcolor{keyword}{auto} MNKLdAcrossdB\_xdCcrossdD\_y  = ERIBuffABCD[ NB4\_8 + MNKL];}
\DoxyCodeLine{1590             \textcolor{keyword}{auto} MNKLdAcrossdB\_xdCcrossdD\_z  = ERIBuffABCD[ NB4\_9 + MNKL];}
\DoxyCodeLine{1591             \textcolor{keyword}{auto} MNKLdAcrossdB\_ydCcrossdD\_x  = ERIBuffABCD[NB4\_10 + MNKL];}
\DoxyCodeLine{1592             \textcolor{keyword}{auto} MNKLdAcrossdB\_ydCcrossdD\_y  = ERIBuffABCD[NB4\_11 + MNKL];}
\DoxyCodeLine{1593             \textcolor{keyword}{auto} MNKLdAcrossdB\_ydCcrossdD\_z  = ERIBuffABCD[NB4\_12 + MNKL];}
\DoxyCodeLine{1594             \textcolor{keyword}{auto} MNKLdAcrossdB\_zdCcrossdD\_x  = ERIBuffABCD[NB4\_13 + MNKL];}
\DoxyCodeLine{1595             \textcolor{keyword}{auto} MNKLdAcrossdB\_zdCcrossdD\_y  = ERIBuffABCD[NB4\_14 + MNKL];}
\DoxyCodeLine{1596             \textcolor{keyword}{auto} MNKLdAcrossdB\_zdCcrossdD\_z  = ERIBuffABCD[NB4\_15 + MNKL];}
\DoxyCodeLine{1597 }
\DoxyCodeLine{1598             \textcolor{keyword}{auto} KLMNdAdotdBdCdotdD          = ERIBuffABCD[         KLMN];}
\DoxyCodeLine{1599             \textcolor{keyword}{auto} KLMNdAcrossdB\_xdCdotdD      = ERIBuffABCD[   NB4 + KLMN];}
\DoxyCodeLine{1600             \textcolor{keyword}{auto} KLMNdAcrossdB\_ydCdotdD      = ERIBuffABCD[ NB4\_2 + KLMN];}
\DoxyCodeLine{1601             \textcolor{keyword}{auto} KLMNdAcrossdB\_zdCdotdD      = ERIBuffABCD[ NB4\_3 + KLMN];}
\DoxyCodeLine{1602             \textcolor{keyword}{auto} KLMNdAdotdBdCcrossdD\_x      = ERIBuffABCD[ NB4\_4 + KLMN];}
\DoxyCodeLine{1603             \textcolor{keyword}{auto} KLMNdAdotdBdCcrossdD\_y      = ERIBuffABCD[ NB4\_5 + KLMN];}
\DoxyCodeLine{1604             \textcolor{keyword}{auto} KLMNdAdotdBdCcrossdD\_z      = ERIBuffABCD[ NB4\_6 + KLMN];}
\DoxyCodeLine{1605             \textcolor{keyword}{auto} KLMNdAcrossdB\_xdCcrossdD\_x  = ERIBuffABCD[ NB4\_7 + KLMN];}
\DoxyCodeLine{1606             \textcolor{keyword}{auto} KLMNdAcrossdB\_xdCcrossdD\_y  = ERIBuffABCD[ NB4\_8 + KLMN];}
\DoxyCodeLine{1607             \textcolor{keyword}{auto} KLMNdAcrossdB\_xdCcrossdD\_z  = ERIBuffABCD[ NB4\_9 + KLMN];}
\DoxyCodeLine{1608             \textcolor{keyword}{auto} KLMNdAcrossdB\_ydCcrossdD\_x  = ERIBuffABCD[NB4\_10 + KLMN];}
\DoxyCodeLine{1609             \textcolor{keyword}{auto} KLMNdAcrossdB\_ydCcrossdD\_y  = ERIBuffABCD[NB4\_11 + KLMN];}
\DoxyCodeLine{1610             \textcolor{keyword}{auto} KLMNdAcrossdB\_ydCcrossdD\_z  = ERIBuffABCD[NB4\_12 + KLMN];}
\DoxyCodeLine{1611             \textcolor{keyword}{auto} KLMNdAcrossdB\_zdCcrossdD\_x  = ERIBuffABCD[NB4\_13 + KLMN];}
\DoxyCodeLine{1612             \textcolor{keyword}{auto} KLMNdAcrossdB\_zdCcrossdD\_y  = ERIBuffABCD[NB4\_14 + KLMN];}
\DoxyCodeLine{1613             \textcolor{keyword}{auto} KLMNdAcrossdB\_zdCcrossdD\_z  = ERIBuffABCD[NB4\_15 + KLMN];}
\DoxyCodeLine{1614  }
\DoxyCodeLine{1615             \textcolor{comment}{// COULOMB}}
\DoxyCodeLine{1616             \textcolor{comment}{// MNKL}}
\DoxyCodeLine{1617             \textcolor{keyword}{auto} ScaleF = bf3\_s==bf4\_s ? 0.5 : 1.0;}
\DoxyCodeLine{1618   }
\DoxyCodeLine{1619             \textcolor{keywordflow}{if}(bf1 >= bf2) \{}
\DoxyCodeLine{1620 }
\DoxyCodeLine{1621               \textcolor{comment}{/* Equation 70 in the paper */}}
\DoxyCodeLine{1622               ADCSSMS[bf12] += ScaleF * (}
\DoxyCodeLine{1623                      symmDCSSMS[bf43] * MNKLdAdotdBdCdotdD}
\DoxyCodeLine{1624                  + ( symmDCSSMZ[bf43] * MNKLdAdotdBdCcrossdD\_z}
\DoxyCodeLine{1625                     +symmDCSSMX[bf43] * MNKLdAdotdBdCcrossdD\_x}
\DoxyCodeLine{1626                     +symmDCSSMY[bf43] * MNKLdAdotdBdCcrossdD\_y) * \mbox{\hyperlink{chronusq__sys_8hpp_aa7b4cfa83fe868296abd1ba4d67d9563}{dcomplex}}(0.,1.) );}
\DoxyCodeLine{1627                }
\DoxyCodeLine{1628               \textcolor{comment}{/* Equation 71 in the paper */}}
\DoxyCodeLine{1629               ADCSSMZ[bf12] += ScaleF * (}
\DoxyCodeLine{1630                   symmDCSSMS[bf43] * MNKLdAcrossdB\_zdCdotdD * \mbox{\hyperlink{chronusq__sys_8hpp_aa7b4cfa83fe868296abd1ba4d67d9563}{dcomplex}}(0.,1.)}
\DoxyCodeLine{1631                  -\/symmDCSSMZ[bf43] * MNKLdAcrossdB\_zdCcrossdD\_z}
\DoxyCodeLine{1632                  -\/symmDCSSMX[bf43] * MNKLdAcrossdB\_zdCcrossdD\_x}
\DoxyCodeLine{1633                  -\/symmDCSSMY[bf43] * MNKLdAcrossdB\_zdCcrossdD\_y );}
\DoxyCodeLine{1634        }
\DoxyCodeLine{1635               \textcolor{comment}{/* Equation 72 in the paper */}}
\DoxyCodeLine{1636               ADCSSMX[bf12] += ScaleF * (}
\DoxyCodeLine{1637                   symmDCSSMS[bf43] * MNKLdAcrossdB\_xdCdotdD * \mbox{\hyperlink{chronusq__sys_8hpp_aa7b4cfa83fe868296abd1ba4d67d9563}{dcomplex}}(0.,1.)}
\DoxyCodeLine{1638                  -\/symmDCSSMZ[bf43] * MNKLdAcrossdB\_xdCcrossdD\_z}
\DoxyCodeLine{1639                  -\/symmDCSSMX[bf43] * MNKLdAcrossdB\_xdCcrossdD\_x}
\DoxyCodeLine{1640                  -\/symmDCSSMY[bf43] * MNKLdAcrossdB\_xdCcrossdD\_y );}
\DoxyCodeLine{1641         }
\DoxyCodeLine{1642               \textcolor{comment}{/* Equation 73 in the paper */}}
\DoxyCodeLine{1643               ADCSSMY[bf12] += ScaleF * (}
\DoxyCodeLine{1644                   symmDCSSMS[bf43] * MNKLdAcrossdB\_ydCdotdD * \mbox{\hyperlink{chronusq__sys_8hpp_aa7b4cfa83fe868296abd1ba4d67d9563}{dcomplex}}(0.,1.)}
\DoxyCodeLine{1645                  -\/symmDCSSMZ[bf43] * MNKLdAcrossdB\_ydCcrossdD\_z}
\DoxyCodeLine{1646                  -\/symmDCSSMX[bf43] * MNKLdAcrossdB\_ydCcrossdD\_x}
\DoxyCodeLine{1647                  -\/symmDCSSMY[bf43] * MNKLdAcrossdB\_ydCcrossdD\_y );}
\DoxyCodeLine{1648             \}}
\DoxyCodeLine{1649   }
\DoxyCodeLine{1650             \textcolor{comment}{/* KLMN */}}
\DoxyCodeLine{1651             \textcolor{keywordflow}{if}((bf1\_s!=bf3\_s or bf2\_s!=bf4\_s) and bf3 >= bf4)\{}
\DoxyCodeLine{1652  }
\DoxyCodeLine{1653               ScaleF = bf1\_s==bf2\_s ? 0.5 : 1.0;}
\DoxyCodeLine{1654               }
\DoxyCodeLine{1655               \textcolor{comment}{/* Equation 70 in the paper */}}
\DoxyCodeLine{1656               ADCSSMS[bf34] += ScaleF * (}
\DoxyCodeLine{1657                      symmDCSSMS[bf21] * KLMNdAdotdBdCdotdD}
\DoxyCodeLine{1658                  + ( symmDCSSMZ[bf21] * KLMNdAdotdBdCcrossdD\_z}
\DoxyCodeLine{1659                     +symmDCSSMX[bf21] * KLMNdAdotdBdCcrossdD\_x}
\DoxyCodeLine{1660                     +symmDCSSMY[bf21] * KLMNdAdotdBdCcrossdD\_y) * \mbox{\hyperlink{chronusq__sys_8hpp_aa7b4cfa83fe868296abd1ba4d67d9563}{dcomplex}}(0.,1.) );}
\DoxyCodeLine{1661   }
\DoxyCodeLine{1662               \textcolor{comment}{/* Equation 71 in the paper */}}
\DoxyCodeLine{1663               ADCSSMZ[bf34] += ScaleF * (}
\DoxyCodeLine{1664                   symmDCSSMS[bf21] * KLMNdAcrossdB\_zdCdotdD * \mbox{\hyperlink{chronusq__sys_8hpp_aa7b4cfa83fe868296abd1ba4d67d9563}{dcomplex}}(0.,1.) }
\DoxyCodeLine{1665                  -\/symmDCSSMZ[bf21] * KLMNdAcrossdB\_zdCcrossdD\_z}
\DoxyCodeLine{1666                  -\/symmDCSSMX[bf21] * KLMNdAcrossdB\_zdCcrossdD\_x}
\DoxyCodeLine{1667                  -\/symmDCSSMY[bf21] * KLMNdAcrossdB\_zdCcrossdD\_y );}
\DoxyCodeLine{1668       }
\DoxyCodeLine{1669               \textcolor{comment}{/* Equation 72 in the paper */}}
\DoxyCodeLine{1670               ADCSSMX[bf34] += ScaleF * (}
\DoxyCodeLine{1671                   symmDCSSMS[bf21] * KLMNdAcrossdB\_xdCdotdD * \mbox{\hyperlink{chronusq__sys_8hpp_aa7b4cfa83fe868296abd1ba4d67d9563}{dcomplex}}(0.,1.)}
\DoxyCodeLine{1672                  -\/symmDCSSMZ[bf21] * KLMNdAcrossdB\_xdCcrossdD\_z}
\DoxyCodeLine{1673                  -\/symmDCSSMX[bf21] * KLMNdAcrossdB\_xdCcrossdD\_x}
\DoxyCodeLine{1674                  -\/symmDCSSMY[bf21] * KLMNdAcrossdB\_xdCcrossdD\_y );}
\DoxyCodeLine{1675       }
\DoxyCodeLine{1676               \textcolor{comment}{/* Equation 73 in the paper */}}
\DoxyCodeLine{1677               ADCSSMY[bf34] += ScaleF * (}
\DoxyCodeLine{1678                   symmDCSSMS[bf21] * KLMNdAcrossdB\_ydCdotdD * \mbox{\hyperlink{chronusq__sys_8hpp_aa7b4cfa83fe868296abd1ba4d67d9563}{dcomplex}}(0.,1.)}
\DoxyCodeLine{1679                  -\/symmDCSSMZ[bf21] * KLMNdAcrossdB\_ydCcrossdD\_z}
\DoxyCodeLine{1680                  -\/symmDCSSMX[bf21] * KLMNdAcrossdB\_ydCcrossdD\_x}
\DoxyCodeLine{1681                  -\/symmDCSSMY[bf21] * KLMNdAcrossdB\_ydCcrossdD\_y);}
\DoxyCodeLine{1682             \}}
\DoxyCodeLine{1683   }
\DoxyCodeLine{1684           \}}
\DoxyCodeLine{1685           \}}
\DoxyCodeLine{1686           \}}
\DoxyCodeLine{1687       \} }
\DoxyCodeLine{1688       \} \textcolor{comment}{// contraction loop}}
\DoxyCodeLine{1689   }
\DoxyCodeLine{1690 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// Contraction}}
\DoxyCodeLine{1691   }
\DoxyCodeLine{1692 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{1693         durDirectSSSSCon[thread\_id] += \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topDirectSSSSCon); }
\DoxyCodeLine{1694 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1695   }
\DoxyCodeLine{1696       \}; \textcolor{comment}{// loop s4}}
\DoxyCodeLine{1697       \}; \textcolor{comment}{// loop s3}}
\DoxyCodeLine{1698       \}; \textcolor{comment}{// loop s2}}
\DoxyCodeLine{1699       \}; \textcolor{comment}{// loop s1}}
\DoxyCodeLine{1700   }
\DoxyCodeLine{1701   }
\DoxyCodeLine{1702       \}; \textcolor{comment}{// OpenMP context}}
\DoxyCodeLine{1703   }
\DoxyCodeLine{1704       \textcolor{keywordflow}{for}( \textcolor{keyword}{auto} iTh  = 0; iTh < nThreads; iTh++) \{}
\DoxyCodeLine{1705       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iBatch = 0ul, matOff = 0ul; iBatch < nBatch; iBatch++, matOff+=mMat) \{  }
\DoxyCodeLine{1706         matList[matOff].AX-\/>S() +=  AXthreads[iTh][matOff]-\/>S();  }
\DoxyCodeLine{1707         matList[matOff].AX-\/>X() +=  AXthreads[iTh][matOff]-\/>X();  }
\DoxyCodeLine{1708         matList[matOff].AX-\/>Y() +=  AXthreads[iTh][matOff]-\/>Y();  }
\DoxyCodeLine{1709         matList[matOff].AX-\/>Z() +=  AXthreads[iTh][matOff]-\/>Z();  }
\DoxyCodeLine{1710       \}\}}
\DoxyCodeLine{1711       }
\DoxyCodeLine{1712       \textcolor{comment}{// take care of symmetries}}
\DoxyCodeLine{1713       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iBatch = 0ul, matOff = 0ul; iBatch < nBatch; iBatch++, matOff+=mMat) \{  }
\DoxyCodeLine{1714         \textcolor{keyword}{auto} ADCSSMS = matList[matOff].AX-\/>S().pointer();}
\DoxyCodeLine{1715         \textcolor{keyword}{auto} ADCSSMX = matList[matOff].AX-\/>X().pointer();}
\DoxyCodeLine{1716         \textcolor{keyword}{auto} ADCSSMY = matList[matOff].AX-\/>Y().pointer();}
\DoxyCodeLine{1717         \textcolor{keyword}{auto} ADCSSMZ = matList[matOff].AX-\/>Z().pointer();}
\DoxyCodeLine{1718         \textcolor{keywordflow}{for}( \textcolor{keyword}{auto} i = 0; i < nBasis; i++ ) }
\DoxyCodeLine{1719         \textcolor{keywordflow}{for}( \textcolor{keyword}{auto} j = 0; j < i; j++ ) \{}
\DoxyCodeLine{1720           ADCSSMS[j + i*nBasis] =  ADCSSMS[i + j*nBasis];}
\DoxyCodeLine{1721           ADCSSMZ[j + i*nBasis] = -\/ADCSSMZ[i + j*nBasis];}
\DoxyCodeLine{1722           ADCSSMX[j + i*nBasis] = -\/ADCSSMX[i + j*nBasis];}
\DoxyCodeLine{1723           ADCSSMY[j + i*nBasis] = -\/ADCSSMY[i + j*nBasis];}
\DoxyCodeLine{1724         \}}
\DoxyCodeLine{1725       \} }
\DoxyCodeLine{1726 }
\DoxyCodeLine{1727       memManager\_.free(ERIBuffer);}
\DoxyCodeLine{1728       memManager\_.free(buffAll, cacheAll);}
\DoxyCodeLine{1729 }
\DoxyCodeLine{1730 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{1731       \textcolor{keywordtype}{size\_t} nIntSkipSSSSAcc = std::accumulate(nIntSkipSSSS.begin(),nIntSkipSSSS.end(),0);}
\DoxyCodeLine{1732       \textcolor{keywordtype}{double} durDirectSSSSIntAcc = std::accumulate(durDirectSSSSInt.begin(), durDirectSSSSInt.end(),0.);}
\DoxyCodeLine{1733       \textcolor{keywordtype}{double} durDirectSSSSConAcc = std::accumulate(durDirectSSSSCon.begin(), durDirectSSSSCon.end(),0.);}
\DoxyCodeLine{1734       }
\DoxyCodeLine{1735       std::cout << std::endl;}
\DoxyCodeLine{1736       std::cout << \textcolor{stringliteral}{"{}Dirac-\/Coulomb-\/SSSS Skipped Integral   : "{}} << nIntSkipSSSSAcc << std::endl;}
\DoxyCodeLine{1737   }
\DoxyCodeLine{1738 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{1739       \textcolor{keywordtype}{size\_t} nConSkipSSSSAcc = std::accumulate(nConSkipSSSS.begin(),nConSkipSSSS.end(),0);}
\DoxyCodeLine{1740       std::cout << \textcolor{stringliteral}{"{}                         Skipped Contraction: "{}} << nConSkipSSSSAcc << std::endl;}
\DoxyCodeLine{1741 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1742       \textcolor{keyword}{auto} durDirectSSSS = \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topDirectSSSS);}
\DoxyCodeLine{1743       std::cout << \textcolor{stringliteral}{"{}Dirac-\/Coulomb-\/SSSS AO Direct Contraction took "{}} <<  durDirectSSSS}
\DoxyCodeLine{1744                 << \textcolor{stringliteral}{"{} s for "{}} << nBatch << \textcolor{stringliteral}{"{} Batch "{}} << std::endl; }
\DoxyCodeLine{1745       std::cout << \textcolor{stringliteral}{"{}                          Build Integrals took "{}} <<  durDirectSSSSIntAcc << \textcolor{stringliteral}{"{} s"{}} }
\DoxyCodeLine{1746                 << \textcolor{stringliteral}{"{} from all "{}} << nThreads << \textcolor{stringliteral}{"{} thread(s)"{}} << std::endl;}
\DoxyCodeLine{1747       std::cout << \textcolor{stringliteral}{"{}                          Contractions    took "{}} <<  durDirectSSSSConAcc << \textcolor{stringliteral}{"{} s"{}}}
\DoxyCodeLine{1748                 << \textcolor{stringliteral}{"{} from all "{}} << nThreads << \textcolor{stringliteral}{"{} thread(s)"{}} << std::endl;}
\DoxyCodeLine{1749 }
\DoxyCodeLine{1750       std::cout << std::endl;}
\DoxyCodeLine{1751 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1752   }
\DoxyCodeLine{1753     \} \textcolor{comment}{// if(SSSS)}}
\DoxyCodeLine{1754 }
\DoxyCodeLine{1755 \textcolor{comment}{    /*************************************/}}
\DoxyCodeLine{1756     \textcolor{comment}{/*                                   */}}
\DoxyCodeLine{1757     \textcolor{comment}{/* End of Dirac-\/Coulomb C(4)-\/SSSS    */}}
\DoxyCodeLine{1758     \textcolor{comment}{/*                                   */}}
\DoxyCodeLine{1759 \textcolor{comment}{    /*************************************/}}
\DoxyCodeLine{1760 }
\DoxyCodeLine{1761 }
\DoxyCodeLine{1762 \textcolor{comment}{    /*******************/}}
\DoxyCodeLine{1763     \textcolor{comment}{/*                 */}}
\DoxyCodeLine{1764     \textcolor{comment}{/* Start of Gaunt  */}}
\DoxyCodeLine{1765     \textcolor{comment}{/*                 */}}
\DoxyCodeLine{1766 \textcolor{comment}{    /*******************/}}
\DoxyCodeLine{1767 }
\DoxyCodeLine{1768     \textcolor{keywordflow}{if}( matList[0].contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba619fb0d8a58386d6c365eb7fa1bae867}{TWOBODY\_CONTRACTION\_TYPE::GAUNT}} ) \{}
\DoxyCodeLine{1769 }
\DoxyCodeLine{1770       \textcolor{keyword}{enum} Gaunt\_2ND\_DERIV\_AC \{}
\DoxyCodeLine{1771         AxCx,}
\DoxyCodeLine{1772         AxCy,}
\DoxyCodeLine{1773         AxCz,}
\DoxyCodeLine{1774         AyCx,}
\DoxyCodeLine{1775         AyCy,}
\DoxyCodeLine{1776         AyCz,}
\DoxyCodeLine{1777         AzCx,}
\DoxyCodeLine{1778         AzCy,}
\DoxyCodeLine{1779         AzCz}
\DoxyCodeLine{1780       \};}
\DoxyCodeLine{1781   }
\DoxyCodeLine{1782       \textcolor{keyword}{enum} Gaunt\_2ND\_DERIV\_BC \{}
\DoxyCodeLine{1783         BxCx,}
\DoxyCodeLine{1784         BxCy,}
\DoxyCodeLine{1785         BxCz,}
\DoxyCodeLine{1786         ByCx,}
\DoxyCodeLine{1787         ByCy,}
\DoxyCodeLine{1788         ByCz,}
\DoxyCodeLine{1789         BzCx,}
\DoxyCodeLine{1790         BzCy,}
\DoxyCodeLine{1791         BzCz}
\DoxyCodeLine{1792       \};}
\DoxyCodeLine{1793   }
\DoxyCodeLine{1794       \textcolor{keyword}{auto} NB4\_4  = 4*NB4;  }
\DoxyCodeLine{1795       \textcolor{keyword}{auto} NB4\_5  = 5*NB4;  }
\DoxyCodeLine{1796       \textcolor{keyword}{auto} NB4\_6  = 6*NB4;  }
\DoxyCodeLine{1797       \textcolor{keyword}{auto} NB4\_7  = 7*NB4;  }
\DoxyCodeLine{1798       \textcolor{keyword}{auto} NB4\_8  = 8*NB4;  }
\DoxyCodeLine{1799       \textcolor{keyword}{auto} NB4\_9  = 9*NB4;  }
\DoxyCodeLine{1800       \textcolor{keyword}{auto} NB4\_10 =10*NB4;  }
\DoxyCodeLine{1801       \textcolor{keyword}{auto} NB4\_11 =11*NB4;  }
\DoxyCodeLine{1802       \textcolor{keyword}{auto} NB4\_12 =12*NB4;  }
\DoxyCodeLine{1803 }
\DoxyCodeLine{1804 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{1805       \textcolor{keyword}{auto} topDirectGaunt = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{1806       std::vector<double> durDirectGauntInt(nThreads, 0.);}
\DoxyCodeLine{1807       std::vector<double> durDirectGauntCon(nThreads, 0.);}
\DoxyCodeLine{1808 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1809 }
\DoxyCodeLine{1810       nERI = 9;}
\DoxyCodeLine{1811       buffAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(nERI*buffN4*nThreads);}
\DoxyCodeLine{1812       cacheAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(cache\_size*nThreads);}
\DoxyCodeLine{1813 }
\DoxyCodeLine{1814       \textcolor{keywordtype}{int} nSave = 13;}
\DoxyCodeLine{1815       ERIBuffer = memManager\_.malloc<\textcolor{keywordtype}{double}>(nSave*NB4*nThreads);}
\DoxyCodeLine{1816       }
\DoxyCodeLine{1817       std::vector<size\_t> nIntSkipGaunt(nThreads,0);}
\DoxyCodeLine{1818 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{1819       std::vector<size\_t> nConSkipGaunt(nThreads,0);}
\DoxyCodeLine{1820 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1821 }
\DoxyCodeLine{1822 \textcolor{preprocessor}{      \#pragma omp parallel}}
\DoxyCodeLine{1823       \{}
\DoxyCodeLine{1824   }
\DoxyCodeLine{1825         \mbox{\hyperlink{chronusq__sys_8hpp_aa7b4cfa83fe868296abd1ba4d67d9563}{dcomplex}} iS = \mbox{\hyperlink{chronusq__sys_8hpp_aa7b4cfa83fe868296abd1ba4d67d9563}{dcomplex}}(0.0, 1.0);}
\DoxyCodeLine{1826   }
\DoxyCodeLine{1827         \textcolor{keywordtype}{size\_t} thread\_id = \mbox{\hyperlink{namespaceChronusQ_aa348a017ee78c3450480773ddc542e5c}{GetThreadID}}();}
\DoxyCodeLine{1828   }
\DoxyCodeLine{1829         \textcolor{keyword}{auto} \&AX\_loc = AXthreads[thread\_id];}
\DoxyCodeLine{1830   }
\DoxyCodeLine{1831         \textcolor{keywordtype}{double} *BC   = \&ERIBuffer[thread\_id*nSave*NB4];}
\DoxyCodeLine{1832   }
\DoxyCodeLine{1833         \textcolor{keywordtype}{size\_t} n1,n2,n3,n4,m,n,k,l,mnkl,bf1,bf2,bf3,bf4;}
\DoxyCodeLine{1834         \textcolor{keywordtype}{size\_t} s4\_max;}
\DoxyCodeLine{1835   }
\DoxyCodeLine{1836         \textcolor{keywordtype}{int} shls[4];}
\DoxyCodeLine{1837         \textcolor{keywordtype}{double} *buff = \&buffAll[nERI*buffN4*thread\_id];}
\DoxyCodeLine{1838         \textcolor{keywordtype}{double} *cache = cacheAll+cache\_size*thread\_id;}
\DoxyCodeLine{1839   }
\DoxyCodeLine{1840         std::vector<size\_t> contract\_batch(nBatch);}
\DoxyCodeLine{1841         \textcolor{keywordtype}{size\_t} iCon, nCon, matOff;}
\DoxyCodeLine{1842         }
\DoxyCodeLine{1843 \textcolor{preprocessor}{\#if defined(\_SHZ\_SCREEN\_4C) \&\& defined(\_SEPARATED\_SHZ\_SCREEN\_4C)}}
\DoxyCodeLine{1844         std::vector<double> shMax123\_batch(nBatch);}
\DoxyCodeLine{1845 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{1846         std::iota(contract\_batch.begin(), contract\_batch.end(), 0);}
\DoxyCodeLine{1847         nCon = nBatch;}
\DoxyCodeLine{1848 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1849         }
\DoxyCodeLine{1850         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s1(0), bf1\_s(0), s1234(0); s1 < nShell; bf1\_s+=n1, s1++) \{ }
\DoxyCodeLine{1851   }
\DoxyCodeLine{1852           n1 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s1].size(); \textcolor{comment}{// Size of Shell 1}}
\DoxyCodeLine{1853   }
\DoxyCodeLine{1854         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s2(0), bf2\_s(0); s2 < nShell; bf2\_s+=n2, s2++) \{}
\DoxyCodeLine{1855   }
\DoxyCodeLine{1856           n2 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s2].size(); \textcolor{comment}{// Size of Shell 2}}
\DoxyCodeLine{1857   }
\DoxyCodeLine{1858 \textcolor{preprocessor}{\#ifdef \_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{1859           \textcolor{keywordtype}{double} shMax12 = ShBlkNorms[s2 + s1*nShell];}
\DoxyCodeLine{1860 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1861   }
\DoxyCodeLine{1862         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s3(0), bf3\_s(0); s3 <= s2 ; bf3\_s+=n3, s3++) \{}
\DoxyCodeLine{1863   }
\DoxyCodeLine{1864           n3 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s3].size(); \textcolor{comment}{// Size of Shell 3}}
\DoxyCodeLine{1865           s4\_max = (s2 == s3) ? s1 : nShell-\/1; \textcolor{comment}{// Determine the unique max of Shell 4}}
\DoxyCodeLine{1866   }
\DoxyCodeLine{1867 \textcolor{preprocessor}{\#ifdef \_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{1868           \textcolor{keywordtype}{double} shMax123 = std::max(ShBlkNorms[s1 + s3*nShell], }
\DoxyCodeLine{1869                                      ShBlkNorms[s2 + s3*nShell]);}
\DoxyCodeLine{1870           }
\DoxyCodeLine{1871           shMax123 = std::max(shMax123,shMax12);}
\DoxyCodeLine{1872 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{1873           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iBatch = 0ul; iBatch < nBatch; iBatch++)}
\DoxyCodeLine{1874              shMax123\_batch[iBatch] = }
\DoxyCodeLine{1875                std::max(ShBlkNorms\_batch[iBatch][s1 + s2*nShell],}
\DoxyCodeLine{1876                std::max(ShBlkNorms\_batch[iBatch][s1 + s3*nShell],}
\DoxyCodeLine{1877                         ShBlkNorms\_batch[iBatch][s2 + s3*nShell]));}
\DoxyCodeLine{1878 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1879 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1880    }
\DoxyCodeLine{1881   }
\DoxyCodeLine{1882         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s4(0), bf4\_s(0); s4 <= s4\_max; bf4\_s+=n4, s4++, s1234++) \{}
\DoxyCodeLine{1883   }
\DoxyCodeLine{1884           n4 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s4].size(); \textcolor{comment}{// Size of Shell 4}}
\DoxyCodeLine{1885   }
\DoxyCodeLine{1886           \textcolor{comment}{// Round Robbin work distribution}}
\DoxyCodeLine{1887 \textcolor{preprocessor}{          \#ifdef \_OPENMP}}
\DoxyCodeLine{1888           \textcolor{keywordflow}{if}( s1234 \% nThreads != thread\_id ) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{1889 \textcolor{preprocessor}{          \#endif}}
\DoxyCodeLine{1890   }
\DoxyCodeLine{1891 \textcolor{preprocessor}{\#ifdef \_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{1892   }
\DoxyCodeLine{1893           \textcolor{keywordtype}{double} shMax = std::max(ShBlkNorms[s1 + s4*nShell],}
\DoxyCodeLine{1894                          std::max(ShBlkNorms[s2 + s4*nShell],}
\DoxyCodeLine{1895                                   ShBlkNorms[s3 + s4*nShell]));}
\DoxyCodeLine{1896   }
\DoxyCodeLine{1897           shMax = std::max(shMax,shMax123);}
\DoxyCodeLine{1898 }
\DoxyCodeLine{1899           \textcolor{keywordflow}{if}((shMax*SchwarzGaunt[s3+s4*nShell]*SchwarzGaunt[s2 + s1*nShell]) <}
\DoxyCodeLine{1900              eri.\mbox{\hyperlink{classChronusQ_1_1DirectTPI_a51ce753ee588706401406d4216c1ba74}{threshSchwarz}}()) \{ }
\DoxyCodeLine{1901             nIntSkipGaunt[thread\_id]++;}
\DoxyCodeLine{1902 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{1903             nConSkipGaunt[thread\_id] += nBatch;}
\DoxyCodeLine{1904 \textcolor{preprocessor}{\#endif            }}
\DoxyCodeLine{1905             \textcolor{keywordflow}{continue}; }
\DoxyCodeLine{1906           \}}
\DoxyCodeLine{1907 }
\DoxyCodeLine{1908 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{1909           nCon = 0;}
\DoxyCodeLine{1910           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iBatch = 0ul; iBatch < nBatch; iBatch++) \{}
\DoxyCodeLine{1911             shMax = std::max(ShBlkNorms\_batch[iBatch][s1 + s4*nShell],}
\DoxyCodeLine{1912                     std::max(ShBlkNorms\_batch[iBatch][s2 + s4*nShell],}
\DoxyCodeLine{1913                              ShBlkNorms\_batch[iBatch][s3 + s4*nShell]));}
\DoxyCodeLine{1914             shMax = std::max(shMax, shMax123\_batch[iBatch]); }
\DoxyCodeLine{1915              }
\DoxyCodeLine{1916             \textcolor{keywordflow}{if}((shMax*SchwarzGaunt[s2+s1*nShell]*SchwarzGaunt[s3+s4*nShell]) <}
\DoxyCodeLine{1917               eri.\mbox{\hyperlink{classChronusQ_1_1DirectTPI_a51ce753ee588706401406d4216c1ba74}{threshSchwarz}}()) \{}
\DoxyCodeLine{1918               nConSkipGaunt[thread\_id] ++;}
\DoxyCodeLine{1919             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1920               contract\_batch[nCon] = iBatch; }
\DoxyCodeLine{1921               nCon++;  }
\DoxyCodeLine{1922             \}}
\DoxyCodeLine{1923           \}}
\DoxyCodeLine{1924 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1925 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1926   }
\DoxyCodeLine{1927 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{1928           \textcolor{keyword}{auto} topDirectGauntInt = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{1929 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1930   }
\DoxyCodeLine{1931           shls[0] = int(s2);}
\DoxyCodeLine{1932           shls[1] = int(s1);}
\DoxyCodeLine{1933           shls[2] = int(s3);}
\DoxyCodeLine{1934           shls[3] = int(s4);}
\DoxyCodeLine{1935 }
\DoxyCodeLine{1936           \textcolor{keywordflow}{if}(int2e\_ip1ip2\_sph(buff, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, cache)==0) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{1937  }
\DoxyCodeLine{1938           \textcolor{keyword}{auto} nQuad = n1*n2*n3*n4;}
\DoxyCodeLine{1939 }
\DoxyCodeLine{1940           \textcolor{keywordflow}{for}(l = 3*maxShellSize, mnkl = 0ul; l < 3*maxShellSize + n4; ++l) }
\DoxyCodeLine{1941           \textcolor{keywordflow}{for}(k = 2*maxShellSize            ; k < 2*maxShellSize + n3; ++k) }
\DoxyCodeLine{1942           \textcolor{keywordflow}{for}(m = 0                         ; m <                  n1; ++m)}
\DoxyCodeLine{1943           \textcolor{keywordflow}{for}(n =   maxShellSize            ; n <   maxShellSize + n2; ++n, ++mnkl) \{}
\DoxyCodeLine{1944 }
\DoxyCodeLine{1945   }
\DoxyCodeLine{1946             \textcolor{comment}{/* Gaunt */}}
\DoxyCodeLine{1947             \textcolor{comment}{// ∇A∙∇C(mn|kl)}}
\DoxyCodeLine{1948             \textcolor{keyword}{auto} dAdotdC = buff[AxCx*nQuad+mnkl] + buff[AyCy*nQuad+mnkl] + buff[AzCz*nQuad+mnkl];}
\DoxyCodeLine{1949             \textcolor{comment}{// ∇Ax∇C(mn|kl)}}
\DoxyCodeLine{1950             \textcolor{keyword}{auto} dAcrossdC\_x =  buff[AyCz*nQuad+mnkl] -\/ buff[AzCy*nQuad+mnkl];}
\DoxyCodeLine{1951             \textcolor{keyword}{auto} dAcrossdC\_y = -\/buff[AxCz*nQuad+mnkl] + buff[AzCx*nQuad+mnkl];}
\DoxyCodeLine{1952             \textcolor{keyword}{auto} dAcrossdC\_z =  buff[AxCy*nQuad+mnkl] -\/ buff[AyCx*nQuad+mnkl];}
\DoxyCodeLine{1953 }
\DoxyCodeLine{1954 }
\DoxyCodeLine{1955             \textcolor{comment}{// Change the index so that we do ∇B∙∇C(ij|kl) using the ∇B∇C engine}}
\DoxyCodeLine{1956             \textcolor{keyword}{auto} MNKL = m + n*NB + k*NB2 + l*NB3;}
\DoxyCodeLine{1957             \textcolor{keyword}{auto} LKNM = l + k*NB + n*NB2 + m*NB3;}
\DoxyCodeLine{1958   }
\DoxyCodeLine{1959             \textcolor{comment}{// ∇B∙∇C(ij|kl) followed by ∇Bx∇C(ij|kl) X, Y, and Z}}
\DoxyCodeLine{1960             \textcolor{comment}{// (kl|mn)}}
\DoxyCodeLine{1961             BC[      MNKL] = dAdotdC;    }
\DoxyCodeLine{1962             BC[  NB4+MNKL] = dAcrossdC\_x;}
\DoxyCodeLine{1963             BC[NB4\_2+MNKL] = dAcrossdC\_y;}
\DoxyCodeLine{1964             BC[NB4\_3+MNKL] = dAcrossdC\_z;}
\DoxyCodeLine{1965 }
\DoxyCodeLine{1966             \textcolor{comment}{// (lk|nm)}}
\DoxyCodeLine{1967             BC[      LKNM] = dAdotdC;}
\DoxyCodeLine{1968             BC[  NB4+LKNM] = -\/dAcrossdC\_x;}
\DoxyCodeLine{1969             BC[NB4\_2+LKNM] = -\/dAcrossdC\_y;}
\DoxyCodeLine{1970             BC[NB4\_3+LKNM] = -\/dAcrossdC\_z;}
\DoxyCodeLine{1971   }
\DoxyCodeLine{1972             \textcolor{comment}{// ∇B\_x∇C\_x(mn|kl) -\/ ∇B∙∇C(mn|kl)}}
\DoxyCodeLine{1973             \textcolor{comment}{// (mn|kl)}}
\DoxyCodeLine{1974             BC[NB4\_4+MNKL] = buff[BxCx*nQuad+mnkl] -\/ dAdotdC;}
\DoxyCodeLine{1975             \textcolor{comment}{// (lk|nm)}}
\DoxyCodeLine{1976             BC[NB4\_4+LKNM] = buff[BxCx*nQuad+mnkl] -\/ dAdotdC;}
\DoxyCodeLine{1977   }
\DoxyCodeLine{1978   }
\DoxyCodeLine{1979             \textcolor{comment}{// ∇B\_y∇C\_x(mn|kl)}}
\DoxyCodeLine{1980             \textcolor{comment}{// (mn|kl)}}
\DoxyCodeLine{1981             BC[NB4\_5+MNKL] = buff[ByCx*nQuad+mnkl];}
\DoxyCodeLine{1982             \textcolor{comment}{// (lk|nm)}}
\DoxyCodeLine{1983             BC[NB4\_5+LKNM] = buff[BxCy*nQuad+mnkl];}
\DoxyCodeLine{1984   }
\DoxyCodeLine{1985   }
\DoxyCodeLine{1986             \textcolor{comment}{// ∇B\_z∇C\_x(mn|kl)}}
\DoxyCodeLine{1987             \textcolor{comment}{// (mn|kl)}}
\DoxyCodeLine{1988             BC[NB4\_6+MNKL] = buff[BzCx*nQuad+mnkl];}
\DoxyCodeLine{1989             \textcolor{comment}{// (lk|nm)}}
\DoxyCodeLine{1990             BC[NB4\_6+LKNM] = buff[BxCz*nQuad+mnkl];}
\DoxyCodeLine{1991   }
\DoxyCodeLine{1992   }
\DoxyCodeLine{1993             \textcolor{comment}{// ∇B\_x∇C\_y(mn|kl)}}
\DoxyCodeLine{1994             \textcolor{comment}{// (mn|kl)}}
\DoxyCodeLine{1995             BC[NB4\_7+MNKL] = buff[BxCy*nQuad+mnkl]; }
\DoxyCodeLine{1996             \textcolor{comment}{// (lk|nm)}}
\DoxyCodeLine{1997             BC[NB4\_7+LKNM] = buff[ByCx*nQuad+mnkl];}
\DoxyCodeLine{1998   }
\DoxyCodeLine{1999   }
\DoxyCodeLine{2000             \textcolor{comment}{// ∇B\_y∇C\_y(mn|kl) -\/ ∇B∙∇C(mn|kl)}}
\DoxyCodeLine{2001             \textcolor{comment}{// (mn|kl)}}
\DoxyCodeLine{2002             BC[NB4\_8+MNKL] = buff[ByCy*nQuad+mnkl] -\/ dAdotdC;}
\DoxyCodeLine{2003             \textcolor{comment}{// (lk|nm)}}
\DoxyCodeLine{2004             BC[NB4\_8+LKNM] = buff[ByCy*nQuad+mnkl] -\/ dAdotdC;}
\DoxyCodeLine{2005   }
\DoxyCodeLine{2006   }
\DoxyCodeLine{2007             \textcolor{comment}{// ∇B\_z∇C\_y(mn|kl)}}
\DoxyCodeLine{2008             \textcolor{comment}{// (mn|kl)}}
\DoxyCodeLine{2009             BC[NB4\_9+MNKL] = buff[BzCy*nQuad+mnkl];}
\DoxyCodeLine{2010             \textcolor{comment}{// (lk|nm)}}
\DoxyCodeLine{2011             BC[NB4\_9+LKNM] = buff[ByCz*nQuad+mnkl];}
\DoxyCodeLine{2012   }
\DoxyCodeLine{2013             \textcolor{comment}{// ∇B\_x∇C\_z(mn|kl)}}
\DoxyCodeLine{2014             \textcolor{comment}{// (mn|kl)}}
\DoxyCodeLine{2015             BC[NB4\_10+MNKL] = buff[BxCz*nQuad+mnkl];}
\DoxyCodeLine{2016             \textcolor{comment}{// (lk|nm)}}
\DoxyCodeLine{2017             BC[NB4\_10+LKNM] = buff[BzCx*nQuad+mnkl];}
\DoxyCodeLine{2018   }
\DoxyCodeLine{2019             \textcolor{comment}{// ∇B\_y∇C\_z(mn|kl)}}
\DoxyCodeLine{2020             \textcolor{comment}{// (mn|kl)}}
\DoxyCodeLine{2021             BC[NB4\_11+MNKL] = buff[ByCz*nQuad+mnkl];}
\DoxyCodeLine{2022             \textcolor{comment}{// (lk|nm)}}
\DoxyCodeLine{2023             BC[NB4\_11+LKNM] = buff[BzCy*nQuad+mnkl];}
\DoxyCodeLine{2024   }
\DoxyCodeLine{2025             \textcolor{comment}{// ∇B\_z∇C\_z(mn|kl) -\/ ∇B∙∇C(mn|kl) }}
\DoxyCodeLine{2026             \textcolor{comment}{// (mn|kl)}}
\DoxyCodeLine{2027             BC[NB4\_12+MNKL] = buff[BzCz*nQuad+mnkl] -\/ dAdotdC;}
\DoxyCodeLine{2028             \textcolor{comment}{// (lk|nm)}}
\DoxyCodeLine{2029             BC[NB4\_12+LKNM] = buff[BzCz*nQuad+mnkl] -\/ dAdotdC;}
\DoxyCodeLine{2030   }
\DoxyCodeLine{2031           \} \textcolor{comment}{// ∇C∙∇D integral preparation loop}}
\DoxyCodeLine{2032   }
\DoxyCodeLine{2033 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{2034           durDirectGauntInt[thread\_id] += \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topDirectGauntInt); }
\DoxyCodeLine{2035 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2036   }
\DoxyCodeLine{2037 \textcolor{preprocessor}{\#ifdef \_CONTRACTION\_ }\textcolor{comment}{// Contraction}}
\DoxyCodeLine{2038 }
\DoxyCodeLine{2039 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{2040           \textcolor{keyword}{auto} topDirectGauntCon = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{2041 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2042           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iCon = 0ul; iCon < nCon; iCon++) \{  }
\DoxyCodeLine{2043             }
\DoxyCodeLine{2044             matOff = contract\_batch[iCon] * mMat; }
\DoxyCodeLine{2045             }
\DoxyCodeLine{2046             \textcolor{keyword}{auto} DCLSpmSLMS = matList[matOff].X-\/>S().pointer();}
\DoxyCodeLine{2047             \textcolor{keyword}{auto} DCLSpmSLMX = matList[matOff].X-\/>X().pointer();}
\DoxyCodeLine{2048             \textcolor{keyword}{auto} DCLSpmSLMY = matList[matOff].X-\/>Y().pointer();}
\DoxyCodeLine{2049             \textcolor{keyword}{auto} DCLSpmSLMZ = matList[matOff].X-\/>Z().pointer();}
\DoxyCodeLine{2050             }
\DoxyCodeLine{2051             \textcolor{keyword}{auto} ADCLSMS  = AX\_loc[matOff]-\/>S().pointer();}
\DoxyCodeLine{2052             \textcolor{keyword}{auto} ADCLSMX  = AX\_loc[matOff]-\/>X().pointer();}
\DoxyCodeLine{2053             \textcolor{keyword}{auto} ADCLSMY  = AX\_loc[matOff]-\/>Y().pointer();}
\DoxyCodeLine{2054             \textcolor{keyword}{auto} ADCLSMZ  = AX\_loc[matOff]-\/>Z().pointer();}
\DoxyCodeLine{2055             }
\DoxyCodeLine{2056           \textcolor{keywordflow}{for}(m = 0ul,            bf1 = bf1\_s; m <                  n1; ++m, bf1++) \{}
\DoxyCodeLine{2057           \textcolor{keywordflow}{for}(n =   maxShellSize, bf2 = bf2\_s; n <   maxShellSize + n2; ++n, bf2++) \{}
\DoxyCodeLine{2058             \textcolor{keyword}{auto} bf1nB = bf1*nBasis;}
\DoxyCodeLine{2059             \textcolor{keyword}{auto} bf2nB = bf2*nBasis;}
\DoxyCodeLine{2060 }
\DoxyCodeLine{2061           \textcolor{keywordflow}{for}(k = 2*maxShellSize, bf3 = bf3\_s; k < 2*maxShellSize + n3; ++k, bf3++) \{}
\DoxyCodeLine{2062             \textcolor{keyword}{auto} bf3nB = bf3*nBasis;}
\DoxyCodeLine{2063 }
\DoxyCodeLine{2064           \textcolor{keywordflow}{for}(l = 3*maxShellSize, bf4 = bf4\_s; l < 3*maxShellSize + n4; ++l, bf4++) \{}
\DoxyCodeLine{2065             \textcolor{keyword}{auto} MNKL = m + n*NB + k*NB2 + l*NB3;}
\DoxyCodeLine{2066             \textcolor{keyword}{auto} LKNM = l + k*NB + n*NB2 + m*NB3;}
\DoxyCodeLine{2067             \textcolor{keyword}{auto} NMLK = n + m*NB + l*NB2 + k*NB3;}
\DoxyCodeLine{2068             \textcolor{keyword}{auto} KLMN = k + l*NB + m*NB2 + n*NB3;}
\DoxyCodeLine{2069 }
\DoxyCodeLine{2070             \textcolor{keyword}{auto} bf4nB= bf4*nBasis;}
\DoxyCodeLine{2071             \textcolor{keyword}{auto} bf14 = bf1 + bf4nB;}
\DoxyCodeLine{2072             \textcolor{keyword}{auto} bf24 = bf2 + bf4nB;}
\DoxyCodeLine{2073             \textcolor{keyword}{auto} bf23 = bf2 + bf3nB;}
\DoxyCodeLine{2074             \textcolor{keyword}{auto} bf13 = bf1 + bf3nB;}
\DoxyCodeLine{2075             \textcolor{keyword}{auto} bf41 = bf4 + bf1nB;}
\DoxyCodeLine{2076             \textcolor{keyword}{auto} bf31 = bf3 + bf1nB;}
\DoxyCodeLine{2077             \textcolor{keyword}{auto} bf32 = bf3 + bf2nB;}
\DoxyCodeLine{2078             \textcolor{keyword}{auto} bf42 = bf4 + bf2nB;}
\DoxyCodeLine{2079             \textcolor{keyword}{auto} bf34 = bf3 + bf4nB;}
\DoxyCodeLine{2080             \textcolor{keyword}{auto} bf43 = bf4 + bf3nB;}
\DoxyCodeLine{2081             \textcolor{keyword}{auto} bf12 = bf1 + bf2nB;}
\DoxyCodeLine{2082             \textcolor{keyword}{auto} bf21 = bf2 + bf1nB;}
\DoxyCodeLine{2083 }
\DoxyCodeLine{2084             \textcolor{comment}{//ERI0 :   ∇B∙∇C(mn|kl)}}
\DoxyCodeLine{2085             \textcolor{comment}{//ERI1 :   ∇Bx∇C(mn|kl)-\/X}}
\DoxyCodeLine{2086             \textcolor{comment}{//ERI2 :   ∇Bx∇C(mn|kl)-\/Y}}
\DoxyCodeLine{2087             \textcolor{comment}{//ERI3 :   ∇Bx∇C(mn|kl)-\/Z}}
\DoxyCodeLine{2088             \textcolor{comment}{//ERI4 :   ∇B\_x∇C\_x(mn|kl) -\/ ∇B∙∇C(mn|kl)}}
\DoxyCodeLine{2089             \textcolor{comment}{//ERI5 :   ∇B\_y∇C\_x(mn|kl)}}
\DoxyCodeLine{2090             \textcolor{comment}{//ERI6 :   ∇B\_z∇C\_x(mn|kl) }}
\DoxyCodeLine{2091             \textcolor{comment}{//ERI7 :   ∇B\_x∇C\_y(mn|kl)}}
\DoxyCodeLine{2092             \textcolor{comment}{//ERI8 :   ∇B\_y∇C\_y(mn|kl) -\/ ∇B∙∇C(mn|kl)}}
\DoxyCodeLine{2093             \textcolor{comment}{//ERI9 :   ∇B\_z∇C\_y(mn|kl) }}
\DoxyCodeLine{2094             \textcolor{comment}{//ERI10:   ∇B\_x∇C\_z(mn|kl)}}
\DoxyCodeLine{2095             \textcolor{comment}{//ERI11:   ∇B\_y∇C\_z(mn|kl)}}
\DoxyCodeLine{2096             \textcolor{comment}{//ERI12:   ∇B\_z∇C\_z(mn|kl) -\/ ∇B∙∇C(mn|kl)}}
\DoxyCodeLine{2097             }
\DoxyCodeLine{2098             \textcolor{comment}{/*++++++++++++++++++++++++*/}}
\DoxyCodeLine{2099             \textcolor{comment}{/* Start of Gaunt (LL|SS) */}}
\DoxyCodeLine{2100             \textcolor{comment}{/*++++++++++++++++++++++++*/}}
\DoxyCodeLine{2101             }
\DoxyCodeLine{2102             \textcolor{comment}{// MNKL}}
\DoxyCodeLine{2103             \textcolor{comment}{// Coulomb //TRANSKL}}
\DoxyCodeLine{2104 }
\DoxyCodeLine{2105             ADCLSMS[bf12]+=    -\/ DCLSpmSLMS[bf43] * BC[MNKL]}
\DoxyCodeLine{2106                             + (  DCLSpmSLMX[bf43] * BC[MNKL+NB4] }
\DoxyCodeLine{2107                                + DCLSpmSLMY[bf43] * BC[MNKL+NB4\_2] }
\DoxyCodeLine{2108                                + DCLSpmSLMZ[bf43] * BC[MNKL+NB4\_3]) * iS;}
\DoxyCodeLine{2109             }
\DoxyCodeLine{2110             ADCLSMX[bf12]+=  DCLSpmSLMS[bf43] * BC[MNKL+NB4] * iS }
\DoxyCodeLine{2111                            + DCLSpmSLMX[bf43] * BC[MNKL+NB4\_4]}
\DoxyCodeLine{2112                            + DCLSpmSLMY[bf43] * BC[MNKL+NB4\_5] }
\DoxyCodeLine{2113                            + DCLSpmSLMZ[bf43] * BC[MNKL+NB4\_6];}
\DoxyCodeLine{2114             }
\DoxyCodeLine{2115             ADCLSMY[bf12]+=  DCLSpmSLMS[bf43] * BC[MNKL+NB4\_2] * iS }
\DoxyCodeLine{2116                            + DCLSpmSLMX[bf43] * BC[MNKL+NB4\_7] }
\DoxyCodeLine{2117                            + DCLSpmSLMY[bf43] * BC[MNKL+NB4\_8]}
\DoxyCodeLine{2118                            + DCLSpmSLMZ[bf43] * BC[MNKL+NB4\_9];}
\DoxyCodeLine{2119             }
\DoxyCodeLine{2120             ADCLSMZ[bf12]+=  DCLSpmSLMS[bf43] * BC[MNKL+NB4\_3] * iS }
\DoxyCodeLine{2121                            + DCLSpmSLMX[bf43] * BC[MNKL+NB4\_10]}
\DoxyCodeLine{2122                            + DCLSpmSLMY[bf43] * BC[MNKL+NB4\_11] }
\DoxyCodeLine{2123                            + DCLSpmSLMZ[bf43] * BC[MNKL+NB4\_12];}
\DoxyCodeLine{2124             \textcolor{comment}{// LKNM}}
\DoxyCodeLine{2125             \textcolor{comment}{// Coulomb //TRANSKL}}
\DoxyCodeLine{2126             \textcolor{keywordflow}{if}(bf1\_s!=bf4\_s or bf2\_s!=bf3\_s) \{}
\DoxyCodeLine{2127             }
\DoxyCodeLine{2128               ADCLSMS[bf43]+=   -\/ DCLSpmSLMS[bf12] * BC[LKNM] }
\DoxyCodeLine{2129                               +(  DCLSpmSLMX[bf12] * BC[LKNM+NB4] }
\DoxyCodeLine{2130                                 + DCLSpmSLMY[bf12] * BC[LKNM+NB4\_2] }
\DoxyCodeLine{2131                                 + DCLSpmSLMZ[bf12] * BC[LKNM+NB4\_3]) * iS;}
\DoxyCodeLine{2132             }
\DoxyCodeLine{2133               ADCLSMX[bf43]+=  DCLSpmSLMS[bf12] * BC[LKNM+NB4] * iS }
\DoxyCodeLine{2134                              + DCLSpmSLMX[bf12] * BC[LKNM+NB4\_4]}
\DoxyCodeLine{2135                              + DCLSpmSLMY[bf12] * BC[LKNM+NB4\_5] }
\DoxyCodeLine{2136                              + DCLSpmSLMZ[bf12] * BC[LKNM+NB4\_6];}
\DoxyCodeLine{2137               }
\DoxyCodeLine{2138               ADCLSMY[bf43]+=  DCLSpmSLMS[bf12] * BC[LKNM+NB4\_2] * iS }
\DoxyCodeLine{2139                              + DCLSpmSLMX[bf12] * BC[LKNM+NB4\_7] }
\DoxyCodeLine{2140                              + DCLSpmSLMY[bf12] * BC[LKNM+NB4\_8]}
\DoxyCodeLine{2141                              + DCLSpmSLMZ[bf12] * BC[LKNM+NB4\_9];}
\DoxyCodeLine{2142             }
\DoxyCodeLine{2143               ADCLSMZ[bf43]+=  DCLSpmSLMS[bf12] * BC[LKNM+NB4\_3] * iS }
\DoxyCodeLine{2144                              + DCLSpmSLMX[bf12] * BC[LKNM+NB4\_10]}
\DoxyCodeLine{2145                              + DCLSpmSLMY[bf12] * BC[LKNM+NB4\_11]}
\DoxyCodeLine{2146                              + DCLSpmSLMZ[bf12] * BC[LKNM+NB4\_12];}
\DoxyCodeLine{2147             }
\DoxyCodeLine{2148             \}}
\DoxyCodeLine{2149 }
\DoxyCodeLine{2150           \}}
\DoxyCodeLine{2151           \}}
\DoxyCodeLine{2152           \}}
\DoxyCodeLine{2153           \}}
\DoxyCodeLine{2154           \} \textcolor{comment}{// contraction loop}}
\DoxyCodeLine{2155 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// Contraction}}
\DoxyCodeLine{2156   }
\DoxyCodeLine{2157 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{2158         durDirectGauntCon[thread\_id] += \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topDirectGauntCon); }
\DoxyCodeLine{2159 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2160   }
\DoxyCodeLine{2161         \}; \textcolor{comment}{// loop s4}}
\DoxyCodeLine{2162         \}; \textcolor{comment}{// loop s3}}
\DoxyCodeLine{2163         \}; \textcolor{comment}{// loop s2}}
\DoxyCodeLine{2164         \}; \textcolor{comment}{// loop s1}}
\DoxyCodeLine{2165   }
\DoxyCodeLine{2166   }
\DoxyCodeLine{2167       \} \textcolor{comment}{// OpenMP context}}
\DoxyCodeLine{2168   }
\DoxyCodeLine{2169   }
\DoxyCodeLine{2170       \textcolor{keywordflow}{for}( \textcolor{keyword}{auto} iTh  = 0; iTh < nThreads; iTh++) }
\DoxyCodeLine{2171       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iMat = 0ul; iMat < nMat; iMat++) \{  }
\DoxyCodeLine{2172         matList[iMat].AX-\/>S() +=  AXthreads[iTh][iMat]-\/>S();  }
\DoxyCodeLine{2173         matList[iMat].AX-\/>X() +=  AXthreads[iTh][iMat]-\/>X();  }
\DoxyCodeLine{2174         matList[iMat].AX-\/>Y() +=  AXthreads[iTh][iMat]-\/>Y();  }
\DoxyCodeLine{2175         matList[iMat].AX-\/>Z() +=  AXthreads[iTh][iMat]-\/>Z();  }
\DoxyCodeLine{2176       \}}
\DoxyCodeLine{2177       }
\DoxyCodeLine{2178       memManager\_.free(ERIBuffer);}
\DoxyCodeLine{2179       memManager\_.free(buffAll, cacheAll);}
\DoxyCodeLine{2180 }
\DoxyCodeLine{2181 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{2182       \textcolor{keywordtype}{size\_t} nIntSkipGauntAcc = std::accumulate(nIntSkipGaunt.begin(),nIntSkipGaunt.end(),0);}
\DoxyCodeLine{2183       \textcolor{keywordtype}{double} durDirectGauntIntAcc = std::accumulate(durDirectGauntInt.begin(), durDirectGauntInt.end(),0.);}
\DoxyCodeLine{2184       \textcolor{keywordtype}{double} durDirectGauntConAcc = std::accumulate(durDirectGauntCon.begin(), durDirectGauntCon.end(),0.);}
\DoxyCodeLine{2185       }
\DoxyCodeLine{2186       std::cout << std::endl;}
\DoxyCodeLine{2187       std::cout << \textcolor{stringliteral}{"{}Gaunt Skipped Integral   : "{}} << nIntSkipGauntAcc << std::endl;}
\DoxyCodeLine{2188   }
\DoxyCodeLine{2189 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{2190       \textcolor{keywordtype}{size\_t} nConSkipGauntAcc = std::accumulate(nConSkipGaunt.begin(),nConSkipGaunt.end(),0);}
\DoxyCodeLine{2191       std::cout << \textcolor{stringliteral}{"{}       Skipped Contraction: "{}} << nConSkipGauntAcc << std::endl;}
\DoxyCodeLine{2192 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2193       \textcolor{keyword}{auto} durDirectGaunt = \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topDirectGaunt);}
\DoxyCodeLine{2194       std::cout << \textcolor{stringliteral}{"{}Gaunt AO Direct Contraction took "{}} <<  durDirectGaunt}
\DoxyCodeLine{2195                 << \textcolor{stringliteral}{"{} s for "{}} << nBatch << \textcolor{stringliteral}{"{} Batch "{}} << std::endl; }
\DoxyCodeLine{2196       std::cout << \textcolor{stringliteral}{"{}            Build Integrals took "{}} <<  durDirectGauntIntAcc << \textcolor{stringliteral}{"{} s"{}} }
\DoxyCodeLine{2197                 << \textcolor{stringliteral}{"{} from all "{}} << nThreads << \textcolor{stringliteral}{"{} thread(s)"{}} << std::endl;}
\DoxyCodeLine{2198       std::cout << \textcolor{stringliteral}{"{}            Contractions    took "{}} <<  durDirectGauntConAcc << \textcolor{stringliteral}{"{} s"{}}}
\DoxyCodeLine{2199                 << \textcolor{stringliteral}{"{} from all "{}} << nThreads << \textcolor{stringliteral}{"{} thread(s)"{}} << std::endl;}
\DoxyCodeLine{2200 }
\DoxyCodeLine{2201       std::cout << std::endl;}
\DoxyCodeLine{2202 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2203 }
\DoxyCodeLine{2204     \} \textcolor{comment}{// if(Gaunt)}}
\DoxyCodeLine{2205 }
\DoxyCodeLine{2206 \textcolor{comment}{    /*******************/}}
\DoxyCodeLine{2207     \textcolor{comment}{/*                 */}}
\DoxyCodeLine{2208     \textcolor{comment}{/*   End of Gaunt  */}}
\DoxyCodeLine{2209     \textcolor{comment}{/*                 */}}
\DoxyCodeLine{2210 \textcolor{comment}{    /*******************/}}
\DoxyCodeLine{2211 }
\DoxyCodeLine{2212 }
\DoxyCodeLine{2213 \textcolor{comment}{    /*******************/}}
\DoxyCodeLine{2214     \textcolor{comment}{/*                 */}}
\DoxyCodeLine{2215     \textcolor{comment}{/* Start of Gauge  */}}
\DoxyCodeLine{2216     \textcolor{comment}{/*                 */}}
\DoxyCodeLine{2217 \textcolor{comment}{    /*******************/}}
\DoxyCodeLine{2218 }
\DoxyCodeLine{2219     \textcolor{keywordflow}{if}( matList[0].contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba01337b51d63cd7bba6d5daf63ff8d911}{TWOBODY\_CONTRACTION\_TYPE::GAUGE}} ) \{}
\DoxyCodeLine{2220 }
\DoxyCodeLine{2221       \textcolor{keyword}{enum} Gauge\_ERI \{}
\DoxyCodeLine{2222         SxSx, \textcolor{comment}{// σ\_x * σ\_x     0}}
\DoxyCodeLine{2223         SySx, \textcolor{comment}{// σ\_y * σ\_x     1}}
\DoxyCodeLine{2224         SzSx, \textcolor{comment}{// σ\_z * σ\_x     2}}
\DoxyCodeLine{2225         ISx,  \textcolor{comment}{// I   * σ\_x     3}}
\DoxyCodeLine{2226         SxSy, \textcolor{comment}{// σ\_x * σ\_y     4}}
\DoxyCodeLine{2227         SySy, \textcolor{comment}{// σ\_y * σ\_y     5}}
\DoxyCodeLine{2228         SzSy, \textcolor{comment}{// σ\_z * σ\_y     6}}
\DoxyCodeLine{2229         ISy,  \textcolor{comment}{// I   * σ\_y     7}}
\DoxyCodeLine{2230         SxSz, \textcolor{comment}{// σ\_x * σ\_z     8}}
\DoxyCodeLine{2231         SySz, \textcolor{comment}{// σ\_y * σ\_z     9}}
\DoxyCodeLine{2232         SzSz, \textcolor{comment}{// σ\_z * σ\_z     10}}
\DoxyCodeLine{2233         ISz,  \textcolor{comment}{// I   * σ\_z     11}}
\DoxyCodeLine{2234         SxI,  \textcolor{comment}{// σ\_x * I       12}}
\DoxyCodeLine{2235         SyI,  \textcolor{comment}{// σ\_y * I       13}}
\DoxyCodeLine{2236         SzI,  \textcolor{comment}{// σ\_z * I       14}}
\DoxyCodeLine{2237         II    \textcolor{comment}{// I   * I       15}}
\DoxyCodeLine{2238       \};}
\DoxyCodeLine{2239   }
\DoxyCodeLine{2240       \textcolor{keyword}{auto} NB4\_4  = 4*NB4;  }
\DoxyCodeLine{2241       \textcolor{keyword}{auto} NB4\_5  = 5*NB4;  }
\DoxyCodeLine{2242       \textcolor{keyword}{auto} NB4\_6  = 6*NB4;  }
\DoxyCodeLine{2243       \textcolor{keyword}{auto} NB4\_7  = 7*NB4;  }
\DoxyCodeLine{2244       \textcolor{keyword}{auto} NB4\_8  = 8*NB4;  }
\DoxyCodeLine{2245       \textcolor{keyword}{auto} NB4\_9  = 9*NB4;  }
\DoxyCodeLine{2246       \textcolor{keyword}{auto} NB4\_10 =10*NB4;  }
\DoxyCodeLine{2247       \textcolor{keyword}{auto} NB4\_11 =11*NB4;  }
\DoxyCodeLine{2248       \textcolor{keyword}{auto} NB4\_12 =12*NB4;  }
\DoxyCodeLine{2249       \textcolor{keyword}{auto} NB4\_13 =13*NB4;  }
\DoxyCodeLine{2250       \textcolor{keyword}{auto} NB4\_14 =14*NB4;  }
\DoxyCodeLine{2251       \textcolor{keyword}{auto} NB4\_15 =15*NB4;  }
\DoxyCodeLine{2252 }
\DoxyCodeLine{2253       \textcolor{keyword}{auto} ss = 0     ;    \textcolor{comment}{// ERI00 (ss)(ij|kl)}}
\DoxyCodeLine{2254       \textcolor{keyword}{auto} sx = NB4   ;    \textcolor{comment}{// ERI01 (sσ)\_x(ijkl)}}
\DoxyCodeLine{2255       \textcolor{keyword}{auto} sy = NB4\_2 ;    \textcolor{comment}{// ERI02 (sσ)\_y(ijkl)}}
\DoxyCodeLine{2256       \textcolor{keyword}{auto} sz = NB4\_3 ;    \textcolor{comment}{// ERI03 (sσ)\_z(ijkl)}}
\DoxyCodeLine{2257       \textcolor{keyword}{auto} xs = NB4\_4 ;    \textcolor{comment}{// ERI04 (σs)\_x(ijkl)}}
\DoxyCodeLine{2258       \textcolor{keyword}{auto} ys = NB4\_5 ;    \textcolor{comment}{// ERI05 (σs)\_y(ijkl)}}
\DoxyCodeLine{2259       \textcolor{keyword}{auto} zs = NB4\_6 ;    \textcolor{comment}{// ERI06 (σs)\_z(ijkl)}}
\DoxyCodeLine{2260       \textcolor{keyword}{auto} xx = NB4\_7;     \textcolor{comment}{// ERI07 (σ\_x σ\_x)(ijkl)}}
\DoxyCodeLine{2261       \textcolor{keyword}{auto} xy = NB4\_8;     \textcolor{comment}{// ERI08 (σ\_x σ\_y)(ijkl)}}
\DoxyCodeLine{2262       \textcolor{keyword}{auto} xz = NB4\_9;     \textcolor{comment}{// ERI09 (σ\_x σ\_z)(ijkl)}}
\DoxyCodeLine{2263       \textcolor{keyword}{auto} yx = NB4\_10;    \textcolor{comment}{// ERI10 (σ\_y σ\_x)(ijkl)}}
\DoxyCodeLine{2264       \textcolor{keyword}{auto} yy = NB4\_11;    \textcolor{comment}{// ERI11 (σ\_y σ\_y)(ijkl)}}
\DoxyCodeLine{2265       \textcolor{keyword}{auto} yz = NB4\_12;    \textcolor{comment}{// ERI12 (σ\_y σ\_z)(ijkl)}}
\DoxyCodeLine{2266       \textcolor{keyword}{auto} zx = NB4\_13;    \textcolor{comment}{// ERI13 (σ\_z σ\_x)(ijkl)}}
\DoxyCodeLine{2267       \textcolor{keyword}{auto} zy = NB4\_14;    \textcolor{comment}{// ERI14 (σ\_z σ\_y)(ijkl)}}
\DoxyCodeLine{2268       \textcolor{keyword}{auto} zz = NB4\_15;    \textcolor{comment}{// ERI15 (σ\_z σ\_z)(ijkl)}}
\DoxyCodeLine{2269    }
\DoxyCodeLine{2270 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{2271       \textcolor{keyword}{auto} topDirectGauge = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{2272       std::vector<double> durDirectGaugeInt(nThreads, 0.);}
\DoxyCodeLine{2273       std::vector<double> durDirectGaugeCon(nThreads, 0.);}
\DoxyCodeLine{2274 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2275 }
\DoxyCodeLine{2276       \textcolor{keyword}{enum} X\_COMP \{}
\DoxyCodeLine{2277         DLS,}
\DoxyCodeLine{2278         DSL,}
\DoxyCodeLine{2279       \};}
\DoxyCodeLine{2280 }
\DoxyCodeLine{2281       \textcolor{keyword}{enum} AX\_COMP \{}
\DoxyCodeLine{2282         CLS,}
\DoxyCodeLine{2283         CSL,}
\DoxyCodeLine{2284       \};}
\DoxyCodeLine{2285       }
\DoxyCodeLine{2286       nERI = 16;}
\DoxyCodeLine{2287       buffAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(2*nERI*buffN4*nThreads);}
\DoxyCodeLine{2288       cacheAll = memManager\_.malloc<\textcolor{keywordtype}{double}>(cache\_size*nThreads);}
\DoxyCodeLine{2289 }
\DoxyCodeLine{2290       \textcolor{keywordtype}{int} nSave = 16;}
\DoxyCodeLine{2291       ERIBuffer = memManager\_.malloc<\textcolor{keywordtype}{double}>(nSave*NB4*nThreads);}
\DoxyCodeLine{2292       }
\DoxyCodeLine{2293       std::vector<size\_t> nIntSkipGauge(nThreads,0);}
\DoxyCodeLine{2294 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{2295       std::vector<size\_t> nConSkipGauge(nThreads,0);}
\DoxyCodeLine{2296 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2297   }
\DoxyCodeLine{2298 \textcolor{preprocessor}{      \#pragma omp parallel}}
\DoxyCodeLine{2299       \{}
\DoxyCodeLine{2300   }
\DoxyCodeLine{2301         \mbox{\hyperlink{chronusq__sys_8hpp_aa7b4cfa83fe868296abd1ba4d67d9563}{dcomplex}} iS = \mbox{\hyperlink{chronusq__sys_8hpp_aa7b4cfa83fe868296abd1ba4d67d9563}{dcomplex}}(0.0, 1.0);}
\DoxyCodeLine{2302   }
\DoxyCodeLine{2303         \textcolor{keywordtype}{size\_t} thread\_id = \mbox{\hyperlink{namespaceChronusQ_aa348a017ee78c3450480773ddc542e5c}{GetThreadID}}();}
\DoxyCodeLine{2304   }
\DoxyCodeLine{2305         \textcolor{keyword}{auto} \&AX\_loc = AXthreads[thread\_id];}
\DoxyCodeLine{2306   }
\DoxyCodeLine{2307         \textcolor{keywordtype}{double} *BC   = \&ERIBuffer[thread\_id*nSave*NB4];}
\DoxyCodeLine{2308   }
\DoxyCodeLine{2309         \textcolor{keywordtype}{size\_t} n1,n2,n3,n4,m,n,k,l,mnkl,bf1,bf2,bf3,bf4;}
\DoxyCodeLine{2310         \textcolor{keywordtype}{size\_t} s4\_max;}
\DoxyCodeLine{2311 }
\DoxyCodeLine{2312         \textcolor{keywordtype}{int} skiperi1,skiperi2;}
\DoxyCodeLine{2313   }
\DoxyCodeLine{2314         \textcolor{keywordtype}{int} shls[4];}
\DoxyCodeLine{2315         \textcolor{keywordtype}{double} *buffr1 = buffAll+nERI*buffN4*thread\_id;}
\DoxyCodeLine{2316         \textcolor{keywordtype}{double} *buffr2 = buffAll+nERI*nThreads*buffN4+nERI*buffN4*thread\_id;}
\DoxyCodeLine{2317         \textcolor{keywordtype}{double} *cache = cacheAll+cache\_size*thread\_id;}
\DoxyCodeLine{2318   }
\DoxyCodeLine{2319         std::vector<size\_t> contract\_batch(nBatch);}
\DoxyCodeLine{2320         \textcolor{keywordtype}{size\_t} iCon, nCon, matOff;}
\DoxyCodeLine{2321 }
\DoxyCodeLine{2322 \textcolor{preprocessor}{\#if defined(\_SHZ\_SCREEN\_4C) \&\& defined(\_SEPARATED\_SHZ\_SCREEN\_4C)}}
\DoxyCodeLine{2323         std::vector<double> shMax123\_batch(nBatch);}
\DoxyCodeLine{2324 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{2325         std::iota(contract\_batch.begin(), contract\_batch.end(), 0);}
\DoxyCodeLine{2326         nCon = nBatch;}
\DoxyCodeLine{2327 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2328         }
\DoxyCodeLine{2329         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s1(0), bf1\_s(0), s1234(0); s1 < nShell; bf1\_s+=n1, s1++) \{ }
\DoxyCodeLine{2330   }
\DoxyCodeLine{2331           n1 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s1].size(); \textcolor{comment}{// Size of Shell 1}}
\DoxyCodeLine{2332   }
\DoxyCodeLine{2333         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s2(0), bf2\_s(0); s2 < nShell; bf2\_s+=n2, s2++) \{}
\DoxyCodeLine{2334   }
\DoxyCodeLine{2335           n2 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s2].size(); \textcolor{comment}{// Size of Shell 2}}
\DoxyCodeLine{2336   }
\DoxyCodeLine{2337 \textcolor{preprocessor}{\#ifdef \_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{2338           \textcolor{keywordtype}{double} shMax12 = ShBlkNorms[s2 + s1*nShell];}
\DoxyCodeLine{2339 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2340   }
\DoxyCodeLine{2341         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s3(0), bf3\_s(0); s3 <= s2 ; bf3\_s+=n3, s3++) \{}
\DoxyCodeLine{2342         \textcolor{comment}{//for(size\_t s3(0), bf3\_s(0); s3 < nShell ; bf3\_s+=n3, s3++) \{}}
\DoxyCodeLine{2343   }
\DoxyCodeLine{2344           n3 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s3].size(); \textcolor{comment}{// Size of Shell 3}}
\DoxyCodeLine{2345           s4\_max = (s2 == s3) ? s1 : nShell-\/1; \textcolor{comment}{// Determine the unique max of Shell 4}}
\DoxyCodeLine{2346   }
\DoxyCodeLine{2347 \textcolor{preprocessor}{\#ifdef \_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{2348           \textcolor{keywordtype}{double} shMax123 = std::max(ShBlkNorms[s1 + s3*nShell], }
\DoxyCodeLine{2349                                      ShBlkNorms[s2 + s3*nShell]);}
\DoxyCodeLine{2350           }
\DoxyCodeLine{2351           shMax123 = std::max(shMax123,shMax12);}
\DoxyCodeLine{2352 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{2353           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iBatch = 0ul; iBatch < nBatch; iBatch++)}
\DoxyCodeLine{2354              shMax123\_batch[iBatch] = }
\DoxyCodeLine{2355                std::max(ShBlkNorms\_batch[iBatch][s1 + s2*nShell],}
\DoxyCodeLine{2356                std::max(ShBlkNorms\_batch[iBatch][s1 + s3*nShell],}
\DoxyCodeLine{2357                         ShBlkNorms\_batch[iBatch][s2 + s3*nShell]));}
\DoxyCodeLine{2358 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2359 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2360    }
\DoxyCodeLine{2361   }
\DoxyCodeLine{2362         \textcolor{comment}{//for(size\_t s4(0), bf4\_s(0); s4 < nShell; bf4\_s+=n4, s4++, s1234++) \{}}
\DoxyCodeLine{2363         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} s4(0), bf4\_s(0); s4 <= s4\_max; bf4\_s+=n4, s4++, s1234++) \{}
\DoxyCodeLine{2364   }
\DoxyCodeLine{2365           n4 = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}[s4].size(); \textcolor{comment}{// Size of Shell 4}}
\DoxyCodeLine{2366   }
\DoxyCodeLine{2367           \textcolor{comment}{// Round Robbin work distribution}}
\DoxyCodeLine{2368 \textcolor{preprocessor}{          \#ifdef \_OPENMP}}
\DoxyCodeLine{2369           \textcolor{keywordflow}{if}( s1234 \% nThreads != thread\_id ) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{2370 \textcolor{preprocessor}{          \#endif}}
\DoxyCodeLine{2371   }
\DoxyCodeLine{2372 \textcolor{preprocessor}{\#ifdef \_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{2373   }
\DoxyCodeLine{2374           \textcolor{keywordtype}{double} shMax = std::max(ShBlkNorms[s1 + s4*nShell],}
\DoxyCodeLine{2375                          std::max(ShBlkNorms[s2 + s4*nShell],}
\DoxyCodeLine{2376                                   ShBlkNorms[s3 + s4*nShell]));}
\DoxyCodeLine{2377   }
\DoxyCodeLine{2378           shMax = std::max(shMax,shMax123);}
\DoxyCodeLine{2379 }
\DoxyCodeLine{2380           \textcolor{keywordflow}{if}((shMax*SchwarzGauge[s1+s2*nShell]*SchwarzGauge[s4+s3*nShell]) <}
\DoxyCodeLine{2381              eri.\mbox{\hyperlink{classChronusQ_1_1DirectTPI_a51ce753ee588706401406d4216c1ba74}{threshSchwarz}}()) \{ }
\DoxyCodeLine{2382             nIntSkipGauge[thread\_id]++;}
\DoxyCodeLine{2383 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{2384             nConSkipGauge[thread\_id] += nBatch;}
\DoxyCodeLine{2385 \textcolor{preprocessor}{\#endif            }}
\DoxyCodeLine{2386             \textcolor{keywordflow}{continue}; }
\DoxyCodeLine{2387           \}}
\DoxyCodeLine{2388 }
\DoxyCodeLine{2389 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{2390           nCon = 0;}
\DoxyCodeLine{2391           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iBatch = 0ul; iBatch < nBatch; iBatch++) \{}
\DoxyCodeLine{2392             shMax = std::max(ShBlkNorms\_batch[iBatch][s1 + s4*nShell],}
\DoxyCodeLine{2393                     std::max(ShBlkNorms\_batch[iBatch][s2 + s4*nShell],}
\DoxyCodeLine{2394                              ShBlkNorms\_batch[iBatch][s3 + s4*nShell]));}
\DoxyCodeLine{2395             shMax = std::max(shMax, shMax123\_batch[iBatch]); }
\DoxyCodeLine{2396              }
\DoxyCodeLine{2397             \textcolor{keywordflow}{if}((shMax*SchwarzGauge[s1+s2*nShell]*SchwarzGauge[s4+s3*nShell]) <}
\DoxyCodeLine{2398               eri.\mbox{\hyperlink{classChronusQ_1_1DirectTPI_a51ce753ee588706401406d4216c1ba74}{threshSchwarz}}()) \{}
\DoxyCodeLine{2399               nConSkipGauge[thread\_id] ++;}
\DoxyCodeLine{2400             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2401               contract\_batch[nCon] = iBatch; }
\DoxyCodeLine{2402               nCon++;  }
\DoxyCodeLine{2403             \}}
\DoxyCodeLine{2404           \}}
\DoxyCodeLine{2405 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2406 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2407   }
\DoxyCodeLine{2408 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{2409           \textcolor{keyword}{auto} topDirectGaugeInt = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{2410 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2411   }
\DoxyCodeLine{2412           shls[0] = int(s1);}
\DoxyCodeLine{2413           shls[1] = int(s2);}
\DoxyCodeLine{2414           shls[2] = int(s3);}
\DoxyCodeLine{2415           shls[3] = int(s4);}
\DoxyCodeLine{2416 }
\DoxyCodeLine{2417           \textcolor{comment}{//∇B∇C}}
\DoxyCodeLine{2418           skiperi1 = int2e\_gauge\_r1\_ssp1sps2\_sph(buffr1, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, cache);}
\DoxyCodeLine{2419           skiperi2 = int2e\_gauge\_r2\_ssp1sps2\_sph(buffr2, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, cache);}
\DoxyCodeLine{2420 }
\DoxyCodeLine{2421           \textcolor{keywordflow}{if}(skiperi1==0 and skiperi2==0) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{2422 }
\DoxyCodeLine{2423           \textcolor{keyword}{auto} nQuad = n1*n2*n3*n4;}
\DoxyCodeLine{2424 }
\DoxyCodeLine{2425           mnkl = 0ul;}
\DoxyCodeLine{2426           \textcolor{keywordflow}{for}(l = 3*maxShellSize; l < 3*maxShellSize + n4; ++l) }
\DoxyCodeLine{2427           \textcolor{keywordflow}{for}(k = 2*maxShellSize; k < 2*maxShellSize + n3; ++k) }
\DoxyCodeLine{2428           \textcolor{keywordflow}{for}(n =   maxShellSize; n <   maxShellSize + n2; ++n)}
\DoxyCodeLine{2429           \textcolor{keywordflow}{for}(m = 0             ; m <                  n1; ++m) \{}
\DoxyCodeLine{2430 }
\DoxyCodeLine{2431             \textcolor{keyword}{auto} MNKL = m + n*NB + k*NB2 + l*NB3;}
\DoxyCodeLine{2432             \textcolor{keyword}{auto} LKNM = l + k*NB + n*NB2 + m*NB3;}
\DoxyCodeLine{2433 }
\DoxyCodeLine{2434             \textcolor{comment}{//enum Gauge\_ERI \{}}
\DoxyCodeLine{2435             \textcolor{comment}{//  SxSx,  // σ\_x * σ\_x     0}}
\DoxyCodeLine{2436             \textcolor{comment}{//  SySx,  // σ\_y * σ\_x     1}}
\DoxyCodeLine{2437             \textcolor{comment}{//  SzSx,  // σ\_z * σ\_x     2}}
\DoxyCodeLine{2438             \textcolor{comment}{//  ISx,   // I   * σ\_x     3}}
\DoxyCodeLine{2439             \textcolor{comment}{//  SxSy,  // σ\_x * σ\_y     4}}
\DoxyCodeLine{2440             \textcolor{comment}{//  SySy,  // σ\_y * σ\_y     5}}
\DoxyCodeLine{2441             \textcolor{comment}{//  SzSy,  // σ\_z * σ\_y     6}}
\DoxyCodeLine{2442             \textcolor{comment}{//  ISy,   // I   * σ\_y     7}}
\DoxyCodeLine{2443             \textcolor{comment}{//  SxSz,  // σ\_x * σ\_z     8}}
\DoxyCodeLine{2444             \textcolor{comment}{//  SySz,  // σ\_y * σ\_z     9}}
\DoxyCodeLine{2445             \textcolor{comment}{//  SzSz,  // σ\_z * σ\_z     10}}
\DoxyCodeLine{2446             \textcolor{comment}{//  ISz,   // I   * σ\_z     11}}
\DoxyCodeLine{2447             \textcolor{comment}{//  SxI,   // σ\_x * I       12}}
\DoxyCodeLine{2448             \textcolor{comment}{//  SyI,   // σ\_y * I       13}}
\DoxyCodeLine{2449             \textcolor{comment}{//  SzI,   // σ\_z * I       14}}
\DoxyCodeLine{2450             \textcolor{comment}{//  II     // I   * I       15}}
\DoxyCodeLine{2451             \textcolor{comment}{//\};}}
\DoxyCodeLine{2452             }
\DoxyCodeLine{2453             \textcolor{comment}{// (ss)}}
\DoxyCodeLine{2454             BC[MNKL] = buffr1[15*nQuad+mnkl] -\/ buffr2[15*nQuad+mnkl];}
\DoxyCodeLine{2455             BC[LKNM] = buffr1[15*nQuad+mnkl] -\/ buffr2[15*nQuad+mnkl];}
\DoxyCodeLine{2456             }
\DoxyCodeLine{2457             \textcolor{comment}{// (sσ)\_x}}
\DoxyCodeLine{2458             BC[NB4+MNKL] = buffr1[3*nQuad+mnkl] -\/ buffr2[3*nQuad+mnkl];}
\DoxyCodeLine{2459             BC[NB4+LKNM] = buffr2[12*nQuad+mnkl] -\/ buffr1[12*nQuad+mnkl];}
\DoxyCodeLine{2460             }
\DoxyCodeLine{2461             \textcolor{comment}{// (sσ)\_y}}
\DoxyCodeLine{2462             BC[NB4\_2+MNKL] = buffr1[7*nQuad+mnkl] -\/ buffr2[7*nQuad+mnkl];}
\DoxyCodeLine{2463             BC[NB4\_2+LKNM] = buffr2[13*nQuad+mnkl] -\/ buffr1[13*nQuad+mnkl];}
\DoxyCodeLine{2464             }
\DoxyCodeLine{2465             \textcolor{comment}{// (sσ)\_z}}
\DoxyCodeLine{2466             BC[NB4\_3+MNKL] = buffr1[11*nQuad+mnkl] -\/ buffr2[11*nQuad+mnkl];}
\DoxyCodeLine{2467             BC[NB4\_3+LKNM] = buffr2[14*nQuad+mnkl] -\/ buffr1[14*nQuad+mnkl];}
\DoxyCodeLine{2468             }
\DoxyCodeLine{2469             \textcolor{comment}{// (σs)\_x}}
\DoxyCodeLine{2470             BC[NB4\_4+MNKL] = buffr1[12*nQuad+mnkl] -\/ buffr2[12*nQuad+mnkl];}
\DoxyCodeLine{2471             BC[NB4\_4+LKNM] = buffr2[3*nQuad+mnkl] -\/ buffr1[3*nQuad+mnkl];}
\DoxyCodeLine{2472             }
\DoxyCodeLine{2473             \textcolor{comment}{// (σs)\_y}}
\DoxyCodeLine{2474             BC[NB4\_5+MNKL] = buffr1[13*nQuad+mnkl] -\/ buffr2[13*nQuad+mnkl];}
\DoxyCodeLine{2475             BC[NB4\_5+LKNM] = buffr2[7*nQuad+mnkl] -\/ buffr1[7*nQuad+mnkl];}
\DoxyCodeLine{2476             }
\DoxyCodeLine{2477             \textcolor{comment}{// (σs)\_z}}
\DoxyCodeLine{2478             BC[NB4\_6+MNKL] = buffr1[14*nQuad+mnkl] -\/ buffr2[14*nQuad+mnkl];}
\DoxyCodeLine{2479             BC[NB4\_6+LKNM] = buffr2[11*nQuad+mnkl] -\/ buffr1[11*nQuad+mnkl];}
\DoxyCodeLine{2480             }
\DoxyCodeLine{2481             \textcolor{comment}{// σ\_x*σ\_x}}
\DoxyCodeLine{2482             BC[NB4\_7+MNKL] = -\/(buffr1[mnkl] -\/ buffr2[mnkl]);}
\DoxyCodeLine{2483             BC[NB4\_7+LKNM] = -\/(buffr1[mnkl] -\/ buffr2[mnkl]);}
\DoxyCodeLine{2484             }
\DoxyCodeLine{2485             \textcolor{comment}{// σ\_x*σ\_y}}
\DoxyCodeLine{2486             BC[NB4\_8+MNKL] = -\/(buffr1[4*nQuad+mnkl] -\/ buffr2[4*nQuad+mnkl]);}
\DoxyCodeLine{2487             BC[NB4\_8+LKNM] = -\/(buffr1[1*nQuad+mnkl] -\/ buffr2[1*nQuad+mnkl]);}
\DoxyCodeLine{2488             }
\DoxyCodeLine{2489             \textcolor{comment}{// σ\_x*σ\_z}}
\DoxyCodeLine{2490             BC[NB4\_9+MNKL] = -\/(buffr1[8*nQuad+mnkl] -\/ buffr2[8*nQuad+mnkl]);}
\DoxyCodeLine{2491             BC[NB4\_9+LKNM] = -\/(buffr1[2*nQuad+mnkl] -\/ buffr2[2*nQuad+mnkl]);}
\DoxyCodeLine{2492             }
\DoxyCodeLine{2493             \textcolor{comment}{// σ\_y*σ\_x}}
\DoxyCodeLine{2494             BC[NB4\_10+MNKL] = -\/(buffr1[1*nQuad+mnkl] -\/ buffr2[1*nQuad+mnkl]);}
\DoxyCodeLine{2495             BC[NB4\_10+LKNM] = -\/(buffr1[4*nQuad+mnkl] -\/ buffr2[4*nQuad+mnkl]);}
\DoxyCodeLine{2496             }
\DoxyCodeLine{2497             \textcolor{comment}{// σ\_y*σ\_y}}
\DoxyCodeLine{2498             BC[NB4\_11+MNKL] = -\/(buffr1[5*nQuad+mnkl] -\/ buffr2[5*nQuad+mnkl]);}
\DoxyCodeLine{2499             BC[NB4\_11+LKNM] = -\/(buffr1[5*nQuad+mnkl] -\/ buffr2[5*nQuad+mnkl]);}
\DoxyCodeLine{2500             }
\DoxyCodeLine{2501             \textcolor{comment}{// σ\_y*σ\_z}}
\DoxyCodeLine{2502             BC[NB4\_12+MNKL] = -\/(buffr1[9*nQuad+mnkl] -\/ buffr2[9*nQuad+mnkl]);}
\DoxyCodeLine{2503             BC[NB4\_12+LKNM] = -\/(buffr1[6*nQuad+mnkl] -\/ buffr2[6*nQuad+mnkl]);}
\DoxyCodeLine{2504             }
\DoxyCodeLine{2505             \textcolor{comment}{// σ\_z*σ\_x}}
\DoxyCodeLine{2506             BC[NB4\_13+MNKL] = -\/(buffr1[2*nQuad+mnkl] -\/ buffr2[2*nQuad+mnkl]);}
\DoxyCodeLine{2507             BC[NB4\_13+LKNM] = -\/(buffr1[8*nQuad+mnkl] -\/ buffr2[8*nQuad+mnkl]);}
\DoxyCodeLine{2508             }
\DoxyCodeLine{2509             \textcolor{comment}{// σ\_z*σ\_y}}
\DoxyCodeLine{2510             BC[NB4\_14+MNKL] = -\/(buffr1[6*nQuad+mnkl] -\/ buffr2[6*nQuad+mnkl]);}
\DoxyCodeLine{2511             BC[NB4\_14+LKNM] = -\/(buffr1[9*nQuad+mnkl] -\/ buffr2[9*nQuad+mnkl]);}
\DoxyCodeLine{2512             }
\DoxyCodeLine{2513             \textcolor{comment}{// σ\_z*σ\_z}}
\DoxyCodeLine{2514             BC[NB4\_15+MNKL] = -\/(buffr1[10*nQuad+mnkl] -\/ buffr2[10*nQuad+mnkl]);}
\DoxyCodeLine{2515             BC[NB4\_15+LKNM] = -\/(buffr1[10*nQuad+mnkl] -\/ buffr2[10*nQuad+mnkl]);}
\DoxyCodeLine{2516             }
\DoxyCodeLine{2517             mnkl++;}
\DoxyCodeLine{2518 }
\DoxyCodeLine{2519           \} \textcolor{comment}{// ∇B∇C integral preparation loop}}
\DoxyCodeLine{2520   }
\DoxyCodeLine{2521 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{2522           durDirectGaugeInt[thread\_id] += \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topDirectGaugeInt); }
\DoxyCodeLine{2523 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2524   }
\DoxyCodeLine{2525 \textcolor{preprocessor}{\#ifdef \_CONTRACTION\_ }\textcolor{comment}{// Contraction}}
\DoxyCodeLine{2526 }
\DoxyCodeLine{2527 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{2528           \textcolor{keyword}{auto} topDirectGaugeCon = \mbox{\hyperlink{namespaceChronusQ_a715f671201f0f6e77216fcf1f72adbaf}{tick}}();}
\DoxyCodeLine{2529 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2530           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iCon = 0ul; iCon < nCon; iCon++) \{  }
\DoxyCodeLine{2531             }
\DoxyCodeLine{2532             matOff = contract\_batch[iCon] * mMat; }
\DoxyCodeLine{2533             }
\DoxyCodeLine{2534             \textcolor{keyword}{auto} DCLSpmSLMS = matList[matOff].X-\/>S().pointer();}
\DoxyCodeLine{2535             \textcolor{keyword}{auto} DCLSpmSLMX = matList[matOff].X-\/>X().pointer();}
\DoxyCodeLine{2536             \textcolor{keyword}{auto} DCLSpmSLMY = matList[matOff].X-\/>Y().pointer();}
\DoxyCodeLine{2537             \textcolor{keyword}{auto} DCLSpmSLMZ = matList[matOff].X-\/>Z().pointer();}
\DoxyCodeLine{2538             }
\DoxyCodeLine{2539             \textcolor{keyword}{auto} ADCLSMS  = AX\_loc[matOff]-\/>S().pointer();}
\DoxyCodeLine{2540             \textcolor{keyword}{auto} ADCLSMX  = AX\_loc[matOff]-\/>X().pointer();}
\DoxyCodeLine{2541             \textcolor{keyword}{auto} ADCLSMY  = AX\_loc[matOff]-\/>Y().pointer();}
\DoxyCodeLine{2542             \textcolor{keyword}{auto} ADCLSMZ  = AX\_loc[matOff]-\/>Z().pointer();}
\DoxyCodeLine{2543  }
\DoxyCodeLine{2544           \textcolor{keywordflow}{for}(m = 0ul,            bf1 = bf1\_s; m <                  n1; ++m, bf1++) \{}
\DoxyCodeLine{2545           \textcolor{keywordflow}{for}(n =   maxShellSize, bf2 = bf2\_s; n <   maxShellSize + n2; ++n, bf2++) \{}
\DoxyCodeLine{2546             \textcolor{keyword}{auto} bf1nB = bf1*nBasis;}
\DoxyCodeLine{2547             \textcolor{keyword}{auto} bf2nB = bf2*nBasis;}
\DoxyCodeLine{2548 }
\DoxyCodeLine{2549           \textcolor{keywordflow}{for}(k = 2*maxShellSize, bf3 = bf3\_s; k < 2*maxShellSize + n3; ++k, bf3++) \{}
\DoxyCodeLine{2550             \textcolor{keyword}{auto} bf3nB = bf3*nBasis;}
\DoxyCodeLine{2551 }
\DoxyCodeLine{2552           \textcolor{keywordflow}{for}(l = 3*maxShellSize, bf4 = bf4\_s; l < 3*maxShellSize + n4; ++l, bf4++) \{}
\DoxyCodeLine{2553             \textcolor{keyword}{auto} MNKL = m + n*NB + k*NB2 + l*NB3;}
\DoxyCodeLine{2554             \textcolor{keyword}{auto} LKNM = l + k*NB + n*NB2 + m*NB3;}
\DoxyCodeLine{2555 }
\DoxyCodeLine{2556             \textcolor{keyword}{auto} bf4nB= bf4*nBasis;}
\DoxyCodeLine{2557             \textcolor{keyword}{auto} bf14 = bf1 + bf4nB;}
\DoxyCodeLine{2558             \textcolor{keyword}{auto} bf24 = bf2 + bf4nB;}
\DoxyCodeLine{2559             \textcolor{keyword}{auto} bf23 = bf2 + bf3nB;}
\DoxyCodeLine{2560             \textcolor{keyword}{auto} bf13 = bf1 + bf3nB;}
\DoxyCodeLine{2561             \textcolor{keyword}{auto} bf41 = bf4 + bf1nB;}
\DoxyCodeLine{2562             \textcolor{keyword}{auto} bf31 = bf3 + bf1nB;}
\DoxyCodeLine{2563             \textcolor{keyword}{auto} bf32 = bf3 + bf2nB;}
\DoxyCodeLine{2564             \textcolor{keyword}{auto} bf42 = bf4 + bf2nB;}
\DoxyCodeLine{2565             \textcolor{keyword}{auto} bf34 = bf3 + bf4nB;}
\DoxyCodeLine{2566             \textcolor{keyword}{auto} bf43 = bf4 + bf3nB;}
\DoxyCodeLine{2567             \textcolor{keyword}{auto} bf12 = bf1 + bf2nB;}
\DoxyCodeLine{2568             \textcolor{keyword}{auto} bf21 = bf2 + bf1nB;}
\DoxyCodeLine{2569 }
\DoxyCodeLine{2570             \textcolor{comment}{/*++++++++++++++++++++++++*/}}
\DoxyCodeLine{2571             \textcolor{comment}{/* Start of Gauge (LL|SS) */}}
\DoxyCodeLine{2572             \textcolor{comment}{/*++++++++++++++++++++++++*/}}
\DoxyCodeLine{2573              }
\DoxyCodeLine{2574             }
\DoxyCodeLine{2575             \textcolor{comment}{// Coulomb}}
\DoxyCodeLine{2576             \textcolor{comment}{// MNKL}}
\DoxyCodeLine{2577             }
\DoxyCodeLine{2578             \textcolor{comment}{/* Equations (232) and (233) */}}
\DoxyCodeLine{2579             ADCLSMS[bf12]+=    -\/ DCLSpmSLMS[bf43] * BC[MNKL]}
\DoxyCodeLine{2580                             -\/ (  DCLSpmSLMX[bf43] * BC[MNKL+sx] }
\DoxyCodeLine{2581                                + DCLSpmSLMY[bf43] * BC[MNKL+sy] }
\DoxyCodeLine{2582                                + DCLSpmSLMZ[bf43] * BC[MNKL+sz]) * iS;}
\DoxyCodeLine{2583             }
\DoxyCodeLine{2584             ADCLSMX[bf12]+=-\/ DCLSpmSLMS[bf43] * BC[MNKL+xs] * iS }
\DoxyCodeLine{2585                            -\/ DCLSpmSLMX[bf43] * BC[MNKL+xx]}
\DoxyCodeLine{2586                            -\/ DCLSpmSLMY[bf43] * BC[MNKL+xy]}
\DoxyCodeLine{2587                            -\/ DCLSpmSLMZ[bf43] * BC[MNKL+xz]; }
\DoxyCodeLine{2588             }
\DoxyCodeLine{2589             ADCLSMY[bf12]+=-\/ DCLSpmSLMS[bf43] * BC[MNKL+ys] * iS }
\DoxyCodeLine{2590                            -\/ DCLSpmSLMX[bf43] * BC[MNKL+yx]}
\DoxyCodeLine{2591                            -\/ DCLSpmSLMY[bf43] * BC[MNKL+yy]}
\DoxyCodeLine{2592                            -\/ DCLSpmSLMZ[bf43] * BC[MNKL+yz]; }
\DoxyCodeLine{2593             }
\DoxyCodeLine{2594             ADCLSMZ[bf12]+=-\/ DCLSpmSLMS[bf43] * BC[MNKL+zs] * iS }
\DoxyCodeLine{2595                            -\/ DCLSpmSLMX[bf43] * BC[MNKL+zx]}
\DoxyCodeLine{2596                            -\/ DCLSpmSLMY[bf43] * BC[MNKL+zy]}
\DoxyCodeLine{2597                            -\/ DCLSpmSLMZ[bf43] * BC[MNKL+zz]; }
\DoxyCodeLine{2598             }
\DoxyCodeLine{2599             \textcolor{comment}{// LKNM}}
\DoxyCodeLine{2600             \textcolor{keywordflow}{if}(bf1\_s!=bf4\_s or bf2\_s!=bf3\_s) \{}
\DoxyCodeLine{2601               }
\DoxyCodeLine{2602               ADCLSMS[bf43]+=    -\/ DCLSpmSLMS[bf12] * BC[LKNM]}
\DoxyCodeLine{2603                               -\/ (  DCLSpmSLMX[bf12] * BC[LKNM+sx] }
\DoxyCodeLine{2604                                  + DCLSpmSLMY[bf12] * BC[LKNM+sy] }
\DoxyCodeLine{2605                                  + DCLSpmSLMZ[bf12] * BC[LKNM+sz]) * iS;}
\DoxyCodeLine{2606               }
\DoxyCodeLine{2607               ADCLSMX[bf43]+=-\/ DCLSpmSLMS[bf12] * BC[LKNM+xs] * iS }
\DoxyCodeLine{2608                              -\/ DCLSpmSLMX[bf12] * BC[LKNM+xx]}
\DoxyCodeLine{2609                              -\/ DCLSpmSLMY[bf12] * BC[LKNM+xy]}
\DoxyCodeLine{2610                              -\/ DCLSpmSLMZ[bf12] * BC[LKNM+xz]; }
\DoxyCodeLine{2611               }
\DoxyCodeLine{2612               ADCLSMY[bf43]+=-\/ DCLSpmSLMS[bf12] * BC[LKNM+ys] * iS }
\DoxyCodeLine{2613                              -\/ DCLSpmSLMX[bf12] * BC[LKNM+yx]}
\DoxyCodeLine{2614                              -\/ DCLSpmSLMY[bf12] * BC[LKNM+yy]}
\DoxyCodeLine{2615                              -\/ DCLSpmSLMZ[bf12] * BC[LKNM+yz]; }
\DoxyCodeLine{2616               }
\DoxyCodeLine{2617               ADCLSMZ[bf43]+=-\/ DCLSpmSLMS[bf12] * BC[LKNM+zs] * iS }
\DoxyCodeLine{2618                              -\/ DCLSpmSLMX[bf12] * BC[LKNM+zx]}
\DoxyCodeLine{2619                              -\/ DCLSpmSLMY[bf12] * BC[LKNM+zy]}
\DoxyCodeLine{2620                              -\/ DCLSpmSLMZ[bf12] * BC[LKNM+zz]; }
\DoxyCodeLine{2621               }
\DoxyCodeLine{2622             \}}
\DoxyCodeLine{2623              }
\DoxyCodeLine{2624           \}}
\DoxyCodeLine{2625           \}}
\DoxyCodeLine{2626           \}}
\DoxyCodeLine{2627           \}}
\DoxyCodeLine{2628           \} \textcolor{comment}{// contraction loop}}
\DoxyCodeLine{2629   }
\DoxyCodeLine{2630 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// Contraction}}
\DoxyCodeLine{2631   }
\DoxyCodeLine{2632 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{2633         durDirectGaugeCon[thread\_id] += \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topDirectGaugeCon); }
\DoxyCodeLine{2634 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2635   }
\DoxyCodeLine{2636         \}; \textcolor{comment}{// loop s4}}
\DoxyCodeLine{2637         \}; \textcolor{comment}{// loop s3}}
\DoxyCodeLine{2638         \}; \textcolor{comment}{// loop s2}}
\DoxyCodeLine{2639         \}; \textcolor{comment}{// loop s1}}
\DoxyCodeLine{2640   }
\DoxyCodeLine{2641   }
\DoxyCodeLine{2642       \} \textcolor{comment}{// OpenMP context}}
\DoxyCodeLine{2643   }
\DoxyCodeLine{2644   }
\DoxyCodeLine{2645       \textcolor{keywordflow}{for}( \textcolor{keyword}{auto} iTh  = 0; iTh < nThreads; iTh++) }
\DoxyCodeLine{2646       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iMat = 0ul; iMat < nMat; iMat++) \{  }
\DoxyCodeLine{2647         matList[iMat].AX-\/>S() +=  AXthreads[iTh][iMat]-\/>S();  }
\DoxyCodeLine{2648         matList[iMat].AX-\/>X() +=  AXthreads[iTh][iMat]-\/>X();  }
\DoxyCodeLine{2649         matList[iMat].AX-\/>Y() +=  AXthreads[iTh][iMat]-\/>Y();  }
\DoxyCodeLine{2650         matList[iMat].AX-\/>Z() +=  AXthreads[iTh][iMat]-\/>Z();  }
\DoxyCodeLine{2651       \}}
\DoxyCodeLine{2652 }
\DoxyCodeLine{2653       memManager\_.free(ERIBuffer);}
\DoxyCodeLine{2654       memManager\_.free(buffAll, cacheAll);}
\DoxyCodeLine{2655   }
\DoxyCodeLine{2656 \textcolor{preprocessor}{\#ifdef \_REPORT\_INTEGRAL\_TIMINGS}}
\DoxyCodeLine{2657       \textcolor{keywordtype}{size\_t} nIntSkipGaugeAcc = std::accumulate(nIntSkipGauge.begin(),nIntSkipGauge.end(),0);}
\DoxyCodeLine{2658       \textcolor{keywordtype}{double} durDirectGaugeIntAcc = std::accumulate(durDirectGaugeInt.begin(), durDirectGaugeInt.end(),0.);}
\DoxyCodeLine{2659       \textcolor{keywordtype}{double} durDirectGaugeConAcc = std::accumulate(durDirectGaugeCon.begin(), durDirectGaugeCon.end(),0.);}
\DoxyCodeLine{2660       }
\DoxyCodeLine{2661       std::cout << std::endl;}
\DoxyCodeLine{2662       std::cout << \textcolor{stringliteral}{"{}Gauge Skipped Integral   : "{}} << nIntSkipGaugeAcc << std::endl;}
\DoxyCodeLine{2663   }
\DoxyCodeLine{2664 \textcolor{preprocessor}{\#ifdef \_SEPARATED\_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{2665       \textcolor{keywordtype}{size\_t} nConSkipGaugeAcc = std::accumulate(nConSkipGauge.begin(),nConSkipGauge.end(),0);}
\DoxyCodeLine{2666       std::cout << \textcolor{stringliteral}{"{}      Skipped Contraction: "{}} << nConSkipGaugeAcc << std::endl;}
\DoxyCodeLine{2667 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2668       \textcolor{keyword}{auto} durDirectGauge = \mbox{\hyperlink{namespaceChronusQ_a3b2153e93af4532ff5b1e75d8af453b0}{tock}}(topDirectGauge);}
\DoxyCodeLine{2669       std::cout << \textcolor{stringliteral}{"{}Gauge AO Direct Contraction took "{}} <<  durDirectGauge}
\DoxyCodeLine{2670                 << \textcolor{stringliteral}{"{} s for "{}} << nBatch << \textcolor{stringliteral}{"{} Batch "{}} << std::endl; }
\DoxyCodeLine{2671       std::cout << \textcolor{stringliteral}{"{}            Build Integrals took "{}} <<  durDirectGaugeIntAcc << \textcolor{stringliteral}{"{} s"{}} }
\DoxyCodeLine{2672                 << \textcolor{stringliteral}{"{} from all "{}} << nThreads << \textcolor{stringliteral}{"{} thread(s)"{}} << std::endl;}
\DoxyCodeLine{2673       std::cout << \textcolor{stringliteral}{"{}            Contractions    took "{}} <<  durDirectGaugeConAcc << \textcolor{stringliteral}{"{} s"{}}}
\DoxyCodeLine{2674                 << \textcolor{stringliteral}{"{} from all "{}} << nThreads << \textcolor{stringliteral}{"{} thread(s)"{}} << std::endl;}
\DoxyCodeLine{2675 }
\DoxyCodeLine{2676       std::cout << std::endl;}
\DoxyCodeLine{2677 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2678 }
\DoxyCodeLine{2679     \} \textcolor{comment}{// if(Gauge)}}
\DoxyCodeLine{2680 }
\DoxyCodeLine{2681 \textcolor{comment}{    /*******************/}}
\DoxyCodeLine{2682     \textcolor{comment}{/*                 */}}
\DoxyCodeLine{2683     \textcolor{comment}{/*   End of Gaunt  */}}
\DoxyCodeLine{2684     \textcolor{comment}{/*                 */}}
\DoxyCodeLine{2685 \textcolor{comment}{    /*******************/}}
\DoxyCodeLine{2686 }
\DoxyCodeLine{2687 }
\DoxyCodeLine{2688 \textcolor{preprocessor}{\#ifdef \_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{2689     \textcolor{keywordflow}{if}(ShBlkNorms\_raw) memManager\_.free(ShBlkNorms\_raw);}
\DoxyCodeLine{2690     \textcolor{keywordflow}{if}(SchwarzSSSS)    memManager\_.free(SchwarzSSSS);}
\DoxyCodeLine{2691     \textcolor{keywordflow}{if}(SchwarzERI)     memManager\_.free(SchwarzERI);}
\DoxyCodeLine{2692     \textcolor{keywordflow}{if}(SchwarzGaunt)   memManager\_.free(SchwarzGaunt);}
\DoxyCodeLine{2693     \textcolor{keywordflow}{if}(SchwarzGauge)   memManager\_.free(SchwarzGauge);}
\DoxyCodeLine{2694 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2695   }
\DoxyCodeLine{2696     memManager\_.free(atm);}
\DoxyCodeLine{2697     memManager\_.free(bas);}
\DoxyCodeLine{2698     memManager\_.free(env);}
\DoxyCodeLine{2699   }
\DoxyCodeLine{2700     \textcolor{comment}{// Turn threads for LA back on}}
\DoxyCodeLine{2701     \textcolor{comment}{// SetLAThreads(LAThreads);}}
\DoxyCodeLine{2702   }
\DoxyCodeLine{2703   \}; \textcolor{comment}{// GTODirectRelERIContraction::directRelScaffoldLibcintCoulombOnly}}
\DoxyCodeLine{2704   }
\DoxyCodeLine{2705   \textcolor{keyword}{template} <>}
\DoxyCodeLine{2706   \textcolor{keywordtype}{void} \mbox{\hyperlink{classChronusQ_1_1GTODirectRelERIContraction_adb354ad0582c068409f9c76c4b728ea9}{GTODirectRelERIContraction<double,double>::directRelScaffoldLibcintCoulombOnly}}(}
\DoxyCodeLine{2707     \mbox{\hyperlink{structChronusQ_1_1MPI__Comm}{MPI\_Comm}} comm, \textcolor{keyword}{const} \textcolor{keywordtype}{bool} screen,}
\DoxyCodeLine{2708     std::vector<\mbox{\hyperlink{structChronusQ_1_1TwoBodyRelContraction}{TwoBodyRelContraction<double>}}> \&matList)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{2709     \mbox{\hyperlink{namespaceChronusQ_afbba655765a7a40e19e2bea928a687c7}{CErr}}(\textcolor{stringliteral}{"{}Dirac-\/Coulomb + Real is an invalid option"{}},std::cout);  }
\DoxyCodeLine{2710   \}}
\DoxyCodeLine{2711 }
\DoxyCodeLine{2712   \textcolor{keyword}{template} <>}
\DoxyCodeLine{2713   \textcolor{keywordtype}{void} \mbox{\hyperlink{classChronusQ_1_1GTODirectRelERIContraction_adb354ad0582c068409f9c76c4b728ea9}{GTODirectRelERIContraction<dcomplex,dcomplex>::directRelScaffoldLibcintCoulombOnly}}(}
\DoxyCodeLine{2714     \mbox{\hyperlink{structChronusQ_1_1MPI__Comm}{MPI\_Comm}} comm, \textcolor{keyword}{const} \textcolor{keywordtype}{bool} screen,}
\DoxyCodeLine{2715     std::vector<\mbox{\hyperlink{structChronusQ_1_1TwoBodyRelContraction}{TwoBodyRelContraction<dcomplex>}}> \&matList)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{2716     \mbox{\hyperlink{namespaceChronusQ_afbba655765a7a40e19e2bea928a687c7}{CErr}}(\textcolor{stringliteral}{"{}Complex integral is is an invalid option"{}},std::cout);  }
\DoxyCodeLine{2717   \}}
\DoxyCodeLine{2718   }
\DoxyCodeLine{2719   \textcolor{keyword}{template} <\textcolor{keyword}{typename} MatsT, \textcolor{keyword}{typename} IntsT>}
\DoxyCodeLine{2720   \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{classChronusQ_1_1GTODirectRelERIContraction_ae86d02826b5528329d43ec9394615b51}{GTODirectRelERIContraction<MatsT,IntsT>::libcintCacheSize}}(}
\DoxyCodeLine{2721     \textcolor{keyword}{const} \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cb}{TWOBODY\_CONTRACTION\_TYPE}} \& contType, \textcolor{keywordtype}{int} * atm, \textcolor{keyword}{const} \textcolor{keywordtype}{int} nAtoms, }
\DoxyCodeLine{2722     \textcolor{keywordtype}{int} * bas, \textcolor{keyword}{const} \textcolor{keywordtype}{int} nShells, \textcolor{keywordtype}{double} * env)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{2723     }
\DoxyCodeLine{2724     \textcolor{keywordtype}{size\_t} cache\_size = 0ul;}
\DoxyCodeLine{2725     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < nShells; i++) \{}
\DoxyCodeLine{2726       \textcolor{keywordtype}{size\_t} n;}
\DoxyCodeLine{2727       \textcolor{keywordtype}{int} shls[4]\{i,i,i,i\};}
\DoxyCodeLine{2728       \textcolor{keywordflow}{if}(contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba8578053891caf9c4af3c665d73fa43ac}{TWOBODY\_CONTRACTION\_TYPE::BARE\_COULOMB}} or}
\DoxyCodeLine{2729          contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba1d269d4b7d6c561fc04b81a2a178e2a5}{TWOBODY\_CONTRACTION\_TYPE::LLLL}} or}
\DoxyCodeLine{2730          contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cbad5017ac8c585ad30ff49af6467d2efc6}{TWOBODY\_CONTRACTION\_TYPE::LLSS}}) \{}
\DoxyCodeLine{2731         n = int2e\_sph(\textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{2732         cache\_size = std::max(cache\_size, n);}
\DoxyCodeLine{2733       \}}
\DoxyCodeLine{2734       \textcolor{keywordflow}{if}(contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cbaf5b0f392e82b90ea1452a00512088d53}{TWOBODY\_CONTRACTION\_TYPE::SSSS}} or}
\DoxyCodeLine{2735          contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba1d269d4b7d6c561fc04b81a2a178e2a5}{TWOBODY\_CONTRACTION\_TYPE::LLLL}} or}
\DoxyCodeLine{2736          contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cbad5017ac8c585ad30ff49af6467d2efc6}{TWOBODY\_CONTRACTION\_TYPE::LLSS}}) \{}
\DoxyCodeLine{2737         n = int2e\_ipvip1ipvip2\_sph(\textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{2738         cache\_size = std::max(cache\_size, n);}
\DoxyCodeLine{2739       \}}
\DoxyCodeLine{2740       \textcolor{keywordflow}{if}(contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba1d269d4b7d6c561fc04b81a2a178e2a5}{TWOBODY\_CONTRACTION\_TYPE::LLLL}} or}
\DoxyCodeLine{2741          contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cbad5017ac8c585ad30ff49af6467d2efc6}{TWOBODY\_CONTRACTION\_TYPE::LLSS}}) \{}
\DoxyCodeLine{2742         n = int2e\_ipvip1\_sph(\textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{2743         cache\_size = std::max(cache\_size, n);}
\DoxyCodeLine{2744       \}}
\DoxyCodeLine{2745       \textcolor{keywordflow}{if}(contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba619fb0d8a58386d6c365eb7fa1bae867}{TWOBODY\_CONTRACTION\_TYPE::GAUNT}}) \{}
\DoxyCodeLine{2746         n = int2e\_ip1ip2\_sph(\textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{2747         cache\_size = std::max(cache\_size, n);}
\DoxyCodeLine{2748       \}}
\DoxyCodeLine{2749       \textcolor{keywordflow}{if}(contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba01337b51d63cd7bba6d5daf63ff8d911}{TWOBODY\_CONTRACTION\_TYPE::GAUGE}}) \{}
\DoxyCodeLine{2750         n = int2e\_gauge\_r1\_ssp1sps2\_sph(\textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{2751         cache\_size = std::max(cache\_size, n);}
\DoxyCodeLine{2752         n = int2e\_gauge\_r2\_ssp1sps2\_sph(\textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{2753         cache\_size = std::max(cache\_size, n);}
\DoxyCodeLine{2754         n = int2e\_gauge\_r1\_ssp1ssp2\_sph(\textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{2755         cache\_size = std::max(cache\_size, n);}
\DoxyCodeLine{2756         n = int2e\_gauge\_r2\_ssp1ssp2\_sph(\textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr}, shls, atm, nAtoms, bas, nShells, env, \textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{2757         cache\_size = std::max(cache\_size, n);}
\DoxyCodeLine{2758       \}}
\DoxyCodeLine{2759     \}}
\DoxyCodeLine{2760 }
\DoxyCodeLine{2761     \textcolor{keywordflow}{return} cache\_size; }
\DoxyCodeLine{2762   \}}
\DoxyCodeLine{2763 }
\DoxyCodeLine{2764 \textcolor{comment}{  /*******************************************************************************/}}
\DoxyCodeLine{2765   \textcolor{comment}{/*                                                                             */}}
\DoxyCodeLine{2766   \textcolor{comment}{/* Compute memory requirement for Libcint Batch 4C-\/direct                      */}}
\DoxyCodeLine{2767   \textcolor{comment}{/* Returns:                                                                    */}}
\DoxyCodeLine{2768   \textcolor{comment}{/*   size\_t SCR size needed for one batch                                      */}}
\DoxyCodeLine{2769   \textcolor{comment}{/*   IMPORTANT HERE: size are all in MatsT(dcomplex)                           */}}
\DoxyCodeLine{2770 \textcolor{comment}{  /*******************************************************************************/}}
\DoxyCodeLine{2771   }
\DoxyCodeLine{2772   \textcolor{keyword}{template} <\textcolor{keyword}{typename} MatsT, \textcolor{keyword}{typename} IntsT>}
\DoxyCodeLine{2773   \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{classChronusQ_1_1GTODirectRelERIContraction_aa450d1a91fe79be3ae93885d26e2d7ea}{GTODirectRelERIContraction<MatsT,IntsT>::directRelScaffoldLibcintSCRSize}}(}
\DoxyCodeLine{2774     \textcolor{keyword}{const} \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cb}{TWOBODY\_CONTRACTION\_TYPE}} \& contType, \textcolor{keyword}{const} \textcolor{keywordtype}{bool} computeExchange)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{2775     }
\DoxyCodeLine{2776     \textcolor{comment}{// disable NYI part}}
\DoxyCodeLine{2777     \textcolor{keywordflow}{if} (computeExchange or contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cbad5017ac8c585ad30ff49af6467d2efc6}{TWOBODY\_CONTRACTION\_TYPE::LLSS}})}
\DoxyCodeLine{2778       \mbox{\hyperlink{namespaceChronusQ_afbba655765a7a40e19e2bea928a687c7}{CErr}}(\textcolor{stringliteral}{"{}NYI contType in directRelScaffoldSCRSize"{}}); }
\DoxyCodeLine{2779     }
\DoxyCodeLine{2780     \textcolor{keywordtype}{size\_t} threadSCRSize  = 0ul;}
\DoxyCodeLine{2781     \textcolor{keywordtype}{size\_t} generalSCRSize = 0ul;}
\DoxyCodeLine{2782   }
\DoxyCodeLine{2783     \mbox{\hyperlink{classChronusQ_1_1DirectTPI}{DirectTPI<IntsT>}} \&originalERI =}
\DoxyCodeLine{2784         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classChronusQ_1_1DirectTPI}{DirectTPI<IntsT>}}\&\textcolor{keyword}{>}(this-\/>ints\_);}
\DoxyCodeLine{2785     \mbox{\hyperlink{classChronusQ_1_1CQMemManager}{CQMemManager}}\& memManager\_ = originalERI.\mbox{\hyperlink{classChronusQ_1_1ParticleIntegrals_a4980f581ea843bd4ca6be7ac88064274}{memManager}}();}
\DoxyCodeLine{2786     \mbox{\hyperlink{structChronusQ_1_1BasisSet}{BasisSet}}\& originalBasisSet\_ = originalERI.\mbox{\hyperlink{classChronusQ_1_1DirectTPI_a4a476a2dc5e606ee34f0a973b9ddce5c}{basisSet}}();}
\DoxyCodeLine{2787     \mbox{\hyperlink{structChronusQ_1_1Molecule}{Molecule}}\& molecule\_ = originalERI.\mbox{\hyperlink{classChronusQ_1_1DirectTPI_aaa9df135704f690d4274a30622cbc86c}{molecule}}();}
\DoxyCodeLine{2788     }
\DoxyCodeLine{2789     \textcolor{keywordflow}{if} (originalBasisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a87bdf52af466b6675078a34788641774}{forceCart}})}
\DoxyCodeLine{2790       \mbox{\hyperlink{namespaceChronusQ_afbba655765a7a40e19e2bea928a687c7}{CErr}}(\textcolor{stringliteral}{"{}Libcint + cartesian GTO NYI."{}});}
\DoxyCodeLine{2791     }
\DoxyCodeLine{2792     \mbox{\hyperlink{structChronusQ_1_1BasisSet}{BasisSet}}  basisSet\_ = originalBasisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a04cfa73f279aae9d94a4ee99fd720fa1}{groupGeneralContractionBasis}}();}
\DoxyCodeLine{2793     }
\DoxyCodeLine{2794   }
\DoxyCodeLine{2795     \textcolor{keywordtype}{int} nAtoms      = molecule\_.\mbox{\hyperlink{structChronusQ_1_1Molecule_abe50222c8aa9cb69f03dbab8623ff171}{nAtoms}};}
\DoxyCodeLine{2796     \textcolor{keywordtype}{int} nShells     = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a936871b121472a416ee6f947ccdea4b4}{nShell}};}
\DoxyCodeLine{2797     \textcolor{keywordtype}{size\_t} nBasis   = basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a40ad4a89b440bf71e0ef6ba317d8123f}{nBasis}};}
\DoxyCodeLine{2798   }
\DoxyCodeLine{2799     \textcolor{keywordtype}{size\_t} basisSCRSize = nAtoms * ATM\_SLOTS}
\DoxyCodeLine{2800                          + nShells * BAS\_SLOTS}
\DoxyCodeLine{2801                          + basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_aa66974bc0717a4bdcb09cc61d469ebda}{getLibcintEnvLength}}(molecule\_);}
\DoxyCodeLine{2802   }
\DoxyCodeLine{2803     \textcolor{keywordtype}{size\_t} buffSize = std::max\_element(basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}.begin(),}
\DoxyCodeLine{2804                                        basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a9be2da981037c46350e698aa0c179330}{shells}}.end(),}
\DoxyCodeLine{2805                                        [](libint2::Shell \&a, libint2::Shell \&b) \{}
\DoxyCodeLine{2806                                          return a.size() < b.size();}
\DoxyCodeLine{2807                                        \})-\/>size();}
\DoxyCodeLine{2808     }
\DoxyCodeLine{2809     \textcolor{keywordtype}{int} *atm = memManager\_.template malloc<int>(nAtoms * ATM\_SLOTS);}
\DoxyCodeLine{2810     \textcolor{keywordtype}{int} *bas = memManager\_.template malloc<int>(nShells * BAS\_SLOTS);}
\DoxyCodeLine{2811     \textcolor{keywordtype}{double} *env = memManager\_.template malloc<double>(basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_aa66974bc0717a4bdcb09cc61d469ebda}{getLibcintEnvLength}}(molecule\_));}
\DoxyCodeLine{2812     }
\DoxyCodeLine{2813     basisSet\_.\mbox{\hyperlink{structChronusQ_1_1BasisSet_a0dea80bb1ae5e74a731372d40ebbe43e}{setLibcintEnv}}(molecule\_, atm, bas, env);}
\DoxyCodeLine{2814     }
\DoxyCodeLine{2815     \textcolor{keywordtype}{size\_t} cacheSize = libcintCacheSize(contType, atm, nAtoms, bas, nShells, env);}
\DoxyCodeLine{2816     }
\DoxyCodeLine{2817     memManager\_.free(atm, bas, env);}
\DoxyCodeLine{2818     }
\DoxyCodeLine{2819     \textcolor{keywordtype}{size\_t} buffN4 = buffSize*buffSize*buffSize*buffSize;}
\DoxyCodeLine{2820     }
\DoxyCodeLine{2821     \textcolor{keywordtype}{int} nERI, nERIbuff, nSHZ, mRawMat;}
\DoxyCodeLine{2822     \textcolor{keywordtype}{size\_t} maxShellSize = buffSize;}
\DoxyCodeLine{2823     \textcolor{keywordtype}{size\_t} NB  = maxShellSize*4;}
\DoxyCodeLine{2824     \textcolor{keywordtype}{size\_t} NB4 = NB*NB*NB*NB;}
\DoxyCodeLine{2825     }
\DoxyCodeLine{2826     \textcolor{comment}{// Coulomb Only}}
\DoxyCodeLine{2827     \textcolor{keywordflow}{if} (not computeExchange) \{}
\DoxyCodeLine{2828       \textcolor{keywordflow}{if} (contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba8578053891caf9c4af3c665d73fa43ac}{TWOBODY\_CONTRACTION\_TYPE::BARE\_COULOMB}}) \{}
\DoxyCodeLine{2829         mRawMat = 1;}
\DoxyCodeLine{2830         nERI = 1;}
\DoxyCodeLine{2831         nERIbuff = 0;}
\DoxyCodeLine{2832       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba1d269d4b7d6c561fc04b81a2a178e2a5}{TWOBODY\_CONTRACTION\_TYPE::LLLL}}) \{}
\DoxyCodeLine{2833         mRawMat = 5;}
\DoxyCodeLine{2834         nERI = 9;}
\DoxyCodeLine{2835         nERIbuff = 2*4;}
\DoxyCodeLine{2836       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cbaf5b0f392e82b90ea1452a00512088d53}{TWOBODY\_CONTRACTION\_TYPE::SSSS}}) \{}
\DoxyCodeLine{2837         mRawMat = 4;}
\DoxyCodeLine{2838         nERI = 81;}
\DoxyCodeLine{2839         nERIbuff = 16;}
\DoxyCodeLine{2840       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba619fb0d8a58386d6c365eb7fa1bae867}{TWOBODY\_CONTRACTION\_TYPE::GAUNT}}) \{}
\DoxyCodeLine{2841         mRawMat = 4;}
\DoxyCodeLine{2842         nERI = 9;}
\DoxyCodeLine{2843         nERIbuff = 13;}
\DoxyCodeLine{2844       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba01337b51d63cd7bba6d5daf63ff8d911}{TWOBODY\_CONTRACTION\_TYPE::GAUGE}}) \{}
\DoxyCodeLine{2845         mRawMat = 4;}
\DoxyCodeLine{2846         nERI = 16*2;}
\DoxyCodeLine{2847         nERIbuff = 16;}
\DoxyCodeLine{2848       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2849         std::cout << \textcolor{stringliteral}{"{}contType = "{}} << contType << std::endl;}
\DoxyCodeLine{2850         \mbox{\hyperlink{namespaceChronusQ_afbba655765a7a40e19e2bea928a687c7}{CErr}}(\textcolor{stringliteral}{"{}NYI contType in directRelScaffoldSCRSize"{}}); }
\DoxyCodeLine{2851       \}}
\DoxyCodeLine{2852     \} \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{2853       \mbox{\hyperlink{namespaceChronusQ_afbba655765a7a40e19e2bea928a687c7}{CErr}}(\textcolor{stringliteral}{"{}computeExchange NYI in directRelScaffoldSCRSize"{}}); }
\DoxyCodeLine{2854     \}}
\DoxyCodeLine{2855     \textcolor{comment}{// SCR needed for integrals  }}
\DoxyCodeLine{2856     threadSCRSize += nERI*buffN4 + cacheSize + nERIbuff*NB4; }
\DoxyCodeLine{2857     \textcolor{comment}{// SCR needed for AX, scale 2 for complex }}
\DoxyCodeLine{2858     threadSCRSize += size\_t(\textcolor{keyword}{sizeof}(MatsT)/\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}))*mRawMat*nBasis*nBasis; }
\DoxyCodeLine{2859 }
\DoxyCodeLine{2860     \textcolor{comment}{// SCR needed for Schwarz Screening}}
\DoxyCodeLine{2861 }
\DoxyCodeLine{2862 \textcolor{preprocessor}{\#ifdef \_SHZ\_SCREEN\_4C}}
\DoxyCodeLine{2863     nSHZ = 3; \textcolor{comment}{// 1 for SchwarZERI, 1 for ShBlkNorm, 1 for ShBlkNorm\_raw }}
\DoxyCodeLine{2864     \textcolor{keywordflow}{if} (contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cba1d269d4b7d6c561fc04b81a2a178e2a5}{TWOBODY\_CONTRACTION\_TYPE::LLLL}} or }
\DoxyCodeLine{2865         contType == \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cbad5017ac8c585ad30ff49af6467d2efc6}{TWOBODY\_CONTRACTION\_TYPE::LLSS}}) nSHZ += 1;}
\DoxyCodeLine{2866     }
\DoxyCodeLine{2867     \textcolor{keywordtype}{size\_t} SHZThreadSCRSize  = std::max(nERI*buffN4 + cacheSize, \textcolor{keywordtype}{size\_t}(nShells*nShells));  }
\DoxyCodeLine{2868     \textcolor{keywordtype}{size\_t} SHZGeneralSCRSize = nShells*nShells*nSHZ; }
\DoxyCodeLine{2869     }
\DoxyCodeLine{2870     threadSCRSize   = std::max(threadSCRSize, SHZThreadSCRSize);}
\DoxyCodeLine{2871     generalSCRSize += SHZGeneralSCRSize; }
\DoxyCodeLine{2872 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2873     }
\DoxyCodeLine{2874     \textcolor{comment}{// scale to dcomplex}}
\DoxyCodeLine{2875     \textcolor{comment}{// size\_t scale = size\_t(sizeof(dcomplex)/sizeof(double));}}
\DoxyCodeLine{2876 }
\DoxyCodeLine{2877     \textcolor{keywordflow}{return} (threadSCRSize * \mbox{\hyperlink{namespaceChronusQ_a3320ee560c87921c8d84885db82e9917}{GetNumThreads}}() + generalSCRSize) / 2;}
\DoxyCodeLine{2878   \}}
\DoxyCodeLine{2879 }
\DoxyCodeLine{2880   \textcolor{keyword}{template} <>}
\DoxyCodeLine{2881   \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{classChronusQ_1_1GTODirectRelERIContraction_aa450d1a91fe79be3ae93885d26e2d7ea}{GTODirectRelERIContraction<double,double>::directRelScaffoldLibcintSCRSize}}(}
\DoxyCodeLine{2882     \textcolor{keyword}{const} \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cb}{TWOBODY\_CONTRACTION\_TYPE}} \& contType, \textcolor{keyword}{const} \textcolor{keywordtype}{bool} computeExchange)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{2883     \mbox{\hyperlink{namespaceChronusQ_afbba655765a7a40e19e2bea928a687c7}{CErr}}(\textcolor{stringliteral}{"{}Dirac-\/Coulomb + Real is an invalid option"{}},std::cout);  }
\DoxyCodeLine{2884   \}}
\DoxyCodeLine{2885 }
\DoxyCodeLine{2886   \textcolor{keyword}{template} <>}
\DoxyCodeLine{2887   \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{classChronusQ_1_1GTODirectRelERIContraction_aa450d1a91fe79be3ae93885d26e2d7ea}{GTODirectRelERIContraction<dcomplex,dcomplex>::directRelScaffoldLibcintSCRSize}}(}
\DoxyCodeLine{2888     \textcolor{keyword}{const} \mbox{\hyperlink{namespaceChronusQ_a14bbb7fd8ce60d0c69d4985cd7d9c4cb}{TWOBODY\_CONTRACTION\_TYPE}} \& contType, \textcolor{keyword}{const} \textcolor{keywordtype}{bool} computeExchange)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{2889     \mbox{\hyperlink{namespaceChronusQ_afbba655765a7a40e19e2bea928a687c7}{CErr}}(\textcolor{stringliteral}{"{}Complex  is an invalid option"{}},std::cout);  }
\DoxyCodeLine{2890   \}}
\DoxyCodeLine{2891 }
\DoxyCodeLine{2892 \}; \textcolor{comment}{// namespace ChronusQ}}

\end{DoxyCode}
