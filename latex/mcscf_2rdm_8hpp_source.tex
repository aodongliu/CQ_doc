\hypertarget{mcscf_2rdm_8hpp_source}{}\doxysection{rdm.\+hpp}
\label{mcscf_2rdm_8hpp_source}\index{include/mcscf/rdm.hpp@{include/mcscf/rdm.hpp}}
\mbox{\hyperlink{mcscf_2rdm_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/* }}
\DoxyCodeLine{2 \textcolor{comment}{ *  This file is part of the Chronus Quantum (ChronusQ) software package}}
\DoxyCodeLine{3 \textcolor{comment}{ *  }}
\DoxyCodeLine{4 \textcolor{comment}{ *  Copyright (C) 2014-\/2022 Li Research Group (University of Washington)}}
\DoxyCodeLine{5 \textcolor{comment}{ *  }}
\DoxyCodeLine{6 \textcolor{comment}{ *  This program is free software; you can redistribute it and/or modify}}
\DoxyCodeLine{7 \textcolor{comment}{ *  it under the terms of the GNU General Public License as published by}}
\DoxyCodeLine{8 \textcolor{comment}{ *  the Free Software Foundation; either version 2 of the License, or}}
\DoxyCodeLine{9 \textcolor{comment}{ *  (at your option) any later version.}}
\DoxyCodeLine{10 \textcolor{comment}{ *  }}
\DoxyCodeLine{11 \textcolor{comment}{ *  This program is distributed in the hope that it will be useful,}}
\DoxyCodeLine{12 \textcolor{comment}{ *  but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{13 \textcolor{comment}{ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}}
\DoxyCodeLine{14 \textcolor{comment}{ *  GNU General Public License for more details.}}
\DoxyCodeLine{15 \textcolor{comment}{ *  }}
\DoxyCodeLine{16 \textcolor{comment}{ *  You should have received a copy of the GNU General Public License along}}
\DoxyCodeLine{17 \textcolor{comment}{ *  with this program; if not, write to the Free Software Foundation, Inc.,}}
\DoxyCodeLine{18 \textcolor{comment}{ *  51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301 USA.}}
\DoxyCodeLine{19 \textcolor{comment}{ *  }}
\DoxyCodeLine{20 \textcolor{comment}{ *  Contact the Developers:}}
\DoxyCodeLine{21 \textcolor{comment}{ *    E-\/Mail: xsli@uw.edu}}
\DoxyCodeLine{22 \textcolor{comment}{ *  }}
\DoxyCodeLine{23 \textcolor{comment}{ */}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{mcscf_8hpp}{mcscf.hpp}}>}}
\DoxyCodeLine{27 }
\DoxyCodeLine{28 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceChronusQ}{ChronusQ}} \{}
\DoxyCodeLine{29   }
\DoxyCodeLine{30   \textcolor{keyword}{template} <\textcolor{keyword}{typename} MatsT, \textcolor{keyword}{typename} IntsT>}
\DoxyCodeLine{31   \textcolor{keywordtype}{void} \mbox{\hyperlink{classChronusQ_1_1MCSCF_ad8685976f55a00c4e10ccc41fa2d65ba}{MCSCF<MatsT, IntsT>::computeOneRDM}}(\textcolor{keywordtype}{size\_t} i) \{}
\DoxyCodeLine{32     \mbox{\hyperlink{classChronusQ_1_1MCWaveFunction_aff027a84dd40c741dde8adccdaf1154b}{MCWaveFunction<MatsT, IntsT>::computeOneRDM}}(i);}
\DoxyCodeLine{33     *oneRDMSOI = this-\/>oneRDM[i];}
\DoxyCodeLine{34   \}; \textcolor{comment}{// MCSCF::computeOneRDM(i)}}
\DoxyCodeLine{35   }
\DoxyCodeLine{36   \textcolor{keyword}{template} <\textcolor{keyword}{typename} MatsT, \textcolor{keyword}{typename} IntsT>}
\DoxyCodeLine{37   \textcolor{keywordtype}{void} \mbox{\hyperlink{classChronusQ_1_1MCSCF_ad8685976f55a00c4e10ccc41fa2d65ba}{MCSCF<MatsT,IntsT>::computeOneRDM}}() \{}
\DoxyCodeLine{38 }
\DoxyCodeLine{39     \mbox{\hyperlink{classChronusQ_1_1MCWaveFunction_aff027a84dd40c741dde8adccdaf1154b}{MCWaveFunction<MatsT, IntsT>::computeOneRDM}}();}
\DoxyCodeLine{40     }
\DoxyCodeLine{41     \textcolor{keywordflow}{if} (this-\/>StateAverage) \{}
\DoxyCodeLine{42       }
\DoxyCodeLine{43       \textcolor{keywordtype}{size\_t} nCorrO  = this-\/>MOPartition.nCorrO;}
\DoxyCodeLine{44       \textcolor{keyword}{auto} \& \mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}} = this-\/>SAWeight;}
\DoxyCodeLine{45 }
\DoxyCodeLine{46       oneRDMSOI-\/>clear();}
\DoxyCodeLine{47       }
\DoxyCodeLine{48       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} i = 0ul; i < this-\/>NStates; i++)}
\DoxyCodeLine{49         *oneRDMSOI += \mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}}[i] * this-\/>oneRDM[i];}
\DoxyCodeLine{50     \}    }
\DoxyCodeLine{51 }
\DoxyCodeLine{52   \}; \textcolor{comment}{// MCSCF::computeOneRDM()}}
\DoxyCodeLine{53 }
\DoxyCodeLine{54   \textcolor{keyword}{template} <\textcolor{keyword}{typename} MatsT, \textcolor{keyword}{typename} IntsT>}
\DoxyCodeLine{55   \textcolor{keywordtype}{void} \mbox{\hyperlink{classChronusQ_1_1MCSCF_a30f3da5cf49a552c5b77e253cabb8575}{MCSCF<MatsT, IntsT>::computeTwoRDM}}(\textcolor{keywordtype}{size\_t} i) \{}
\DoxyCodeLine{56     this-\/>ciBuilder-\/>computeTwoRDM(*\textcolor{keyword}{this}, this-\/>CIVecs[i], *twoRDMSOI);}
\DoxyCodeLine{57     }
\DoxyCodeLine{58     \textcolor{keywordtype}{size\_t} nCorrO  = this-\/>MOPartition.nCorrO;}
\DoxyCodeLine{59     \textcolor{keywordflow}{if}(this-\/>detStr-\/>scheme() == \mbox{\hyperlink{namespaceChronusQ_aba77e0ab11cab8be3615e83c7ced29a8aadc11e310fd6ee33ead218fc5ba1ea58}{PRECOMPUTED\_CONFIGURATION\_DRIVEN\_LIST}}) \{}
\DoxyCodeLine{60       \textcolor{keyword}{auto} \& RDM2 = *twoRDMSOI;}
\DoxyCodeLine{61       \textcolor{keyword}{auto} \& RDM1 = *oneRDMSOI;}
\DoxyCodeLine{62 \textcolor{preprocessor}{\#pragma omp parallel for schedule(static) default(shared)       }}
\DoxyCodeLine{63       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} w = 0ul; w < nCorrO; w++)}
\DoxyCodeLine{64       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} u = 0ul; u < nCorrO; u++)}
\DoxyCodeLine{65       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} t = 0ul; t < nCorrO; t++)}
\DoxyCodeLine{66         RDM2(t, u, u, w) -\/= RDM1(t, w);}
\DoxyCodeLine{67     \}}
\DoxyCodeLine{68   \}; \textcolor{comment}{// MCSCF::computeTwoRDM(i)}}
\DoxyCodeLine{69   }
\DoxyCodeLine{70   \textcolor{comment}{// compute state-\/average two RDM}}
\DoxyCodeLine{71   \textcolor{keyword}{template} <\textcolor{keyword}{typename} MatsT, \textcolor{keyword}{typename} IntsT>}
\DoxyCodeLine{72   \textcolor{keywordtype}{void} \mbox{\hyperlink{classChronusQ_1_1MCSCF_a30f3da5cf49a552c5b77e253cabb8575}{MCSCF<MatsT,IntsT>::computeTwoRDM}}() \{}
\DoxyCodeLine{73     }
\DoxyCodeLine{74     \textcolor{keywordtype}{size\_t} nCorrO  = this-\/>MOPartition.nCorrO;}
\DoxyCodeLine{75     \textcolor{keywordtype}{size\_t} nCorrO2 = nCorrO * nCorrO; }
\DoxyCodeLine{76     }
\DoxyCodeLine{77     \textcolor{keywordflow}{if}(this-\/>StateAverage) \{}
\DoxyCodeLine{78       }
\DoxyCodeLine{79       \textcolor{keyword}{auto} twoRDMtmp = \mbox{\hyperlink{classChronusQ_1_1InCore4indexTPI}{InCore4indexTPI<MatsT>}}(this-\/>memManager,nCorrO); }
\DoxyCodeLine{80       \textcolor{keyword}{auto} \& \mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}} = this-\/>SAWeight;}
\DoxyCodeLine{81       twoRDMSOI-\/>clear();}
\DoxyCodeLine{82 }
\DoxyCodeLine{83       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} i = 0ul; i < this-\/>NStates; i++) \{}
\DoxyCodeLine{84         this-\/>ciBuilder-\/>computeTwoRDM(*\textcolor{keyword}{this}, this-\/>CIVecs[i], twoRDMtmp);}
\DoxyCodeLine{85         \mbox{\hyperlink{namespaceChronusQ_ac389ba57a99d66c5b26de24a6a58aebb}{MatAdd}}(\textcolor{charliteral}{'N'}, \textcolor{charliteral}{'N'}, nCorrO2, nCorrO2, }
\DoxyCodeLine{86           MatsT(\mbox{\hyperlink{lebedev__110_8cxx_a025e7807c1d898d829ddfc91a937fc78}{weights}}[i]), twoRDMtmp.pointer(), nCorrO2, }
\DoxyCodeLine{87           MatsT(1.), twoRDMSOI-\/>pointer(), nCorrO2, twoRDMSOI-\/>pointer(), nCorrO2);}
\DoxyCodeLine{88       \}  }
\DoxyCodeLine{89       }
\DoxyCodeLine{90       \textcolor{keywordflow}{if}(this-\/>detStr-\/>scheme() == \mbox{\hyperlink{namespaceChronusQ_aba77e0ab11cab8be3615e83c7ced29a8aadc11e310fd6ee33ead218fc5ba1ea58}{PRECOMPUTED\_CONFIGURATION\_DRIVEN\_LIST}}) \{}
\DoxyCodeLine{91         \textcolor{keyword}{auto} \& RDM2 = *twoRDMSOI;}
\DoxyCodeLine{92         \textcolor{keyword}{auto} \& RDM1 = *oneRDMSOI;}
\DoxyCodeLine{93 \textcolor{preprocessor}{\#pragma omp parallel for schedule(static) default(shared)       }}
\DoxyCodeLine{94         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} w = 0ul; w < nCorrO; w++)}
\DoxyCodeLine{95         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} u = 0ul; u < nCorrO; u++)}
\DoxyCodeLine{96         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} t = 0ul; t < nCorrO; t++)}
\DoxyCodeLine{97           RDM2(t, u, u, w) -\/= RDM1(t, w);}
\DoxyCodeLine{98       \}}
\DoxyCodeLine{99 }
\DoxyCodeLine{100     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{101       \mbox{\hyperlink{namespaceChronusQ_afbba655765a7a40e19e2bea928a687c7}{CErr}}(\textcolor{stringliteral}{"{}Doesn't make sense to compute all two RDM for state specific case"{}});}
\DoxyCodeLine{102     \}}
\DoxyCodeLine{103     }
\DoxyCodeLine{104   \};  \textcolor{comment}{// MCSCF::computeTwoRDM     }}
\DoxyCodeLine{105 }
\DoxyCodeLine{106 \}; \textcolor{comment}{// namespace ChronusQ}}

\end{DoxyCode}
