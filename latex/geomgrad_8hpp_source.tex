\hypertarget{geomgrad_8hpp_source}{}\doxysection{geomgrad.\+hpp}
\label{geomgrad_8hpp_source}\index{include/findiff/geomgrad.hpp@{include/findiff/geomgrad.hpp}}
\mbox{\hyperlink{geomgrad_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/* }}
\DoxyCodeLine{2 \textcolor{comment}{ *  This file is part of the Chronus Quantum (ChronusQ) software package}}
\DoxyCodeLine{3 \textcolor{comment}{ *  }}
\DoxyCodeLine{4 \textcolor{comment}{ *  Copyright (C) 2014-\/2022 Li Research Group (University of Washington)}}
\DoxyCodeLine{5 \textcolor{comment}{ *  }}
\DoxyCodeLine{6 \textcolor{comment}{ *  This program is free software; you can redistribute it and/or modify}}
\DoxyCodeLine{7 \textcolor{comment}{ *  it under the terms of the GNU General Public License as published by}}
\DoxyCodeLine{8 \textcolor{comment}{ *  the Free Software Foundation; either version 2 of the License, or}}
\DoxyCodeLine{9 \textcolor{comment}{ *  (at your option) any later version.}}
\DoxyCodeLine{10 \textcolor{comment}{ *  }}
\DoxyCodeLine{11 \textcolor{comment}{ *  This program is distributed in the hope that it will be useful,}}
\DoxyCodeLine{12 \textcolor{comment}{ *  but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{13 \textcolor{comment}{ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}}
\DoxyCodeLine{14 \textcolor{comment}{ *  GNU General Public License for more details.}}
\DoxyCodeLine{15 \textcolor{comment}{ *  }}
\DoxyCodeLine{16 \textcolor{comment}{ *  You should have received a copy of the GNU General Public License along}}
\DoxyCodeLine{17 \textcolor{comment}{ *  with this program; if not, write to the Free Software Foundation, Inc.,}}
\DoxyCodeLine{18 \textcolor{comment}{ *  51 Franklin Street, Fifth Floor, Boston, MA 02110-\/1301 USA.}}
\DoxyCodeLine{19 \textcolor{comment}{ *  }}
\DoxyCodeLine{20 \textcolor{comment}{ *  Contact the Developers:}}
\DoxyCodeLine{21 \textcolor{comment}{ *    E-\/Mail: xsli@uw.edu}}
\DoxyCodeLine{22 \textcolor{comment}{ *  }}
\DoxyCodeLine{23 \textcolor{comment}{ */}}
\DoxyCodeLine{24 }
\DoxyCodeLine{25 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{findiff_8hpp}{findiff.hpp}}>}}
\DoxyCodeLine{28 \textcolor{preprocessor}{\#include <singleslater.hpp>}}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{integrator_8hpp}{grid/integrator.hpp}}>}}
\DoxyCodeLine{30 }
\DoxyCodeLine{31 }
\DoxyCodeLine{32 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceChronusQ}{ChronusQ}} \{}
\DoxyCodeLine{33 }
\DoxyCodeLine{34   \textcolor{keyword}{class }\mbox{\hyperlink{classChronusQ_1_1NumGradient}{NumGradient}} \{}
\DoxyCodeLine{35  }
\DoxyCodeLine{36     \mbox{\hyperlink{classChronusQ_1_1CQInputFile}{CQInputFile}}\& \mbox{\hyperlink{classChronusQ_1_1NumGradient_a3dd56205cd5c4ae87f7460c9cf89e625}{input\_}};}
\DoxyCodeLine{37     std::shared\_ptr<SingleSlaterBase>\& \mbox{\hyperlink{classChronusQ_1_1NumGradient_aa8b34b35917b55ff4b2c135703cf4d8c}{ref\_}};}
\DoxyCodeLine{38     std::shared\_ptr<SingleSlaterBase> \mbox{\hyperlink{classChronusQ_1_1NumGradient_afa6f6997ab9083dfe4148693e5ea9579}{curr\_}};}
\DoxyCodeLine{39     \mbox{\hyperlink{structChronusQ_1_1EMPerturbation}{EMPerturbation}} \mbox{\hyperlink{classChronusQ_1_1NumGradient_ace56a60f1468cf583c910ac5597910ff}{emPert}};}
\DoxyCodeLine{40     std::shared\_ptr<IntegralsBase> \mbox{\hyperlink{classChronusQ_1_1NumGradient_a7787fda48d0c4fb5d58f5c6bb7cae765}{aoints}};}
\DoxyCodeLine{41     \mbox{\hyperlink{structChronusQ_1_1Molecule}{Molecule}} \mbox{\hyperlink{classChronusQ_1_1NumGradient_a6ec89a58bfe0159022722bf778b5d9c9}{mol}};}
\DoxyCodeLine{42     std::shared\_ptr<BasisSet> \mbox{\hyperlink{classChronusQ_1_1NumGradient_a4a87e39b5cf3568d0df1e1e664734ab1}{basis}};}
\DoxyCodeLine{43     std::shared\_ptr<BasisSet> \mbox{\hyperlink{classChronusQ_1_1NumGradient_af085fd2c2e6afd81db3a49dcd7526599}{dfbasis}};}
\DoxyCodeLine{44     std::shared\_ptr<BasisSet> \mbox{\hyperlink{classChronusQ_1_1NumGradient_a3d7bc5d4ad8cb72955170ecc2cf71431}{prot\_basis}};}
\DoxyCodeLine{45     }
\DoxyCodeLine{46     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{classChronusQ_1_1NumGradient_ac1ce40ac405c21efc16a25023f576e38}{nAtoms}};}
\DoxyCodeLine{47 }
\DoxyCodeLine{48     \textcolor{keyword}{template} <\textcolor{keyword}{typename} MatsT, \textcolor{keyword}{typename} IntsT>}
\DoxyCodeLine{49     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classChronusQ_1_1NumGradient_a0a7e95d29051816de19d2d4274b97d67}{goodType}}() \{}
\DoxyCodeLine{50       \textcolor{keywordflow}{return} \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classChronusQ_1_1SingleSlater}{SingleSlater<MatsT,IntsT>}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classChronusQ_1_1NumGradient_aa8b34b35917b55ff4b2c135703cf4d8c}{ref\_}}.get()) != \textcolor{keyword}{nullptr};}
\DoxyCodeLine{51     \};}
\DoxyCodeLine{52 }
\DoxyCodeLine{53     \textcolor{comment}{// Movement methods (see src/findiff/geomgrad.cxx for details)}}
\DoxyCodeLine{54     \textcolor{keyword}{template} <\textcolor{keyword}{typename} MatsT, \textcolor{keyword}{typename} IntsT>}
\DoxyCodeLine{55     \textcolor{keywordtype}{void} \mbox{\hyperlink{classChronusQ_1_1NumGradient_acdc9c25140c07fc50e18e65b6488ab64}{moveMol}}(\textcolor{keywordtype}{size\_t} iAtm, \textcolor{keywordtype}{size\_t} iXYZ, \textcolor{keywordtype}{double} diff);}
\DoxyCodeLine{56 }
\DoxyCodeLine{57     \textcolor{comment}{// Properties to get (bound to valFunc for the finite differencer)}}
\DoxyCodeLine{58     \textcolor{comment}{//   (see src/findiff/geomgrad.cxx for details)}}
\DoxyCodeLine{59     std::vector<double> \mbox{\hyperlink{classChronusQ_1_1NumGradient_a28c24bcb12038551449a2e029f878fea}{getEnergies}}();}
\DoxyCodeLine{60     std::vector<double> \mbox{\hyperlink{classChronusQ_1_1NumGradient_a4fe1508be589222679ae5f0dca082e0b}{getGridVals}}(\textcolor{keywordtype}{bool} \mbox{\hyperlink{classChronusQ_1_1NumGradient_a65fd72136893f86a76030dfdfaf51eec}{doGrad}}, \textcolor{keywordtype}{size\_t} iA, \textcolor{keywordtype}{size\_t} iXYZ);}
\DoxyCodeLine{61 }
\DoxyCodeLine{62     \textcolor{keyword}{template}<\textcolor{keyword}{typename} IntsT>}
\DoxyCodeLine{63     std::vector<IntsT> \mbox{\hyperlink{classChronusQ_1_1NumGradient_a3fc77bcccfa5d365092b15c3b0a215d0}{getOneEInts}}();}
\DoxyCodeLine{64 }
\DoxyCodeLine{65     \textcolor{keyword}{template}<\textcolor{keyword}{typename} IntsT>}
\DoxyCodeLine{66     std::vector<IntsT> \mbox{\hyperlink{classChronusQ_1_1NumGradient_acfa0eadad4f9cb26dacdbaafb9db3cce}{getERI}}();}
\DoxyCodeLine{67 }
\DoxyCodeLine{68     \textcolor{keyword}{public}:}
\DoxyCodeLine{69 }
\DoxyCodeLine{70     \mbox{\hyperlink{classChronusQ_1_1NumGradient_ac19a9b1699ea4703fdfcffb2e5a2dd0e}{NumGradient}}() = \textcolor{keyword}{delete};}
\DoxyCodeLine{71 }
\DoxyCodeLine{72     \mbox{\hyperlink{classChronusQ_1_1NumGradient_ae7f683557b32fd25eda9546c67515375}{NumGradient}}(\mbox{\hyperlink{classChronusQ_1_1CQInputFile}{CQInputFile}}\& in, std::shared\_ptr<SingleSlaterBase>\& ss, std::shared\_ptr<BasisSet> b) :}
\DoxyCodeLine{73       \mbox{\hyperlink{classChronusQ_1_1NumGradient_a3dd56205cd5c4ae87f7460c9cf89e625}{input\_}}(in), \mbox{\hyperlink{classChronusQ_1_1NumGradient_aa8b34b35917b55ff4b2c135703cf4d8c}{ref\_}}(ss), \mbox{\hyperlink{classChronusQ_1_1NumGradient_a4a87e39b5cf3568d0df1e1e664734ab1}{basis}}(b) \{}
\DoxyCodeLine{74       }
\DoxyCodeLine{75       \textcolor{keywordflow}{if} ( goodType<dcomplex,dcomplex>() )}
\DoxyCodeLine{76         \mbox{\hyperlink{classChronusQ_1_1NumGradient_ac1ce40ac405c21efc16a25023f576e38}{nAtoms}} = std::dynamic\_pointer\_cast<SingleSlater<dcomplex,dcomplex>>(\mbox{\hyperlink{classChronusQ_1_1NumGradient_aa8b34b35917b55ff4b2c135703cf4d8c}{ref\_}})-\/>molecule().nAtoms;}
\DoxyCodeLine{77       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( goodType<dcomplex,double>() )}
\DoxyCodeLine{78         \mbox{\hyperlink{classChronusQ_1_1NumGradient_ac1ce40ac405c21efc16a25023f576e38}{nAtoms}} = std::dynamic\_pointer\_cast<\mbox{\hyperlink{classChronusQ_1_1SingleSlater}{SingleSlater<dcomplex,double>}}>(\mbox{\hyperlink{classChronusQ_1_1NumGradient_aa8b34b35917b55ff4b2c135703cf4d8c}{ref\_}})-\/>\mbox{\hyperlink{classChronusQ_1_1WaveFunctionBase_a5f29f9a842c2d47c458e1388abb94874}{molecule}}().\mbox{\hyperlink{structChronusQ_1_1Molecule_abe50222c8aa9cb69f03dbab8623ff171}{nAtoms}};}
\DoxyCodeLine{79       \textcolor{keywordflow}{else}}
\DoxyCodeLine{80         \mbox{\hyperlink{classChronusQ_1_1NumGradient_ac1ce40ac405c21efc16a25023f576e38}{nAtoms}} = std::dynamic\_pointer\_cast<SingleSlater<double,double>>(\mbox{\hyperlink{classChronusQ_1_1NumGradient_aa8b34b35917b55ff4b2c135703cf4d8c}{ref\_}})-\/>molecule().nAtoms;}
\DoxyCodeLine{81 }
\DoxyCodeLine{82     \};}
\DoxyCodeLine{83 }
\DoxyCodeLine{84     \mbox{\hyperlink{classChronusQ_1_1NumGradient_aa3a06171ed3f0b554a7952877786d387}{NumGradient}}(\textcolor{keyword}{const} \mbox{\hyperlink{classChronusQ_1_1NumGradient}{NumGradient}}\&) = \textcolor{keywordflow}{default};}
\DoxyCodeLine{85     \mbox{\hyperlink{classChronusQ_1_1NumGradient_a7a95383c653882fbbb1b10e5f7eb042e}{NumGradient}}(\mbox{\hyperlink{classChronusQ_1_1NumGradient}{NumGradient}}\&\&) = \textcolor{keywordflow}{default};}
\DoxyCodeLine{86 }
\DoxyCodeLine{87     \textcolor{keywordtype}{void} \mbox{\hyperlink{classChronusQ_1_1NumGradient_a65fd72136893f86a76030dfdfaf51eec}{doGrad}}(\textcolor{keywordtype}{size\_t} acc = 2) \{}
\DoxyCodeLine{88 }
\DoxyCodeLine{89       \mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer}{FiniteDifferencer<double,double>}} diff;}
\DoxyCodeLine{90 }
\DoxyCodeLine{91       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a9e2764d68a0a40c58bee84283f2c883f}{setDerOrder}}(1);}
\DoxyCodeLine{92       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_ac0cf766e3e1e2f8c44fbe1a31f7a2052}{setAccOrder}}(acc);}
\DoxyCodeLine{93 }
\DoxyCodeLine{94       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a0074c48a43e395347b464c409cd7b3fa}{setStepSize}}(1e-\/2);}
\DoxyCodeLine{95 }
\DoxyCodeLine{96       }
\DoxyCodeLine{97       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a588de6638ba7481bdaa6b49fc03ff0f3}{setValFunc}}(std::bind(\&\mbox{\hyperlink{classChronusQ_1_1NumGradient_a28c24bcb12038551449a2e029f878fea}{NumGradient::getEnergies}}, \textcolor{keyword}{this}));}
\DoxyCodeLine{98 }
\DoxyCodeLine{99       \textcolor{keywordtype}{bool} cInt = goodType<dcomplex,dcomplex>();}
\DoxyCodeLine{100       \textcolor{keywordtype}{bool} cMat = cInt or goodType<dcomplex,double>();}
\DoxyCodeLine{101 }
\DoxyCodeLine{102       \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} iAtm = 0; iAtm < \mbox{\hyperlink{classChronusQ_1_1NumGradient_ac1ce40ac405c21efc16a25023f576e38}{nAtoms}}; iAtm++ ) \{}
\DoxyCodeLine{103         \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} iXYZ = 0; iXYZ < 3; iXYZ++ ) \{}
\DoxyCodeLine{104 }
\DoxyCodeLine{105           \textcolor{keywordflow}{if}(cInt)}
\DoxyCodeLine{106             diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_ac7e1c5c79bbcd651f2e9f5fd10feab32}{addChangeFunc}}(}
\DoxyCodeLine{107               std::bind(\&NumGradient::moveMol<dcomplex,dcomplex>, \textcolor{keyword}{this},}
\DoxyCodeLine{108                         iAtm, iXYZ, std::placeholders::\_1));}
\DoxyCodeLine{109 }
\DoxyCodeLine{110           \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(cMat)}
\DoxyCodeLine{111             diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_ac7e1c5c79bbcd651f2e9f5fd10feab32}{addChangeFunc}}(}
\DoxyCodeLine{112               std::bind(\&NumGradient::moveMol<dcomplex,double>, \textcolor{keyword}{this},}
\DoxyCodeLine{113                         iAtm, iXYZ, std::placeholders::\_1));}
\DoxyCodeLine{114 }
\DoxyCodeLine{115           \textcolor{keywordflow}{else}}
\DoxyCodeLine{116             diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_ac7e1c5c79bbcd651f2e9f5fd10feab32}{addChangeFunc}}(}
\DoxyCodeLine{117               std::bind(\&NumGradient::moveMol<double,double>, \textcolor{keyword}{this},}
\DoxyCodeLine{118                         iAtm, iXYZ, std::placeholders::\_1));}
\DoxyCodeLine{119 }
\DoxyCodeLine{120         \}}
\DoxyCodeLine{121       \}}
\DoxyCodeLine{122 }
\DoxyCodeLine{123       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a6cb398b26e3ef975492b158585ed3d6e}{doDifference}}();}
\DoxyCodeLine{124 }
\DoxyCodeLine{125       \textcolor{keyword}{auto} res = diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a8e02f017b1230a8f97c15acb5cc8c6bd}{getResults}}();}
\DoxyCodeLine{126 }
\DoxyCodeLine{127       \mbox{\hyperlink{classChronusQ_1_1NumGradient_a910c14662f12cad8012c0ae586f61ea1}{printResults}}(\textcolor{stringliteral}{"{}Nuclear Gradient (Eh / Bohr)"{}}, res, 0, 1e-\/12);}
\DoxyCodeLine{128       \mbox{\hyperlink{classChronusQ_1_1NumGradient_a910c14662f12cad8012c0ae586f61ea1}{printResults}}(\textcolor{stringliteral}{"{}OneE Gradient (Eh / Bohr)"{}}, res, 1);}
\DoxyCodeLine{129       \mbox{\hyperlink{classChronusQ_1_1NumGradient_a910c14662f12cad8012c0ae586f61ea1}{printResults}}(\textcolor{stringliteral}{"{}TwoE Gradient (Eh / Bohr)"{}}, res, 2);}
\DoxyCodeLine{130       \mbox{\hyperlink{classChronusQ_1_1NumGradient_a910c14662f12cad8012c0ae586f61ea1}{printResults}}(\textcolor{stringliteral}{"{}NucRep Gradient (Eh / Bohr)"{}}, res, 3);}
\DoxyCodeLine{131       \textcolor{keywordflow}{if} (res.size() > 4)}
\DoxyCodeLine{132         \mbox{\hyperlink{classChronusQ_1_1NumGradient_a910c14662f12cad8012c0ae586f61ea1}{printResults}}(\textcolor{stringliteral}{"{}XC Gradient (Eh / Bohr)"{}}, res, 4);}
\DoxyCodeLine{133 }
\DoxyCodeLine{134     \};}
\DoxyCodeLine{135 }
\DoxyCodeLine{136     \textcolor{keywordtype}{void} \mbox{\hyperlink{classChronusQ_1_1NumGradient_a8d4cdec949e08ccae3a0bac0d2baddb7}{gridGrad}}(\textcolor{keywordtype}{size\_t} acc = 2) \{}
\DoxyCodeLine{137       }
\DoxyCodeLine{138       \mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer}{FiniteDifferencer<double,double>}} diff;}
\DoxyCodeLine{139 }
\DoxyCodeLine{140       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a9e2764d68a0a40c58bee84283f2c883f}{setDerOrder}}(1);}
\DoxyCodeLine{141       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_ac0cf766e3e1e2f8c44fbe1a31f7a2052}{setAccOrder}}(acc);}
\DoxyCodeLine{142 }
\DoxyCodeLine{143       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a0074c48a43e395347b464c409cd7b3fa}{setStepSize}}(1e-\/4);}
\DoxyCodeLine{144 }
\DoxyCodeLine{145       }
\DoxyCodeLine{146       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a588de6638ba7481bdaa6b49fc03ff0f3}{setValFunc}}(std::bind(\&\mbox{\hyperlink{classChronusQ_1_1NumGradient_a4fe1508be589222679ae5f0dca082e0b}{NumGradient::getGridVals}}, \textcolor{keyword}{this}, \textcolor{keyword}{false}, 0, 0));}
\DoxyCodeLine{147 }
\DoxyCodeLine{148       \textcolor{keywordtype}{bool} cInt = goodType<dcomplex,dcomplex>();}
\DoxyCodeLine{149       \textcolor{keywordtype}{bool} cMat = cInt or goodType<dcomplex,double>();}
\DoxyCodeLine{150 }
\DoxyCodeLine{151       \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} iAtm = 0; iAtm < \mbox{\hyperlink{classChronusQ_1_1NumGradient_ac1ce40ac405c21efc16a25023f576e38}{nAtoms}}; iAtm++ ) \{}
\DoxyCodeLine{152         \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} iXYZ = 0; iXYZ < 3; iXYZ++ ) \{}
\DoxyCodeLine{153 }
\DoxyCodeLine{154           \textcolor{keywordflow}{if}(cInt)}
\DoxyCodeLine{155             diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_ac7e1c5c79bbcd651f2e9f5fd10feab32}{addChangeFunc}}(}
\DoxyCodeLine{156               std::bind(\&NumGradient::moveMol<dcomplex,dcomplex>, \textcolor{keyword}{this},}
\DoxyCodeLine{157                         iAtm, iXYZ, std::placeholders::\_1));}
\DoxyCodeLine{158 }
\DoxyCodeLine{159           \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(cMat)}
\DoxyCodeLine{160             diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_ac7e1c5c79bbcd651f2e9f5fd10feab32}{addChangeFunc}}(}
\DoxyCodeLine{161               std::bind(\&NumGradient::moveMol<dcomplex,double>, \textcolor{keyword}{this},}
\DoxyCodeLine{162                         iAtm, iXYZ, std::placeholders::\_1));}
\DoxyCodeLine{163 }
\DoxyCodeLine{164           \textcolor{keywordflow}{else}}
\DoxyCodeLine{165             diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_ac7e1c5c79bbcd651f2e9f5fd10feab32}{addChangeFunc}}(}
\DoxyCodeLine{166               std::bind(\&NumGradient::moveMol<double,double>, \textcolor{keyword}{this},}
\DoxyCodeLine{167                         iAtm, iXYZ, std::placeholders::\_1));}
\DoxyCodeLine{168 }
\DoxyCodeLine{169         \}}
\DoxyCodeLine{170       \}}
\DoxyCodeLine{171 }
\DoxyCodeLine{172       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a6cb398b26e3ef975492b158585ed3d6e}{doDifference}}();}
\DoxyCodeLine{173 }
\DoxyCodeLine{174       \textcolor{keyword}{auto} res = diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a8e02f017b1230a8f97c15acb5cc8c6bd}{getResults}}();}
\DoxyCodeLine{175 }
\DoxyCodeLine{176       moveMol<double,double>(0, 0, 0.);}
\DoxyCodeLine{177 }
\DoxyCodeLine{178       \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} iAtom = 0; iAtom < \mbox{\hyperlink{classChronusQ_1_1NumGradient_ac1ce40ac405c21efc16a25023f576e38}{nAtoms}}; iAtom++ ) \{}
\DoxyCodeLine{179         \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} iXYZ = 0; iXYZ < 3; iXYZ++ ) \{}
\DoxyCodeLine{180           std::cout << \textcolor{stringliteral}{"{}=== Weight Gradients ["{}} << iAtom << \textcolor{stringliteral}{"{},"{}} << iXYZ << \textcolor{stringliteral}{"{}]\(\backslash\)n"{}};}
\DoxyCodeLine{181 }
\DoxyCodeLine{182           \textcolor{keyword}{auto} anaRes = \mbox{\hyperlink{classChronusQ_1_1NumGradient_a4fe1508be589222679ae5f0dca082e0b}{getGridVals}}(\textcolor{keyword}{true}, iAtom, iXYZ);}
\DoxyCodeLine{183 }
\DoxyCodeLine{184           \textcolor{keywordtype}{bool} allgood = \textcolor{keyword}{true};}
\DoxyCodeLine{185 }
\DoxyCodeLine{186           \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} i = 0; i < anaRes.size(); i++ ) \{}
\DoxyCodeLine{187             \textcolor{keywordflow}{if} ( std::max( res[iAtom*3 + iXYZ][i], anaRes[i] ) < 1e-\/12 )}
\DoxyCodeLine{188               \textcolor{keywordflow}{continue};}
\DoxyCodeLine{189             \textcolor{keywordflow}{if} ( std::abs( res[iAtom*3 + iXYZ][i] -\/ anaRes[i] ) / anaRes[i] > 1e-\/8 ) \{}
\DoxyCodeLine{190               std::cout << \textcolor{stringliteral}{"{}  "{}} << res[iAtom*3 + iXYZ][i];}
\DoxyCodeLine{191               std::cout << \textcolor{stringliteral}{"{}  "{}} << anaRes[i];}
\DoxyCodeLine{192               std::cout << \textcolor{stringliteral}{"{}  "{}} << (res[iAtom*3 + iXYZ][i] -\/ anaRes[i])/anaRes[i];}
\DoxyCodeLine{193               std::cout << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{194               allgood = \textcolor{keyword}{false};}
\DoxyCodeLine{195             \}}
\DoxyCodeLine{196           \}}
\DoxyCodeLine{197 }
\DoxyCodeLine{198           \textcolor{keywordflow}{if} (allgood)}
\DoxyCodeLine{199             std::cout << \textcolor{stringliteral}{"{}All good\(\backslash\)n"{}};}
\DoxyCodeLine{200           std::cout << std::endl;}
\DoxyCodeLine{201         \}}
\DoxyCodeLine{202       \}}
\DoxyCodeLine{203 }
\DoxyCodeLine{204     \};}
\DoxyCodeLine{205 }
\DoxyCodeLine{206     \textcolor{keyword}{template} <\textcolor{keyword}{typename} IntsT>}
\DoxyCodeLine{207     \textcolor{keywordtype}{void} \mbox{\hyperlink{classChronusQ_1_1NumGradient_a43aebb8ff651a610dde5cff708c67f95}{intGrad}}(\textcolor{keywordtype}{size\_t} acc = 2) \{}
\DoxyCodeLine{208 }
\DoxyCodeLine{209       \mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer}{FiniteDifferencer<double,IntsT>}} diff;}
\DoxyCodeLine{210 }
\DoxyCodeLine{211       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a9e2764d68a0a40c58bee84283f2c883f}{setDerOrder}}(1);}
\DoxyCodeLine{212       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_ac0cf766e3e1e2f8c44fbe1a31f7a2052}{setAccOrder}}(acc);}
\DoxyCodeLine{213 }
\DoxyCodeLine{214       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a0074c48a43e395347b464c409cd7b3fa}{setStepSize}}(1e-\/3);}
\DoxyCodeLine{215 }
\DoxyCodeLine{216       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a588de6638ba7481bdaa6b49fc03ff0f3}{setValFunc}}(std::bind(\&NumGradient::getOneEInts<IntsT>, \textcolor{keyword}{this}));}
\DoxyCodeLine{217 }
\DoxyCodeLine{218       \textcolor{keywordtype}{bool} cInt = goodType<dcomplex,dcomplex>();}
\DoxyCodeLine{219       \textcolor{keywordtype}{bool} cMat = cInt or goodType<dcomplex,double>();}
\DoxyCodeLine{220 }
\DoxyCodeLine{221       \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} iAtm = 0; iAtm < \mbox{\hyperlink{classChronusQ_1_1NumGradient_ac1ce40ac405c21efc16a25023f576e38}{nAtoms}}; iAtm++ ) \{}
\DoxyCodeLine{222         \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} iXYZ = 0; iXYZ < 3; iXYZ++ ) \{}
\DoxyCodeLine{223 }
\DoxyCodeLine{224           \textcolor{keywordflow}{if}(cInt)}
\DoxyCodeLine{225             diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_ac7e1c5c79bbcd651f2e9f5fd10feab32}{addChangeFunc}}(}
\DoxyCodeLine{226               std::bind(\&NumGradient::moveMol<dcomplex,dcomplex>, \textcolor{keyword}{this},}
\DoxyCodeLine{227                         iAtm, iXYZ, std::placeholders::\_1));}
\DoxyCodeLine{228 }
\DoxyCodeLine{229           \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(cMat)}
\DoxyCodeLine{230             diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_ac7e1c5c79bbcd651f2e9f5fd10feab32}{addChangeFunc}}(}
\DoxyCodeLine{231               std::bind(\&NumGradient::moveMol<dcomplex,double>, \textcolor{keyword}{this},}
\DoxyCodeLine{232                         iAtm, iXYZ, std::placeholders::\_1));}
\DoxyCodeLine{233 }
\DoxyCodeLine{234           \textcolor{keywordflow}{else}}
\DoxyCodeLine{235             diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_ac7e1c5c79bbcd651f2e9f5fd10feab32}{addChangeFunc}}(}
\DoxyCodeLine{236               std::bind(\&NumGradient::moveMol<double,double>, \textcolor{keyword}{this},}
\DoxyCodeLine{237                         iAtm, iXYZ, std::placeholders::\_1));}
\DoxyCodeLine{238 }
\DoxyCodeLine{239         \}}
\DoxyCodeLine{240       \}}
\DoxyCodeLine{241 }
\DoxyCodeLine{242       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a6cb398b26e3ef975492b158585ed3d6e}{doDifference}}();}
\DoxyCodeLine{243 }
\DoxyCodeLine{244       \textcolor{keyword}{auto} res = diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a8e02f017b1230a8f97c15acb5cc8c6bd}{getResults}}();}
\DoxyCodeLine{245 }
\DoxyCodeLine{246       std::vector<std::string> names = \{\textcolor{stringliteral}{"{}Numerical Overlap Gradient"{}},}
\DoxyCodeLine{247                                         \textcolor{stringliteral}{"{}Numerical Kinetic Gradient"{}},}
\DoxyCodeLine{248                                         \textcolor{stringliteral}{"{}Numerical Potential Gradient"{}}\};}
\DoxyCodeLine{249 }
\DoxyCodeLine{250       \textcolor{keyword}{auto} NB = \mbox{\hyperlink{classChronusQ_1_1NumGradient_a4a87e39b5cf3568d0df1e1e664734ab1}{basis}}-\/>nBasis;}
\DoxyCodeLine{251 }
\DoxyCodeLine{252       std::cout << \textcolor{stringliteral}{"{} ===  Integral Numerical Gradients  === "{}} << std::endl;}
\DoxyCodeLine{253       \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} iOp = 0; iOp < 3; iOp++ )}
\DoxyCodeLine{254       \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} iAtom = 0; iAtom < \mbox{\hyperlink{classChronusQ_1_1NumGradient_ac1ce40ac405c21efc16a25023f576e38}{nAtoms}}; iAtom++ ) \{}
\DoxyCodeLine{255 }
\DoxyCodeLine{256         \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} iXYZ = 0; iXYZ < 3; iXYZ++ ) \{}
\DoxyCodeLine{257 }
\DoxyCodeLine{258           std::cout << \textcolor{stringliteral}{"{}Atom: "{}} << std::setw(8) << std::left << iAtom;}
\DoxyCodeLine{259           std::cout << \textcolor{stringliteral}{"{}Cart: "{}} << std::setw(8) << std::left << iXYZ;}
\DoxyCodeLine{260           std::cout << std::endl;}
\DoxyCodeLine{261 }
\DoxyCodeLine{262           \mbox{\hyperlink{namespaceChronusQ_a43999d7848dab8e641410257f6bc0321}{prettyPrintSmart}}(std::cout, names[iOp],}
\DoxyCodeLine{263                            res[iAtom*3 + iXYZ].data() + iOp*NB*NB,}
\DoxyCodeLine{264                            NB, NB, NB);}
\DoxyCodeLine{265         \}}
\DoxyCodeLine{266       \}}
\DoxyCodeLine{267       std::cout << \textcolor{stringliteral}{"{} ====================================== "{}} << std::endl;}
\DoxyCodeLine{268 }
\DoxyCodeLine{269     \};}
\DoxyCodeLine{270 }
\DoxyCodeLine{271     \textcolor{keyword}{template} <\textcolor{keyword}{typename} IntsT>}
\DoxyCodeLine{272     \textcolor{keywordtype}{void} \mbox{\hyperlink{classChronusQ_1_1NumGradient_a7db2459f6ba20b135da9c96357e9ca9b}{eriGrad}}(\textcolor{keywordtype}{size\_t} acc = 2) \{}
\DoxyCodeLine{273 }
\DoxyCodeLine{274       \mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer}{FiniteDifferencer<double,IntsT>}} diff;}
\DoxyCodeLine{275 }
\DoxyCodeLine{276       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a9e2764d68a0a40c58bee84283f2c883f}{setDerOrder}}(1);}
\DoxyCodeLine{277       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_ac0cf766e3e1e2f8c44fbe1a31f7a2052}{setAccOrder}}(acc);}
\DoxyCodeLine{278 }
\DoxyCodeLine{279       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a0074c48a43e395347b464c409cd7b3fa}{setStepSize}}(1e-\/3);}
\DoxyCodeLine{280 }
\DoxyCodeLine{281       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a588de6638ba7481bdaa6b49fc03ff0f3}{setValFunc}}(std::bind(\&NumGradient::getERI<IntsT>, \textcolor{keyword}{this}));}
\DoxyCodeLine{282 }
\DoxyCodeLine{283       \textcolor{keywordtype}{bool} cInt = goodType<dcomplex,dcomplex>();}
\DoxyCodeLine{284       \textcolor{keywordtype}{bool} cMat = cInt or goodType<dcomplex,double>();}
\DoxyCodeLine{285 }
\DoxyCodeLine{286       \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} iAtm = 0; iAtm < \mbox{\hyperlink{classChronusQ_1_1NumGradient_ac1ce40ac405c21efc16a25023f576e38}{nAtoms}}; iAtm++ ) \{}
\DoxyCodeLine{287         \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} iXYZ = 0; iXYZ < 3; iXYZ++ ) \{}
\DoxyCodeLine{288 }
\DoxyCodeLine{289           \textcolor{keywordflow}{if}(cInt)}
\DoxyCodeLine{290             diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_ac7e1c5c79bbcd651f2e9f5fd10feab32}{addChangeFunc}}(}
\DoxyCodeLine{291               std::bind(\&NumGradient::moveMol<dcomplex,dcomplex>, \textcolor{keyword}{this},}
\DoxyCodeLine{292                         iAtm, iXYZ, std::placeholders::\_1));}
\DoxyCodeLine{293 }
\DoxyCodeLine{294           \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(cMat)}
\DoxyCodeLine{295             diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_ac7e1c5c79bbcd651f2e9f5fd10feab32}{addChangeFunc}}(}
\DoxyCodeLine{296               std::bind(\&NumGradient::moveMol<dcomplex,double>, \textcolor{keyword}{this},}
\DoxyCodeLine{297                         iAtm, iXYZ, std::placeholders::\_1));}
\DoxyCodeLine{298 }
\DoxyCodeLine{299           \textcolor{keywordflow}{else}}
\DoxyCodeLine{300             diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_ac7e1c5c79bbcd651f2e9f5fd10feab32}{addChangeFunc}}(}
\DoxyCodeLine{301               std::bind(\&NumGradient::moveMol<double,double>, \textcolor{keyword}{this},}
\DoxyCodeLine{302                         iAtm, iXYZ, std::placeholders::\_1));}
\DoxyCodeLine{303 }
\DoxyCodeLine{304         \}}
\DoxyCodeLine{305       \}}
\DoxyCodeLine{306 }
\DoxyCodeLine{307       diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a6cb398b26e3ef975492b158585ed3d6e}{doDifference}}();}
\DoxyCodeLine{308 }
\DoxyCodeLine{309       \textcolor{keyword}{auto} res = diff.\mbox{\hyperlink{classChronusQ_1_1FiniteDifferencer_a8e02f017b1230a8f97c15acb5cc8c6bd}{getResults}}();}
\DoxyCodeLine{310 }
\DoxyCodeLine{311       \textcolor{keyword}{auto} NB = \mbox{\hyperlink{classChronusQ_1_1NumGradient_a4a87e39b5cf3568d0df1e1e664734ab1}{basis}}-\/>nBasis;}
\DoxyCodeLine{312       \textcolor{keyword}{auto} MB = \mbox{\hyperlink{classChronusQ_1_1NumGradient_a3d7bc5d4ad8cb72955170ecc2cf71431}{prot\_basis}} ? \mbox{\hyperlink{classChronusQ_1_1NumGradient_a3d7bc5d4ad8cb72955170ecc2cf71431}{prot\_basis}}-\/>nBasis : \mbox{\hyperlink{classChronusQ_1_1NumGradient_a4a87e39b5cf3568d0df1e1e664734ab1}{basis}}-\/>nBasis;}
\DoxyCodeLine{313 }
\DoxyCodeLine{314       std::cout << \textcolor{stringliteral}{"{} ===  Numerical ERI Gradient  === "{}} << std::endl;}
\DoxyCodeLine{315       std::cout << std::setprecision(10);}
\DoxyCodeLine{316       \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} iAtom = 0; iAtom < \mbox{\hyperlink{classChronusQ_1_1NumGradient_ac1ce40ac405c21efc16a25023f576e38}{nAtoms}}; iAtom++ ) \{}
\DoxyCodeLine{317 }
\DoxyCodeLine{318         \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} iXYZ = 0; iXYZ < 3; iXYZ++ ) \{}
\DoxyCodeLine{319 }
\DoxyCodeLine{320           std::cout << \textcolor{stringliteral}{"{}Atom: "{}} << std::setw(8) << std::left << iAtom;}
\DoxyCodeLine{321           std::cout << \textcolor{stringliteral}{"{}Cart: "{}} << std::setw(8) << std::left << iXYZ;}
\DoxyCodeLine{322           std::cout << \textcolor{charliteral}{'\(\backslash\)n'} << std::endl;}
\DoxyCodeLine{323 }
\DoxyCodeLine{324           \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} i = 0, ijkl = 0; i < NB; i++ )}
\DoxyCodeLine{325           \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} j = 0; j < NB; j++ )}
\DoxyCodeLine{326           \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} k = 0; k < MB; k++ )}
\DoxyCodeLine{327           \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} l = 0; l < MB; l++, ijkl++ ) \{}
\DoxyCodeLine{328             std::cout << \textcolor{stringliteral}{"{}    ("{}} << i << \textcolor{stringliteral}{"{},"{}} << j << \textcolor{stringliteral}{"{},"{}} << k << \textcolor{stringliteral}{"{},"{}} << l << \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{329             std::cout << \textcolor{stringliteral}{"{}    "{}};}
\DoxyCodeLine{330             \textcolor{keywordflow}{if} (std::abs(res[iAtom*3 +iXYZ][i + j*NB + k*NB*NB + l*NB*NB*MB]) < 1e-\/14)}
\DoxyCodeLine{331               std::cout << 0.;}
\DoxyCodeLine{332             \textcolor{keywordflow}{else} }
\DoxyCodeLine{333               std::cout << res[iAtom*3 +iXYZ][i + j*NB + k*NB*NB + l*NB*NB*MB];}
\DoxyCodeLine{334             std::cout << std::endl;}
\DoxyCodeLine{335           \}}
\DoxyCodeLine{336         \}}
\DoxyCodeLine{337       \}}
\DoxyCodeLine{338       std::cout << \textcolor{stringliteral}{"{} ====================================== "{}} << std::endl;}
\DoxyCodeLine{339 }
\DoxyCodeLine{340     \};}
\DoxyCodeLine{341 }
\DoxyCodeLine{342     \textcolor{keywordtype}{void} \mbox{\hyperlink{classChronusQ_1_1NumGradient_a910c14662f12cad8012c0ae586f61ea1}{printResults}}(std::string name, std::vector<std::vector<double>> res, \textcolor{keywordtype}{size\_t} resIndex, \textcolor{keywordtype}{double} minPrint=1e-\/8) \{}
\DoxyCodeLine{343       std::cout << \textcolor{stringliteral}{"{}\(\backslash\)n"{}} << name << \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{344 }
\DoxyCodeLine{345       std::cout << std::setw(18) << std::left << \textcolor{stringliteral}{"{}  Atom"{}};}
\DoxyCodeLine{346       std::cout << std::setw(18) << std::right << \textcolor{stringliteral}{"{}X"{}};}
\DoxyCodeLine{347       std::cout << std::setw(18) << std::right << \textcolor{stringliteral}{"{}Y"{}};}
\DoxyCodeLine{348       std::cout << std::setw(18) << std::right << \textcolor{stringliteral}{"{}Z"{}} << std::endl;}
\DoxyCodeLine{349       \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} iAtom = 0; iAtom < \mbox{\hyperlink{classChronusQ_1_1NumGradient_ac1ce40ac405c21efc16a25023f576e38}{nAtoms}}; iAtom++ ) \{}
\DoxyCodeLine{350         std::cout << \textcolor{stringliteral}{"{}  "{}} << std::setw(16) << std::left << iAtom;}
\DoxyCodeLine{351 }
\DoxyCodeLine{352         std::cout << std::setprecision(8) << std::scientific << std::right;}
\DoxyCodeLine{353         \textcolor{keywordflow}{for} ( \textcolor{keyword}{auto} iXYZ = 0; iXYZ < 3; iXYZ++ )}
\DoxyCodeLine{354           std::cout << std::setw(18) << (std::abs(res[iAtom*3 + iXYZ][resIndex]) > minPrint ? res[iAtom*3+iXYZ][resIndex] : 0.);}
\DoxyCodeLine{355 }
\DoxyCodeLine{356         std::cout << std::endl;}
\DoxyCodeLine{357       \}}
\DoxyCodeLine{358 }
\DoxyCodeLine{359     \}}
\DoxyCodeLine{360 }
\DoxyCodeLine{361   \};}
\DoxyCodeLine{362 }
\DoxyCodeLine{363 \} \textcolor{comment}{// namespace ChronusQ}}
\DoxyCodeLine{364 }

\end{DoxyCode}
